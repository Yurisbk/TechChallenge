define(["@emotion/css","@grafana/data","@grafana/runtime","@grafana/ui","app/core/config","app/core/core","app/core/table_model","app/core/utils/datemath","app/core/utils/kbn","lodash","moment","react","react-dom"],((e,t,n,r,i,a,o,l,s,c,u,d,p)=>(()=>{var m={5295:(e,t,n)=>{"use strict";const r=n(7372),i=Symbol("max"),a=Symbol("length"),o=Symbol("lengthCalculator"),l=Symbol("allowStale"),s=Symbol("maxAge"),c=Symbol("dispose"),u=Symbol("noDisposeOnSet"),d=Symbol("lruList"),p=Symbol("cache"),m=Symbol("updateAgeOnGet"),h=()=>1,g=(e,t,n)=>{const r=e[p].get(t);if(r){const t=r.value;if(f(e,t)){if(b(e,r),!e[l])return}else n&&(e[m]&&(r.value.now=Date.now()),e[d].unshiftNode(r));return t.value}},f=(e,t)=>{if(!t||!t.maxAge&&!e[s])return!1;const n=Date.now()-t.now;return t.maxAge?n>t.maxAge:e[s]&&n>e[s]},v=e=>{if(e[a]>e[i])for(let t=e[d].tail;e[a]>e[i]&&null!==t;){const n=t.prev;b(e,t),t=n}},b=(e,t)=>{if(t){const n=t.value;e[c]&&e[c](n.key,n.value),e[a]-=n.length,e[p].delete(n.key),e[d].removeNode(t)}};class y{constructor(e,t,n,r,i){this.key=e,this.value=t,this.length=n,this.now=r,this.maxAge=i||0}}const E=(e,t,n,r)=>{let i=n.value;f(e,i)&&(b(e,n),e[l]||(i=void 0)),i&&t.call(r,i.value,i.key,e)};e.exports=class{constructor(e){if("number"==typeof e&&(e={max:e}),e||(e={}),e.max&&("number"!=typeof e.max||e.max<0))throw new TypeError("max must be a non-negative number");this[i]=e.max||1/0;const t=e.length||h;if(this[o]="function"!=typeof t?h:t,this[l]=e.stale||!1,e.maxAge&&"number"!=typeof e.maxAge)throw new TypeError("maxAge must be a number");this[s]=e.maxAge||0,this[c]=e.dispose,this[u]=e.noDisposeOnSet||!1,this[m]=e.updateAgeOnGet||!1,this.reset()}set max(e){if("number"!=typeof e||e<0)throw new TypeError("max must be a non-negative number");this[i]=e||1/0,v(this)}get max(){return this[i]}set allowStale(e){this[l]=!!e}get allowStale(){return this[l]}set maxAge(e){if("number"!=typeof e)throw new TypeError("maxAge must be a non-negative number");this[s]=e,v(this)}get maxAge(){return this[s]}set lengthCalculator(e){"function"!=typeof e&&(e=h),e!==this[o]&&(this[o]=e,this[a]=0,this[d].forEach((e=>{e.length=this[o](e.value,e.key),this[a]+=e.length}))),v(this)}get lengthCalculator(){return this[o]}get length(){return this[a]}get itemCount(){return this[d].length}rforEach(e,t){t=t||this;for(let n=this[d].tail;null!==n;){const r=n.prev;E(this,e,n,t),n=r}}forEach(e,t){t=t||this;for(let n=this[d].head;null!==n;){const r=n.next;E(this,e,n,t),n=r}}keys(){return this[d].toArray().map((e=>e.key))}values(){return this[d].toArray().map((e=>e.value))}reset(){this[c]&&this[d]&&this[d].length&&this[d].forEach((e=>this[c](e.key,e.value))),this[p]=new Map,this[d]=new r,this[a]=0}dump(){return this[d].map((e=>!f(this,e)&&{k:e.key,v:e.value,e:e.now+(e.maxAge||0)})).toArray().filter((e=>e))}dumpLru(){return this[d]}set(e,t,n){if((n=n||this[s])&&"number"!=typeof n)throw new TypeError("maxAge must be a number");const r=n?Date.now():0,l=this[o](t,e);if(this[p].has(e)){if(l>this[i])return b(this,this[p].get(e)),!1;const o=this[p].get(e).value;return this[c]&&(this[u]||this[c](e,o.value)),o.now=r,o.maxAge=n,o.value=t,this[a]+=l-o.length,o.length=l,this.get(e),v(this),!0}const m=new y(e,t,l,r,n);return m.length>this[i]?(this[c]&&this[c](e,t),!1):(this[a]+=m.length,this[d].unshift(m),this[p].set(e,this[d].head),v(this),!0)}has(e){if(!this[p].has(e))return!1;const t=this[p].get(e).value;return!f(this,t)}get(e){return g(this,e,!0)}peek(e){return g(this,e,!1)}pop(){const e=this[d].tail;return e?(b(this,e),e.value):null}del(e){b(this,this[p].get(e))}load(e){this.reset();const t=Date.now();for(let n=e.length-1;n>=0;n--){const r=e[n],i=r.e||0;if(0===i)this.set(r.k,r.v);else{const e=i-t;e>0&&this.set(r.k,r.v,e)}}}prune(){this[p].forEach(((e,t)=>g(this,t,!1)))}}},3134:(e,t,n)=>{const r=Symbol("SemVer ANY");class i{static get ANY(){return r}constructor(e,t){if(t=a(t),e instanceof i){if(e.loose===!!t.loose)return e;e=e.value}e=e.trim().split(/\s+/).join(" "),c("comparator",e,t),this.options=t,this.loose=!!t.loose,this.parse(e),this.semver===r?this.value="":this.value=this.operator+this.semver.version,c("comp",this)}parse(e){const t=this.options.loose?o[l.COMPARATORLOOSE]:o[l.COMPARATOR],n=e.match(t);if(!n)throw new TypeError(`Invalid comparator: ${e}`);this.operator=void 0!==n[1]?n[1]:"","="===this.operator&&(this.operator=""),n[2]?this.semver=new u(n[2],this.options.loose):this.semver=r}toString(){return this.value}test(e){if(c("Comparator.test",e,this.options.loose),this.semver===r||e===r)return!0;if("string"==typeof e)try{e=new u(e,this.options)}catch(e){return!1}return s(e,this.operator,this.semver,this.options)}intersects(e,t){if(!(e instanceof i))throw new TypeError("a Comparator is required");return""===this.operator?""===this.value||new d(e.value,t).test(this.value):""===e.operator?""===e.value||new d(this.value,t).test(e.semver):!((t=a(t)).includePrerelease&&("<0.0.0-0"===this.value||"<0.0.0-0"===e.value)||!t.includePrerelease&&(this.value.startsWith("<0.0.0")||e.value.startsWith("<0.0.0"))||(!this.operator.startsWith(">")||!e.operator.startsWith(">"))&&(!this.operator.startsWith("<")||!e.operator.startsWith("<"))&&(this.semver.version!==e.semver.version||!this.operator.includes("=")||!e.operator.includes("="))&&!(s(this.semver,"<",e.semver,t)&&this.operator.startsWith(">")&&e.operator.startsWith("<"))&&!(s(this.semver,">",e.semver,t)&&this.operator.startsWith("<")&&e.operator.startsWith(">")))}}e.exports=i;const a=n(8716),{safeRe:o,t:l}=n(9022),s=n(5452),c=n(6830),u=n(9510),d=n(7374)},7374:(e,t,n)=>{class r{constructor(e,t){if(t=a(t),e instanceof r)return e.loose===!!t.loose&&e.includePrerelease===!!t.includePrerelease?e:new r(e.raw,t);if(e instanceof o)return this.raw=e.value,this.set=[[e]],this.format(),this;if(this.options=t,this.loose=!!t.loose,this.includePrerelease=!!t.includePrerelease,this.raw=e.trim().split(/\s+/).join(" "),this.set=this.raw.split("||").map((e=>this.parseRange(e.trim()))).filter((e=>e.length)),!this.set.length)throw new TypeError(`Invalid SemVer Range: ${this.raw}`);if(this.set.length>1){const e=this.set[0];if(this.set=this.set.filter((e=>!f(e[0]))),0===this.set.length)this.set=[e];else if(this.set.length>1)for(const e of this.set)if(1===e.length&&v(e[0])){this.set=[e];break}}this.format()}format(){return this.range=this.set.map((e=>e.join(" ").trim())).join("||").trim(),this.range}toString(){return this.range}parseRange(e){const t=((this.options.includePrerelease&&h)|(this.options.loose&&g))+":"+e,n=i.get(t);if(n)return n;const r=this.options.loose,a=r?c[u.HYPHENRANGELOOSE]:c[u.HYPHENRANGE];e=e.replace(a,C(this.options.includePrerelease)),l("hyphen replace",e),e=e.replace(c[u.COMPARATORTRIM],d),l("comparator trim",e),e=e.replace(c[u.TILDETRIM],p),l("tilde trim",e),e=e.replace(c[u.CARETTRIM],m),l("caret trim",e);let s=e.split(" ").map((e=>y(e,this.options))).join(" ").split(/\s+/).map((e=>A(e,this.options)));r&&(s=s.filter((e=>(l("loose invalid filter",e,this.options),!!e.match(c[u.COMPARATORLOOSE]))))),l("range list",s);const v=new Map,b=s.map((e=>new o(e,this.options)));for(const e of b){if(f(e))return[e];v.set(e.value,e)}v.size>1&&v.has("")&&v.delete("");const E=[...v.values()];return i.set(t,E),E}intersects(e,t){if(!(e instanceof r))throw new TypeError("a Range is required");return this.set.some((n=>b(n,t)&&e.set.some((e=>b(e,t)&&n.every((n=>e.every((e=>n.intersects(e,t)))))))))}test(e){if(!e)return!1;if("string"==typeof e)try{e=new s(e,this.options)}catch(e){return!1}for(let t=0;t<this.set.length;t++)if(D(this.set[t],e,this.options))return!0;return!1}}e.exports=r;const i=new(n(5295))({max:1e3}),a=n(8716),o=n(3134),l=n(6830),s=n(9510),{safeRe:c,t:u,comparatorTrimReplace:d,tildeTrimReplace:p,caretTrimReplace:m}=n(9022),{FLAG_INCLUDE_PRERELEASE:h,FLAG_LOOSE:g}=n(39),f=e=>"<0.0.0-0"===e.value,v=e=>""===e.value,b=(e,t)=>{let n=!0;const r=e.slice();let i=r.pop();for(;n&&r.length;)n=r.every((e=>i.intersects(e,t))),i=r.pop();return n},y=(e,t)=>(l("comp",e,t),e=I(e,t),l("caret",e),e=O(e,t),l("tildes",e),e=x(e,t),l("xrange",e),e=S(e,t),l("stars",e),e),E=e=>!e||"x"===e.toLowerCase()||"*"===e,O=(e,t)=>e.trim().split(/\s+/).map((e=>w(e,t))).join(" "),w=(e,t)=>{const n=t.loose?c[u.TILDELOOSE]:c[u.TILDE];return e.replace(n,((t,n,r,i,a)=>{let o;return l("tilde",e,t,n,r,i,a),E(n)?o="":E(r)?o=`>=${n}.0.0 <${+n+1}.0.0-0`:E(i)?o=`>=${n}.${r}.0 <${n}.${+r+1}.0-0`:a?(l("replaceTilde pr",a),o=`>=${n}.${r}.${i}-${a} <${n}.${+r+1}.0-0`):o=`>=${n}.${r}.${i} <${n}.${+r+1}.0-0`,l("tilde return",o),o}))},I=(e,t)=>e.trim().split(/\s+/).map((e=>T(e,t))).join(" "),T=(e,t)=>{l("caret",e,t);const n=t.loose?c[u.CARETLOOSE]:c[u.CARET],r=t.includePrerelease?"-0":"";return e.replace(n,((t,n,i,a,o)=>{let s;return l("caret",e,t,n,i,a,o),E(n)?s="":E(i)?s=`>=${n}.0.0${r} <${+n+1}.0.0-0`:E(a)?s="0"===n?`>=${n}.${i}.0${r} <${n}.${+i+1}.0-0`:`>=${n}.${i}.0${r} <${+n+1}.0.0-0`:o?(l("replaceCaret pr",o),s="0"===n?"0"===i?`>=${n}.${i}.${a}-${o} <${n}.${i}.${+a+1}-0`:`>=${n}.${i}.${a}-${o} <${n}.${+i+1}.0-0`:`>=${n}.${i}.${a}-${o} <${+n+1}.0.0-0`):(l("no pr"),s="0"===n?"0"===i?`>=${n}.${i}.${a}${r} <${n}.${i}.${+a+1}-0`:`>=${n}.${i}.${a}${r} <${n}.${+i+1}.0-0`:`>=${n}.${i}.${a} <${+n+1}.0.0-0`),l("caret return",s),s}))},x=(e,t)=>(l("replaceXRanges",e,t),e.split(/\s+/).map((e=>P(e,t))).join(" ")),P=(e,t)=>{e=e.trim();const n=t.loose?c[u.XRANGELOOSE]:c[u.XRANGE];return e.replace(n,((n,r,i,a,o,s)=>{l("xRange",e,n,r,i,a,o,s);const c=E(i),u=c||E(a),d=u||E(o),p=d;return"="===r&&p&&(r=""),s=t.includePrerelease?"-0":"",c?n=">"===r||"<"===r?"<0.0.0-0":"*":r&&p?(u&&(a=0),o=0,">"===r?(r=">=",u?(i=+i+1,a=0,o=0):(a=+a+1,o=0)):"<="===r&&(r="<",u?i=+i+1:a=+a+1),"<"===r&&(s="-0"),n=`${r+i}.${a}.${o}${s}`):u?n=`>=${i}.0.0${s} <${+i+1}.0.0-0`:d&&(n=`>=${i}.${a}.0${s} <${i}.${+a+1}.0-0`),l("xRange return",n),n}))},S=(e,t)=>(l("replaceStars",e,t),e.trim().replace(c[u.STAR],"")),A=(e,t)=>(l("replaceGTE0",e,t),e.trim().replace(c[t.includePrerelease?u.GTE0PRE:u.GTE0],"")),C=e=>(t,n,r,i,a,o,l,s,c,u,d,p,m)=>`${n=E(r)?"":E(i)?`>=${r}.0.0${e?"-0":""}`:E(a)?`>=${r}.${i}.0${e?"-0":""}`:o?`>=${n}`:`>=${n}${e?"-0":""}`} ${s=E(c)?"":E(u)?`<${+c+1}.0.0-0`:E(d)?`<${c}.${+u+1}.0-0`:p?`<=${c}.${u}.${d}-${p}`:e?`<${c}.${u}.${+d+1}-0`:`<=${s}`}`.trim(),D=(e,t,n)=>{for(let n=0;n<e.length;n++)if(!e[n].test(t))return!1;if(t.prerelease.length&&!n.includePrerelease){for(let n=0;n<e.length;n++)if(l(e[n].semver),e[n].semver!==o.ANY&&e[n].semver.prerelease.length>0){const r=e[n].semver;if(r.major===t.major&&r.minor===t.minor&&r.patch===t.patch)return!0}return!1}return!0}},9510:(e,t,n)=>{const r=n(6830),{MAX_LENGTH:i,MAX_SAFE_INTEGER:a}=n(39),{safeRe:o,t:l}=n(9022),s=n(8716),{compareIdentifiers:c}=n(8822);class u{constructor(e,t){if(t=s(t),e instanceof u){if(e.loose===!!t.loose&&e.includePrerelease===!!t.includePrerelease)return e;e=e.version}else if("string"!=typeof e)throw new TypeError(`Invalid version. Must be a string. Got type "${typeof e}".`);if(e.length>i)throw new TypeError(`version is longer than ${i} characters`);r("SemVer",e,t),this.options=t,this.loose=!!t.loose,this.includePrerelease=!!t.includePrerelease;const n=e.trim().match(t.loose?o[l.LOOSE]:o[l.FULL]);if(!n)throw new TypeError(`Invalid Version: ${e}`);if(this.raw=e,this.major=+n[1],this.minor=+n[2],this.patch=+n[3],this.major>a||this.major<0)throw new TypeError("Invalid major version");if(this.minor>a||this.minor<0)throw new TypeError("Invalid minor version");if(this.patch>a||this.patch<0)throw new TypeError("Invalid patch version");n[4]?this.prerelease=n[4].split(".").map((e=>{if(/^[0-9]+$/.test(e)){const t=+e;if(t>=0&&t<a)return t}return e})):this.prerelease=[],this.build=n[5]?n[5].split("."):[],this.format()}format(){return this.version=`${this.major}.${this.minor}.${this.patch}`,this.prerelease.length&&(this.version+=`-${this.prerelease.join(".")}`),this.version}toString(){return this.version}compare(e){if(r("SemVer.compare",this.version,this.options,e),!(e instanceof u)){if("string"==typeof e&&e===this.version)return 0;e=new u(e,this.options)}return e.version===this.version?0:this.compareMain(e)||this.comparePre(e)}compareMain(e){return e instanceof u||(e=new u(e,this.options)),c(this.major,e.major)||c(this.minor,e.minor)||c(this.patch,e.patch)}comparePre(e){if(e instanceof u||(e=new u(e,this.options)),this.prerelease.length&&!e.prerelease.length)return-1;if(!this.prerelease.length&&e.prerelease.length)return 1;if(!this.prerelease.length&&!e.prerelease.length)return 0;let t=0;do{const n=this.prerelease[t],i=e.prerelease[t];if(r("prerelease compare",t,n,i),void 0===n&&void 0===i)return 0;if(void 0===i)return 1;if(void 0===n)return-1;if(n!==i)return c(n,i)}while(++t)}compareBuild(e){e instanceof u||(e=new u(e,this.options));let t=0;do{const n=this.build[t],i=e.build[t];if(r("prerelease compare",t,n,i),void 0===n&&void 0===i)return 0;if(void 0===i)return 1;if(void 0===n)return-1;if(n!==i)return c(n,i)}while(++t)}inc(e,t,n){switch(e){case"premajor":this.prerelease.length=0,this.patch=0,this.minor=0,this.major++,this.inc("pre",t,n);break;case"preminor":this.prerelease.length=0,this.patch=0,this.minor++,this.inc("pre",t,n);break;case"prepatch":this.prerelease.length=0,this.inc("patch",t,n),this.inc("pre",t,n);break;case"prerelease":0===this.prerelease.length&&this.inc("patch",t,n),this.inc("pre",t,n);break;case"major":0===this.minor&&0===this.patch&&0!==this.prerelease.length||this.major++,this.minor=0,this.patch=0,this.prerelease=[];break;case"minor":0===this.patch&&0!==this.prerelease.length||this.minor++,this.patch=0,this.prerelease=[];break;case"patch":0===this.prerelease.length&&this.patch++,this.prerelease=[];break;case"pre":{const e=Number(n)?1:0;if(!t&&!1===n)throw new Error("invalid increment argument: identifier is empty");if(0===this.prerelease.length)this.prerelease=[e];else{let r=this.prerelease.length;for(;--r>=0;)"number"==typeof this.prerelease[r]&&(this.prerelease[r]++,r=-2);if(-1===r){if(t===this.prerelease.join(".")&&!1===n)throw new Error("invalid increment argument: identifier already exists");this.prerelease.push(e)}}if(t){let r=[t,e];!1===n&&(r=[t]),0===c(this.prerelease[0],t)?isNaN(this.prerelease[1])&&(this.prerelease=r):this.prerelease=r}break}default:throw new Error(`invalid increment argument: ${e}`)}return this.raw=this.format(),this.build.length&&(this.raw+=`+${this.build.join(".")}`),this}}e.exports=u},6457:(e,t,n)=>{const r=n(5692);e.exports=(e,t)=>{const n=r(e.trim().replace(/^[=v]+/,""),t);return n?n.version:null}},5452:(e,t,n)=>{const r=n(8565),i=n(3328),a=n(2260),o=n(6579),l=n(290),s=n(5891);e.exports=(e,t,n,c)=>{switch(t){case"===":return"object"==typeof e&&(e=e.version),"object"==typeof n&&(n=n.version),e===n;case"!==":return"object"==typeof e&&(e=e.version),"object"==typeof n&&(n=n.version),e!==n;case"":case"=":case"==":return r(e,n,c);case"!=":return i(e,n,c);case">":return a(e,n,c);case">=":return o(e,n,c);case"<":return l(e,n,c);case"<=":return s(e,n,c);default:throw new TypeError(`Invalid operator: ${t}`)}}},9469:(e,t,n)=>{const r=n(9510),i=n(5692),{safeRe:a,t:o}=n(9022);e.exports=(e,t)=>{if(e instanceof r)return e;if("number"==typeof e&&(e=String(e)),"string"!=typeof e)return null;let n=null;if((t=t||{}).rtl){let t;for(;(t=a[o.COERCERTL].exec(e))&&(!n||n.index+n[0].length!==e.length);)n&&t.index+t[0].length===n.index+n[0].length||(n=t),a[o.COERCERTL].lastIndex=t.index+t[1].length+t[2].length;a[o.COERCERTL].lastIndex=-1}else n=e.match(a[o.COERCE]);return null===n?null:i(`${n[2]}.${n[3]||"0"}.${n[4]||"0"}`,t)}},1868:(e,t,n)=>{const r=n(9510);e.exports=(e,t,n)=>{const i=new r(e,n),a=new r(t,n);return i.compare(a)||i.compareBuild(a)}},5919:(e,t,n)=>{const r=n(3992);e.exports=(e,t)=>r(e,t,!0)},3992:(e,t,n)=>{const r=n(9510);e.exports=(e,t,n)=>new r(e,n).compare(new r(t,n))},1007:(e,t,n)=>{const r=n(5692);e.exports=(e,t)=>{const n=r(e,null,!0),i=r(t,null,!0),a=n.compare(i);if(0===a)return null;const o=a>0,l=o?n:i,s=o?i:n,c=!!l.prerelease.length;if(s.prerelease.length&&!c)return s.patch||s.minor?l.patch?"patch":l.minor?"minor":"major":"major";const u=c?"pre":"";return n.major!==i.major?u+"major":n.minor!==i.minor?u+"minor":n.patch!==i.patch?u+"patch":"prerelease"}},8565:(e,t,n)=>{const r=n(3992);e.exports=(e,t,n)=>0===r(e,t,n)},2260:(e,t,n)=>{const r=n(3992);e.exports=(e,t,n)=>r(e,t,n)>0},6579:(e,t,n)=>{const r=n(3992);e.exports=(e,t,n)=>r(e,t,n)>=0},515:(e,t,n)=>{const r=n(9510);e.exports=(e,t,n,i,a)=>{"string"==typeof n&&(a=i,i=n,n=void 0);try{return new r(e instanceof r?e.version:e,n).inc(t,i,a).version}catch(e){return null}}},290:(e,t,n)=>{const r=n(3992);e.exports=(e,t,n)=>r(e,t,n)<0},5891:(e,t,n)=>{const r=n(3992);e.exports=(e,t,n)=>r(e,t,n)<=0},2611:(e,t,n)=>{const r=n(9510);e.exports=(e,t)=>new r(e,t).major},6319:(e,t,n)=>{const r=n(9510);e.exports=(e,t)=>new r(e,t).minor},3328:(e,t,n)=>{const r=n(3992);e.exports=(e,t,n)=>0!==r(e,t,n)},5692:(e,t,n)=>{const r=n(9510);e.exports=(e,t,n=!1)=>{if(e instanceof r)return e;try{return new r(e,t)}catch(e){if(!n)return null;throw e}}},7368:(e,t,n)=>{const r=n(9510);e.exports=(e,t)=>new r(e,t).patch},7794:(e,t,n)=>{const r=n(5692);e.exports=(e,t)=>{const n=r(e,t);return n&&n.prerelease.length?n.prerelease:null}},9114:(e,t,n)=>{const r=n(3992);e.exports=(e,t,n)=>r(t,e,n)},3843:(e,t,n)=>{const r=n(1868);e.exports=(e,t)=>e.sort(((e,n)=>r(n,e,t)))},9845:(e,t,n)=>{const r=n(7374);e.exports=(e,t,n)=>{try{t=new r(t,n)}catch(e){return!1}return t.test(e)}},8753:(e,t,n)=>{const r=n(1868);e.exports=(e,t)=>e.sort(((e,n)=>r(e,n,t)))},398:(e,t,n)=>{const r=n(5692);e.exports=(e,t)=>{const n=r(e,t);return n?n.version:null}},8873:(e,t,n)=>{const r=n(9022),i=n(39),a=n(9510),o=n(8822),l=n(5692),s=n(398),c=n(6457),u=n(515),d=n(1007),p=n(2611),m=n(6319),h=n(7368),g=n(7794),f=n(3992),v=n(9114),b=n(5919),y=n(1868),E=n(8753),O=n(3843),w=n(2260),I=n(290),T=n(8565),x=n(3328),P=n(6579),S=n(5891),A=n(5452),C=n(9469),D=n(3134),j=n(7374),F=n(9845),R=n(8384),$=n(6369),N=n(2663),k=n(75),L=n(9178),_=n(9434),M=n(8237),q=n(9860),V=n(8258),B=n(3607),H=n(2199);e.exports={parse:l,valid:s,clean:c,inc:u,diff:d,major:p,minor:m,patch:h,prerelease:g,compare:f,rcompare:v,compareLoose:b,compareBuild:y,sort:E,rsort:O,gt:w,lt:I,eq:T,neq:x,gte:P,lte:S,cmp:A,coerce:C,Comparator:D,Range:j,satisfies:F,toComparators:R,maxSatisfying:$,minSatisfying:N,minVersion:k,validRange:L,outside:_,gtr:M,ltr:q,intersects:V,simplifyRange:B,subset:H,SemVer:a,re:r.re,src:r.src,tokens:r.t,SEMVER_SPEC_VERSION:i.SEMVER_SPEC_VERSION,RELEASE_TYPES:i.RELEASE_TYPES,compareIdentifiers:o.compareIdentifiers,rcompareIdentifiers:o.rcompareIdentifiers}},39:e=>{const t=Number.MAX_SAFE_INTEGER||9007199254740991;e.exports={MAX_LENGTH:256,MAX_SAFE_COMPONENT_LENGTH:16,MAX_SAFE_BUILD_LENGTH:250,MAX_SAFE_INTEGER:t,RELEASE_TYPES:["major","premajor","minor","preminor","patch","prepatch","prerelease"],SEMVER_SPEC_VERSION:"2.0.0",FLAG_INCLUDE_PRERELEASE:1,FLAG_LOOSE:2}},6830:e=>{const t="object"==typeof process&&process.env&&process.env.NODE_DEBUG&&/\bsemver\b/i.test(process.env.NODE_DEBUG)?(...e)=>console.error("SEMVER",...e):()=>{};e.exports=t},8822:e=>{const t=/^[0-9]+$/,n=(e,n)=>{const r=t.test(e),i=t.test(n);return r&&i&&(e=+e,n=+n),e===n?0:r&&!i?-1:i&&!r?1:e<n?-1:1};e.exports={compareIdentifiers:n,rcompareIdentifiers:(e,t)=>n(t,e)}},8716:e=>{const t=Object.freeze({loose:!0}),n=Object.freeze({});e.exports=e=>e?"object"!=typeof e?t:e:n},9022:(e,t,n)=>{const{MAX_SAFE_COMPONENT_LENGTH:r,MAX_SAFE_BUILD_LENGTH:i,MAX_LENGTH:a}=n(39),o=n(6830),l=(t=e.exports={}).re=[],s=t.safeRe=[],c=t.src=[],u=t.t={};let d=0;const p="[a-zA-Z0-9-]",m=[["\\s",1],["\\d",a],[p,i]],h=(e,t,n)=>{const r=(e=>{for(const[t,n]of m)e=e.split(`${t}*`).join(`${t}{0,${n}}`).split(`${t}+`).join(`${t}{1,${n}}`);return e})(t),i=d++;o(e,i,t),u[e]=i,c[i]=t,l[i]=new RegExp(t,n?"g":void 0),s[i]=new RegExp(r,n?"g":void 0)};h("NUMERICIDENTIFIER","0|[1-9]\\d*"),h("NUMERICIDENTIFIERLOOSE","\\d+"),h("NONNUMERICIDENTIFIER",`\\d*[a-zA-Z-]${p}*`),h("MAINVERSION",`(${c[u.NUMERICIDENTIFIER]})\\.(${c[u.NUMERICIDENTIFIER]})\\.(${c[u.NUMERICIDENTIFIER]})`),h("MAINVERSIONLOOSE",`(${c[u.NUMERICIDENTIFIERLOOSE]})\\.(${c[u.NUMERICIDENTIFIERLOOSE]})\\.(${c[u.NUMERICIDENTIFIERLOOSE]})`),h("PRERELEASEIDENTIFIER",`(?:${c[u.NUMERICIDENTIFIER]}|${c[u.NONNUMERICIDENTIFIER]})`),h("PRERELEASEIDENTIFIERLOOSE",`(?:${c[u.NUMERICIDENTIFIERLOOSE]}|${c[u.NONNUMERICIDENTIFIER]})`),h("PRERELEASE",`(?:-(${c[u.PRERELEASEIDENTIFIER]}(?:\\.${c[u.PRERELEASEIDENTIFIER]})*))`),h("PRERELEASELOOSE",`(?:-?(${c[u.PRERELEASEIDENTIFIERLOOSE]}(?:\\.${c[u.PRERELEASEIDENTIFIERLOOSE]})*))`),h("BUILDIDENTIFIER",`${p}+`),h("BUILD",`(?:\\+(${c[u.BUILDIDENTIFIER]}(?:\\.${c[u.BUILDIDENTIFIER]})*))`),h("FULLPLAIN",`v?${c[u.MAINVERSION]}${c[u.PRERELEASE]}?${c[u.BUILD]}?`),h("FULL",`^${c[u.FULLPLAIN]}$`),h("LOOSEPLAIN",`[v=\\s]*${c[u.MAINVERSIONLOOSE]}${c[u.PRERELEASELOOSE]}?${c[u.BUILD]}?`),h("LOOSE",`^${c[u.LOOSEPLAIN]}$`),h("GTLT","((?:<|>)?=?)"),h("XRANGEIDENTIFIERLOOSE",`${c[u.NUMERICIDENTIFIERLOOSE]}|x|X|\\*`),h("XRANGEIDENTIFIER",`${c[u.NUMERICIDENTIFIER]}|x|X|\\*`),h("XRANGEPLAIN",`[v=\\s]*(${c[u.XRANGEIDENTIFIER]})(?:\\.(${c[u.XRANGEIDENTIFIER]})(?:\\.(${c[u.XRANGEIDENTIFIER]})(?:${c[u.PRERELEASE]})?${c[u.BUILD]}?)?)?`),h("XRANGEPLAINLOOSE",`[v=\\s]*(${c[u.XRANGEIDENTIFIERLOOSE]})(?:\\.(${c[u.XRANGEIDENTIFIERLOOSE]})(?:\\.(${c[u.XRANGEIDENTIFIERLOOSE]})(?:${c[u.PRERELEASELOOSE]})?${c[u.BUILD]}?)?)?`),h("XRANGE",`^${c[u.GTLT]}\\s*${c[u.XRANGEPLAIN]}$`),h("XRANGELOOSE",`^${c[u.GTLT]}\\s*${c[u.XRANGEPLAINLOOSE]}$`),h("COERCE",`(^|[^\\d])(\\d{1,${r}})(?:\\.(\\d{1,${r}}))?(?:\\.(\\d{1,${r}}))?(?:$|[^\\d])`),h("COERCERTL",c[u.COERCE],!0),h("LONETILDE","(?:~>?)"),h("TILDETRIM",`(\\s*)${c[u.LONETILDE]}\\s+`,!0),t.tildeTrimReplace="$1~",h("TILDE",`^${c[u.LONETILDE]}${c[u.XRANGEPLAIN]}$`),h("TILDELOOSE",`^${c[u.LONETILDE]}${c[u.XRANGEPLAINLOOSE]}$`),h("LONECARET","(?:\\^)"),h("CARETTRIM",`(\\s*)${c[u.LONECARET]}\\s+`,!0),t.caretTrimReplace="$1^",h("CARET",`^${c[u.LONECARET]}${c[u.XRANGEPLAIN]}$`),h("CARETLOOSE",`^${c[u.LONECARET]}${c[u.XRANGEPLAINLOOSE]}$`),h("COMPARATORLOOSE",`^${c[u.GTLT]}\\s*(${c[u.LOOSEPLAIN]})$|^$`),h("COMPARATOR",`^${c[u.GTLT]}\\s*(${c[u.FULLPLAIN]})$|^$`),h("COMPARATORTRIM",`(\\s*)${c[u.GTLT]}\\s*(${c[u.LOOSEPLAIN]}|${c[u.XRANGEPLAIN]})`,!0),t.comparatorTrimReplace="$1$2$3",h("HYPHENRANGE",`^\\s*(${c[u.XRANGEPLAIN]})\\s+-\\s+(${c[u.XRANGEPLAIN]})\\s*$`),h("HYPHENRANGELOOSE",`^\\s*(${c[u.XRANGEPLAINLOOSE]})\\s+-\\s+(${c[u.XRANGEPLAINLOOSE]})\\s*$`),h("STAR","(<|>)?=?\\s*\\*"),h("GTE0","^\\s*>=\\s*0\\.0\\.0\\s*$"),h("GTE0PRE","^\\s*>=\\s*0\\.0\\.0-0\\s*$")},8237:(e,t,n)=>{const r=n(9434);e.exports=(e,t,n)=>r(e,t,">",n)},8258:(e,t,n)=>{const r=n(7374);e.exports=(e,t,n)=>(e=new r(e,n),t=new r(t,n),e.intersects(t,n))},9860:(e,t,n)=>{const r=n(9434);e.exports=(e,t,n)=>r(e,t,"<",n)},6369:(e,t,n)=>{const r=n(9510),i=n(7374);e.exports=(e,t,n)=>{let a=null,o=null,l=null;try{l=new i(t,n)}catch(e){return null}return e.forEach((e=>{l.test(e)&&(a&&-1!==o.compare(e)||(a=e,o=new r(a,n)))})),a}},2663:(e,t,n)=>{const r=n(9510),i=n(7374);e.exports=(e,t,n)=>{let a=null,o=null,l=null;try{l=new i(t,n)}catch(e){return null}return e.forEach((e=>{l.test(e)&&(a&&1!==o.compare(e)||(a=e,o=new r(a,n)))})),a}},75:(e,t,n)=>{const r=n(9510),i=n(7374),a=n(2260);e.exports=(e,t)=>{e=new i(e,t);let n=new r("0.0.0");if(e.test(n))return n;if(n=new r("0.0.0-0"),e.test(n))return n;n=null;for(let t=0;t<e.set.length;++t){const i=e.set[t];let o=null;i.forEach((e=>{const t=new r(e.semver.version);switch(e.operator){case">":0===t.prerelease.length?t.patch++:t.prerelease.push(0),t.raw=t.format();case"":case">=":o&&!a(t,o)||(o=t);break;case"<":case"<=":break;default:throw new Error(`Unexpected operation: ${e.operator}`)}})),!o||n&&!a(n,o)||(n=o)}return n&&e.test(n)?n:null}},9434:(e,t,n)=>{const r=n(9510),i=n(3134),{ANY:a}=i,o=n(7374),l=n(9845),s=n(2260),c=n(290),u=n(5891),d=n(6579);e.exports=(e,t,n,p)=>{let m,h,g,f,v;switch(e=new r(e,p),t=new o(t,p),n){case">":m=s,h=u,g=c,f=">",v=">=";break;case"<":m=c,h=d,g=s,f="<",v="<=";break;default:throw new TypeError('Must provide a hilo val of "<" or ">"')}if(l(e,t,p))return!1;for(let n=0;n<t.set.length;++n){const r=t.set[n];let o=null,l=null;if(r.forEach((e=>{e.semver===a&&(e=new i(">=0.0.0")),o=o||e,l=l||e,m(e.semver,o.semver,p)?o=e:g(e.semver,l.semver,p)&&(l=e)})),o.operator===f||o.operator===v)return!1;if((!l.operator||l.operator===f)&&h(e,l.semver))return!1;if(l.operator===v&&g(e,l.semver))return!1}return!0}},3607:(e,t,n)=>{const r=n(9845),i=n(3992);e.exports=(e,t,n)=>{const a=[];let o=null,l=null;const s=e.sort(((e,t)=>i(e,t,n)));for(const e of s)r(e,t,n)?(l=e,o||(o=e)):(l&&a.push([o,l]),l=null,o=null);o&&a.push([o,null]);const c=[];for(const[e,t]of a)e===t?c.push(e):t||e!==s[0]?t?e===s[0]?c.push(`<=${t}`):c.push(`${e} - ${t}`):c.push(`>=${e}`):c.push("*");const u=c.join(" || "),d="string"==typeof t.raw?t.raw:String(t);return u.length<d.length?u:t}},2199:(e,t,n)=>{const r=n(7374),i=n(3134),{ANY:a}=i,o=n(9845),l=n(3992),s=[new i(">=0.0.0-0")],c=[new i(">=0.0.0")],u=(e,t,n)=>{if(e===t)return!0;if(1===e.length&&e[0].semver===a){if(1===t.length&&t[0].semver===a)return!0;e=n.includePrerelease?s:c}if(1===t.length&&t[0].semver===a){if(n.includePrerelease)return!0;t=c}const r=new Set;let i,u,m,h,g,f,v;for(const t of e)">"===t.operator||">="===t.operator?i=d(i,t,n):"<"===t.operator||"<="===t.operator?u=p(u,t,n):r.add(t.semver);if(r.size>1)return null;if(i&&u){if(m=l(i.semver,u.semver,n),m>0)return null;if(0===m&&(">="!==i.operator||"<="!==u.operator))return null}for(const e of r){if(i&&!o(e,String(i),n))return null;if(u&&!o(e,String(u),n))return null;for(const r of t)if(!o(e,String(r),n))return!1;return!0}let b=!(!u||n.includePrerelease||!u.semver.prerelease.length)&&u.semver,y=!(!i||n.includePrerelease||!i.semver.prerelease.length)&&i.semver;b&&1===b.prerelease.length&&"<"===u.operator&&0===b.prerelease[0]&&(b=!1);for(const e of t){if(v=v||">"===e.operator||">="===e.operator,f=f||"<"===e.operator||"<="===e.operator,i)if(y&&e.semver.prerelease&&e.semver.prerelease.length&&e.semver.major===y.major&&e.semver.minor===y.minor&&e.semver.patch===y.patch&&(y=!1),">"===e.operator||">="===e.operator){if(h=d(i,e,n),h===e&&h!==i)return!1}else if(">="===i.operator&&!o(i.semver,String(e),n))return!1;if(u)if(b&&e.semver.prerelease&&e.semver.prerelease.length&&e.semver.major===b.major&&e.semver.minor===b.minor&&e.semver.patch===b.patch&&(b=!1),"<"===e.operator||"<="===e.operator){if(g=p(u,e,n),g===e&&g!==u)return!1}else if("<="===u.operator&&!o(u.semver,String(e),n))return!1;if(!e.operator&&(u||i)&&0!==m)return!1}return!(i&&f&&!u&&0!==m||u&&v&&!i&&0!==m||y||b)},d=(e,t,n)=>{if(!e)return t;const r=l(e.semver,t.semver,n);return r>0?e:r<0||">"===t.operator&&">="===e.operator?t:e},p=(e,t,n)=>{if(!e)return t;const r=l(e.semver,t.semver,n);return r<0?e:r>0||"<"===t.operator&&"<="===e.operator?t:e};e.exports=(e,t,n={})=>{if(e===t)return!0;e=new r(e,n),t=new r(t,n);let i=!1;e:for(const r of e.set){for(const e of t.set){const t=u(r,e,n);if(i=i||null!==t,t)continue e}if(i)return!1}return!0}},8384:(e,t,n)=>{const r=n(7374);e.exports=(e,t)=>new r(e,t).set.map((e=>e.map((e=>e.value)).join(" ").trim().split(" ")))},9178:(e,t,n)=>{const r=n(7374);e.exports=(e,t)=>{try{return new r(e,t).range||"*"}catch(e){return null}}},9976:e=>{"use strict";e.exports=function(e){e.prototype[Symbol.iterator]=function*(){for(let e=this.head;e;e=e.next)yield e.value}}},7372:(e,t,n)=>{"use strict";function r(e){var t=this;if(t instanceof r||(t=new r),t.tail=null,t.head=null,t.length=0,e&&"function"==typeof e.forEach)e.forEach((function(e){t.push(e)}));else if(arguments.length>0)for(var n=0,i=arguments.length;n<i;n++)t.push(arguments[n]);return t}function i(e,t,n,r){if(!(this instanceof i))return new i(e,t,n,r);this.list=r,this.value=e,t?(t.next=this,this.prev=t):this.prev=null,n?(n.prev=this,this.next=n):this.next=null}e.exports=r,r.Node=i,r.create=r,r.prototype.removeNode=function(e){if(e.list!==this)throw new Error("removing node which does not belong to this list");var t=e.next,n=e.prev;return t&&(t.prev=n),n&&(n.next=t),e===this.head&&(this.head=t),e===this.tail&&(this.tail=n),e.list.length--,e.next=null,e.prev=null,e.list=null,t},r.prototype.unshiftNode=function(e){if(e!==this.head){e.list&&e.list.removeNode(e);var t=this.head;e.list=this,e.next=t,t&&(t.prev=e),this.head=e,this.tail||(this.tail=e),this.length++}},r.prototype.pushNode=function(e){if(e!==this.tail){e.list&&e.list.removeNode(e);var t=this.tail;e.list=this,e.prev=t,t&&(t.next=e),this.tail=e,this.head||(this.head=e),this.length++}},r.prototype.push=function(){for(var e=0,t=arguments.length;e<t;e++)r=arguments[e],(n=this).tail=new i(r,n.tail,null,n),n.head||(n.head=n.tail),n.length++;var n,r;return this.length},r.prototype.unshift=function(){for(var e=0,t=arguments.length;e<t;e++)r=arguments[e],(n=this).head=new i(r,null,n.head,n),n.tail||(n.tail=n.head),n.length++;var n,r;return this.length},r.prototype.pop=function(){if(this.tail){var e=this.tail.value;return this.tail=this.tail.prev,this.tail?this.tail.next=null:this.head=null,this.length--,e}},r.prototype.shift=function(){if(this.head){var e=this.head.value;return this.head=this.head.next,this.head?this.head.prev=null:this.tail=null,this.length--,e}},r.prototype.forEach=function(e,t){t=t||this;for(var n=this.head,r=0;null!==n;r++)e.call(t,n.value,r,this),n=n.next},r.prototype.forEachReverse=function(e,t){t=t||this;for(var n=this.tail,r=this.length-1;null!==n;r--)e.call(t,n.value,r,this),n=n.prev},r.prototype.get=function(e){for(var t=0,n=this.head;null!==n&&t<e;t++)n=n.next;if(t===e&&null!==n)return n.value},r.prototype.getReverse=function(e){for(var t=0,n=this.tail;null!==n&&t<e;t++)n=n.prev;if(t===e&&null!==n)return n.value},r.prototype.map=function(e,t){t=t||this;for(var n=new r,i=this.head;null!==i;)n.push(e.call(t,i.value,this)),i=i.next;return n},r.prototype.mapReverse=function(e,t){t=t||this;for(var n=new r,i=this.tail;null!==i;)n.push(e.call(t,i.value,this)),i=i.prev;return n},r.prototype.reduce=function(e,t){var n,r=this.head;if(arguments.length>1)n=t;else{if(!this.head)throw new TypeError("Reduce of empty list with no initial value");r=this.head.next,n=this.head.value}for(var i=0;null!==r;i++)n=e(n,r.value,i),r=r.next;return n},r.prototype.reduceReverse=function(e,t){var n,r=this.tail;if(arguments.length>1)n=t;else{if(!this.tail)throw new TypeError("Reduce of empty list with no initial value");r=this.tail.prev,n=this.tail.value}for(var i=this.length-1;null!==r;i--)n=e(n,r.value,i),r=r.prev;return n},r.prototype.toArray=function(){for(var e=new Array(this.length),t=0,n=this.head;null!==n;t++)e[t]=n.value,n=n.next;return e},r.prototype.toArrayReverse=function(){for(var e=new Array(this.length),t=0,n=this.tail;null!==n;t++)e[t]=n.value,n=n.prev;return e},r.prototype.slice=function(e,t){(t=t||this.length)<0&&(t+=this.length),(e=e||0)<0&&(e+=this.length);var n=new r;if(t<e||t<0)return n;e<0&&(e=0),t>this.length&&(t=this.length);for(var i=0,a=this.head;null!==a&&i<e;i++)a=a.next;for(;null!==a&&i<t;i++,a=a.next)n.push(a.value);return n},r.prototype.sliceReverse=function(e,t){(t=t||this.length)<0&&(t+=this.length),(e=e||0)<0&&(e+=this.length);var n=new r;if(t<e||t<0)return n;e<0&&(e=0),t>this.length&&(t=this.length);for(var i=this.length,a=this.tail;null!==a&&i>t;i--)a=a.prev;for(;null!==a&&i>e;i--,a=a.prev)n.push(a.value);return n},r.prototype.splice=function(e,t,...n){e>this.length&&(e=this.length-1),e<0&&(e=this.length+e);for(var r=0,a=this.head;null!==a&&r<e;r++)a=a.next;var o,l,s,c,u=[];for(r=0;a&&r<t;r++)u.push(a.value),a=this.removeNode(a);for(null===a&&(a=this.tail),a!==this.head&&a!==this.tail&&(a=a.prev),r=0;r<n.length;r++)o=this,l=a,s=n[r],c=void 0,null===(c=l===o.head?new i(s,null,l,o):new i(s,l,l.next,o)).next&&(o.tail=c),null===c.prev&&(o.head=c),o.length++,a=c;return u},r.prototype.reverse=function(){for(var e=this.head,t=this.tail,n=e;null!==n;n=n.prev){var r=n.prev;n.prev=n.next,n.next=r}return this.head=t,this.tail=e,this};try{n(9976)(r)}catch(e){}},7644:t=>{"use strict";t.exports=e},3305:e=>{"use strict";e.exports=t},3545:e=>{"use strict";e.exports=n},7388:e=>{"use strict";e.exports=r},346:e=>{"use strict";e.exports=i},7294:e=>{"use strict";e.exports=a},4745:e=>{"use strict";e.exports=o},7084:e=>{"use strict";e.exports=l},7399:e=>{"use strict";e.exports=s},5980:e=>{"use strict";e.exports=c},8283:e=>{"use strict";e.exports=u},2650:e=>{"use strict";e.exports=d},2729:e=>{"use strict";e.exports=p}},h={};function g(e){var t=h[e];if(void 0!==t)return t.exports;var n=h[e]={exports:{}};return m[e](n,n.exports,g),n.exports}g.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return g.d(t,{a:t}),t},g.d=(e,t)=>{for(var n in t)g.o(t,n)&&!g.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},g.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),g.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var f={};return(()=>{"use strict";g.r(f),g.d(f,{plugin:()=>Qo});var e=g(3305),t=g(5980),n=g.n(t),r=g(346),i=g.n(r),a=g(7294),o=g(7084),l=g(8283),s=g.n(l);const c="0",u="1",d="2",p="3",m="4",h="5",v="6",b=[{val:0,text:"Not classified"},{val:1,text:"Information"},{val:2,text:"Warning"},{val:3,text:"Average"},{val:4,text:"High"},{val:5,text:"Disaster"}],y="range_series";var E,O,w,I;!function(e){e.Group="group",e.Host="host",e.Application="application",e.Macro="macro",e.ItemTag="itemTag",e.Item="item",e.ItemValues="itemValues"}(E||(E={}));class T extends e.BusEventWithPayload{}function x(e){return n().forEach(e,(e=>(e.item=e.name,e.name=function(e,t){const r=function(e){const t=[];let r=!1,i=!1,a="";return n().forEach(e,(e=>{'"'===e&&i?a+=e:'"'===e&&r?r=!1:'"'!==e||r?"["!==e||r?"]"!==e||r?","!==e||r||i?a+=e:(t.push(a),a=""):i=!1:i=!0:r=!0})),t.push(a),t}(t.substring(t.indexOf("[")+1,t.lastIndexOf("]")));for(let t=r.length;t>=1;t--)e=e.replace("$"+t,r[t-1]);return e}(e.item,e.key_),e))),e}I="zbx-query-updated",(w="type")in(O=T)?Object.defineProperty(O,w,{value:I,enumerable:!0,configurable:!0,writable:!0}):O[w]=I;const P=/{\$[A-Z0-9_\.]+}/g;function S(e,t,r){let i=r?e.url:e.name;const a=i.match(P);return n().forEach(a,(a=>{const o=n().filter(t,(t=>{if(t.hostid){if(r){let r=!1;return n().forEach(e.hosts,(e=>{e.hostid===t.hostid&&(r=!0)})),r}return t.hostid===e.hostid}return!0})),l=n().find(o,{macro:a});if(l&&l.value){const e=l.value,t=new RegExp(function(e){return e=e.replace(/\$/,"\\$")}(a));i=i.replace(t,e)}})),i}function A(e){let t;const r=[];n().each(function(e){const t=/\{[^\{\}]*\}|\{\/.*\/\}/g;let r;if(function(e){return/^\{.+\}$/.test(e)}(e)){const i=e.match(t);r=n().map(i,(e=>n().trim(e,"{}")))}else r=e.split(".");return r}(e),(e=>{"*"===e&&(e="/.*/"),r.push(e)}));const i=n().zipObject(["group","host","app","item"],r);switch(4===r.length&&"/.*/"===i.app&&(i.app=""),r.length){case 1:t=E.Group;break;case 2:t=E.Host;break;case 3:t=E.Application;break;case 4:t=E.Item}return{queryType:t,group:i.group||"",host:i.host||"",application:i.app||"",item:i.item||""}}const C=/^\/(.*)\/([gmi]*)$/m;function D(e){return C.test(e)}function j(t){const n=t.to.diff(t.from),r=Math.round(n/1e3),i=e.rangeUtil.secondsToHms(n/1e3);return{__range_ms:{text:n,value:n},__range_s:{text:r,value:r},__range:{text:i,value:i},__range_series:{text:y,value:y}}}function F(e){const t=e.match(C),n=t[1],r=""!==t[2]?t[2]:void 0;return new RegExp(n,r)}function R(e){return e.replace(/[\\^$*+?.()|[\]{}\/]/g,"\\$&")}function $(e){const t=function(e){const t=/(^[\d]+)(y|M|w|d|h|m|s)?/g.exec(e);return!t||!e||t.length>2&&!t[2]?"":t[1]+(t.length>2?t[2]:"s")}(e);return t?N(t):0}function N(e){const t=/(^[\d]+)(y|M|w|d|h|m|s)/g.exec(e);return s().duration(Number(t[1]),t[2]).valueOf()}function k(e){return function(t){for(let n=0;n<e.length;n++)t=e[n].call(this,t);return t}}function L(e){return e.replace(/\s+/g," ").trim()}function _(e){if(!e)return[];let t=n().map(e.split(","),(e=>e.trim()));return t=n().map(t,(e=>{var t,n;const r=e.split(":");return{tag:null===(t=r[0])||void 0===t?void 0:t.trim(),value:null===(n=r[1])||void 0===n?void 0:n.trim()}})),t}function M(e){const t={tag:"",value:""},n=e.indexOf(":");return n>0?(t.tag=e.slice(0,n).trim(),t.value=e.slice(Math.min(n+1,e.length)).trim()):t.tag=e.trim(),t}function q(e){return e.value?`${e.tag}: ${e.value}`:e.tag}function V(e){return e||[]}const B={"%":"percent",b:"decbits",bps:"bps",B:"bytes",Bps:"binBps",uptime:"dtdhms",qps:"qps",iops:"iops",Hz:"hertz",V:"volt",C:"celsius",RPM:"rotrpm",dBm:"dBm"},H=(()=>{const t={},n=(0,e.getValueFormats)();for(const e of n)for(const n of e.submenu){const e=n.value;t[e]=e}return t})();function z(e){let t=B[e];return t||(t=H[e]),t}function W(e,t,n){if(null===e||e.length<2||n>e.length-1||n<0||t>e.length-1||t<0)return e;const r=new Array(e.length);for(let i=0;i<e.length;i++)r[i]=i===t?e[n]:i===n?e[t]:e[i];return r}function U(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function G(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){U(e,t,n[t])}))}return e}function Q(e){return e.resultFormat=e.resultFormat||"time_series",function(e){return!(e.mode&&0!==e.mode&&2!==e.mode||!(e.hostFilter||e.itemFilter||e.downsampleFunction||e.host&&e.host.host)||void 0!==e.item.filter||void 0!==e.host.filter)}(e=function(e){return e.group&&Array.isArray(e.group)&&(e.group={filter:""}),e}(e))?function(e){return e.group.filter="*"===e.group.name?"/.*/":e.group.name,e.host.filter="*"===e.host.name?J(e.hostFilter):e.host.name,e.application.filter="*"===e.application.name?"":e.application.name,e.item.filter="All"===e.item.name?J(e.itemFilter):e.item.name,e.macro.filter="*"===e.macro.macro?J(e.macroFilter):e.macro.macro,e}(e):(function(e){if(e.functions)for(const t of e.functions)t.def&&"percentil"===t.def.name&&(t.def.name="percentile")}(e),function(e){var t;void 0===e.queryType&&("Metrics"===e.mode?e.queryType=c:void 0!==e.mode&&(e.queryType=e.mode,delete e.mode)),"number"==typeof e.queryType&&(e.queryType=null===(t=e.queryType)||void 0===t?void 0:t.toString())}(e),function(e){e.queryType!==u||e.slaInterval||(e.slaInterval="none")}(e),function(e){var t;"priority"===(null===(t=e.options)||void 0===t?void 0:t.sortProblems)&&(e.options.sortProblems="severity")}(e),function(e){var t,n;e.itemTag||(e.itemTag={filter:""},(null===(t=e.application)||void 0===t?void 0:t.filter)&&(e.itemTag.filter=`Application: ${null===(n=e.application)||void 0===n?void 0:n.filter}`))}(e),function(e){var t,n;(null===(t=e.slaProperty)||void 0===t?void 0:t.property)&&(e.slaProperty=null===(n=e.slaProperty)||void 0===n?void 0:n.property)}(e),function(e){var t,n,r,i;(null===(t=e.triggers)||void 0===t?void 0:t.minSeverity)&&(e.options.minSeverity=null===(r=e.triggers)||void 0===r?void 0:r.minSeverity,delete e.triggers.minSeverity),(null===(n=e.triggers)||void 0===n?void 0:n.count)&&(e.options.count=null===(i=e.triggers)||void 0===i?void 0:i.count,delete e.triggers.count)}(e),function(e){e.schema>=11||("6"===e.queryType?(e.queryType=m,e.countTriggersBy="items"):"7"===e.queryType?(e.queryType=m,e.countTriggersBy="problems"):"8"===e.queryType&&(e.queryType=v))}(e),function(e){var t;e.schema>=12||(null==e||null===(t=e.options)||void 0===t?void 0:t.minSeverity)&&(e.options.severities=[0,1,2,3,4,5].filter((t=>t>=e.options.minSeverity)))}(e),e.schema=12,e)}function J(e){return e?"/"+e+"/":"/.*/"}const X=e=>{var t;const n=(e=>{var t,n,r,i,a,o,l,s;return{group:{filter:null!==(t=e.group)&&void 0!==t?t:""},host:{filter:null!==(n=e.host)&&void 0!==n?n:""},application:{filter:null!==(r=e.application)&&void 0!==r?r:""},trigger:{filter:null!==(i=e.trigger)&&void 0!==i?i:""},options:{minSeverity:null!==(a=e.minseverity)&&void 0!==a?a:0,showOkEvents:null!==(o=e.showOkEvents)&&void 0!==o&&o,hideAcknowledged:null!==(l=e.hideAcknowledged)&&void 0!==l&&l,showHostname:null!==(s=e.showHostname)&&void 0!==s&&s}}})(e);return e.target=(r=G({},n,e.target),i=null!=(i={fromAnnotations:!0,options:G({},n.options,null===(t=e.target)||void 0===t?void 0:t.options)})?i:{},Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(i)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n.push.apply(n,r)}return n}(Object(i)).forEach((function(e){Object.defineProperty(r,e,Object.getOwnPropertyDescriptor(i,e))})),r),e;var r,i};function Z(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}const Y={},K={Transform:[],Aggregate:[],Filter:[],Trends:[],Time:[],Alias:[],Special:[]};function ee(e){e.params=e.params||[],e.defaultParams=e.defaultParams||[],e.category&&K[e.category].push(e),Y[e.name]=e,Y[e.shortName||e.name]=e}ee({name:"groupBy",category:"Transform",params:[{name:"interval",type:"string"},{name:"function",type:"string",options:["avg","min","max","sum","count","median","first","last"]}],defaultParams:["1m","avg"]}),ee({name:"scale",category:"Transform",params:[{name:"factor",type:"float",options:[100,.01,10,-1]}],defaultParams:[100]}),ee({name:"offset",category:"Transform",params:[{name:"delta",type:"float",options:[-100,100]}],defaultParams:[100]}),ee({name:"delta",category:"Transform",params:[],defaultParams:[]}),ee({name:"rate",category:"Transform",params:[],defaultParams:[]}),ee({name:"movingAverage",category:"Transform",params:[{name:"factor",type:"int",options:[6,10,60,100,600]}],defaultParams:[10]}),ee({name:"exponentialMovingAverage",category:"Transform",params:[{name:"smoothing",type:"float",options:[6,10,60,100,600]}],defaultParams:[.2]}),ee({name:"percentile",category:"Transform",params:[{name:"interval",type:"string"},{name:"percent",type:"float",options:[25,50,75,90,95,99,99.9]}],defaultParams:["1m",95]}),ee({name:"removeAboveValue",category:"Transform",params:[{name:"number",type:"float"}],defaultParams:[0]}),ee({name:"removeBelowValue",category:"Transform",params:[{name:"number",type:"float"}],defaultParams:[0]}),ee({name:"transformNull",category:"Transform",params:[{name:"number",type:"float"}],defaultParams:[0]}),ee({name:"aggregateBy",category:"Aggregate",params:[{name:"interval",type:"string"},{name:"function",type:"string",options:["avg","min","max","sum","count","median","first","last"]}],defaultParams:["1m","avg"]}),ee({name:"sumSeries",category:"Aggregate",params:[],defaultParams:[]}),ee({name:"percentileAgg",category:"Aggregate",params:[{name:"interval",type:"string"},{name:"percent",type:"float",options:[25,50,75,90,95,99,99.9]}],defaultParams:["1m",95]}),ee({name:"top",category:"Filter",params:[{name:"number",type:"int"},{name:"value",type:"string",options:["avg","min","max","sum","count","median","first","last"]}],defaultParams:[5,"avg"]}),ee({name:"bottom",category:"Filter",params:[{name:"number",type:"int"},{name:"value",type:"string",options:["avg","min","max","sum","count","median","first","last"]}],defaultParams:[5,"avg"]}),ee({name:"sortSeries",category:"Filter",params:[{name:"direction",type:"string",options:["asc","desc"]}],defaultParams:["asc"]}),ee({name:"trendValue",category:"Trends",params:[{name:"type",type:"string",options:["avg","min","max","sum","count"]}],defaultParams:["avg"]}),ee({name:"timeShift",category:"Time",params:[{name:"interval",type:"string",options:["24h","7d","1M","+24h","-24h"]}],defaultParams:["24h"]}),ee({name:"setAlias",category:"Alias",params:[{name:"alias",type:"string"}],defaultParams:[]}),ee({name:"setAliasByRegex",category:"Alias",params:[{name:"aliasByRegex",type:"string"}],defaultParams:[]}),ee({name:"replaceAlias",category:"Alias",params:[{name:"regexp",type:"string"},{name:"newAlias",type:"string"}],defaultParams:["/(.*)/","$1"]}),ee({name:"consolidateBy",category:"Special",params:[{name:"type",type:"string",options:["avg","min","max","sum","count"]}],defaultParams:["avg"]}),n().each(K,((e,t)=>{K[t]=n().sortBy(e,"name")}));class te{bindFunction(e){const t=e[this.def.name];if(t){let e,r=t;for(let t=0;t<this.params.length;t++)e=this.params[t],"int"!==this.def.params[t].type&&"float"!==this.def.params[t].type||(e=Number(e)),r=n().partial(r,e);return r}throw{message:"Method not found "+this.def.name}}render(e){const t=this.def.name+"(",r=n().map(this.params,((e,t)=>{const n=this.def.params[t].type;return"int"===n||"float"===n||"value_or_series"===n||"boolean"===n||"int_or_interval"===n&&(r=e,!isNaN(parseFloat(r))&&isFinite(r))?e:"'"+e+"'";var r}));return e&&r.unshift(e),t+r.join(", ")+")"}_hasMultipleParamsInString(e,t){return-1!==e.indexOf(",")&&this.def.params[t+1]&&this.def.params[t+1].optional}updateParam(e,t){this._hasMultipleParamsInString(e,t)?n().each(e.split(","),((e,t)=>{this.updateParam(e.trim(),t)})):(""===e&&this.def.params[t].optional?this.params.splice(t,1):this.params[t]=e,this.updateText())}updateText(){if(0===this.params.length)return void(this.text=this.def.name+"()");let e=this.def.name+"(";e+=this.params.join(", "),e+=")",this.text=e}constructor(e,t){Z(this,"def",void 0),Z(this,"params",void 0),Z(this,"text",void 0),Z(this,"added",void 0),this.def=e,t?this.params=t:(this.params=[],this.params=e.defaultParams.slice(0)),this.updateText()}}function ne(e,t){if(n().isString(e)){if(!Y[e])throw{message:"Method not found "+name};e=Y[e]}return new te(e,t)}function re(){return K}var ie=g(3545);function ae(e,t){return new RegExp(t).exec(e)[0]}const oe={timeShift:function(e,t){const r=function(e){const t=/^([\+\-]*)([\d]+)(y|M|w|d|h|m|s)/g.exec(e);let n=0;return n="+"===t[1]?0-s().duration(Number(t[2]),t[3]).valueOf():s().duration(Number(t[2]),t[3]).valueOf(),n}(e)/1e3;return n().map(t,(e=>e-r))},setAlias:function(t,n){var r;if((null===(r=n.fields)||void 0===r?void 0:r.length)<=2){var i,a;const r=n.fields.find((t=>t.name===e.TIME_SERIES_VALUE_FIELD_NAME));var o,l;return(null==r||null===(a=r.config)||void 0===a||null===(i=a.custom)||void 0===i?void 0:i.scopedVars)&&(t=(0,ie.getTemplateSrv)().replace(t,null==r||null===(l=r.config)||void 0===l||null===(o=l.custom)||void 0===o?void 0:o.scopedVars)),r&&(r.config.displayNameFromDS=t),n.name=t,n}for(let r=0;r<n.fields.length;r++){const i=n.fields[r];var s,c,u,d;if(i.type!==e.FieldType.time)(null==i||null===(c=i.config)||void 0===c||null===(s=c.custom)||void 0===s?void 0:s.scopedVars)&&(t=(0,ie.getTemplateSrv)().replace(t,null==i||null===(d=i.config)||void 0===d||null===(u=d.custom)||void 0===u?void 0:u.scopedVars)),i.config.displayNameFromDS=t}return n},setAliasByRegex:function(t,n){var r;if((null===(r=n.fields)||void 0===r?void 0:r.length)<=2){const r=n.fields.find((t=>t.name===e.TIME_SERIES_VALUE_FIELD_NAME));try{var i;r&&(r.config.displayNameFromDS=ae(null===(i=r.config)||void 0===i?void 0:i.displayNameFromDS,t)),n.name=ae(n.name,t)}catch(e){console.error("Failed to apply RegExp:",(null==e?void 0:e.message)||e)}return n}for(const r of n.fields)if(r.type!==e.FieldType.time)try{var a;r.config.displayNameFromDS=ae(null===(a=r.config)||void 0===a?void 0:a.displayNameFromDS,t)}catch(e){console.error("Failed to apply RegExp:",(null==e?void 0:e.message)||e)}return n},replaceAlias:function(t,n,r){var i;let a;if(a=D(t)?F(t):t,(null===(i=r.fields)||void 0===i?void 0:i.length)<=2){var o;let t=r.name.replace(a,n);const i=r.fields.find((t=>t.name===e.TIME_SERIES_VALUE_FIELD_NAME));var l;return(null==i||null===(o=i.state)||void 0===o?void 0:o.scopedVars)&&(t=(0,ie.getTemplateSrv)().replace(t,null==i||null===(l=i.state)||void 0===l?void 0:l.scopedVars)),i&&(i.config.displayNameFromDS=t),r.name=t,r}for(const t of r.fields)if(t.type!==e.FieldType.time){var s,c,u;let e=null===(c=t.config)||void 0===c||null===(s=c.displayNameFromDS)||void 0===s?void 0:s.replace(a,n);var d;(null==t||null===(u=t.state)||void 0===u?void 0:u.scopedVars)&&e&&(e=(0,ie.getTemplateSrv)().replace(e,null==t||null===(d=t.state)||void 0===d?void 0:d.scopedVars)),t.name=e||t.name}return r}},le={get metricFunctions(){return oe}};var se=g(4745),ce=g.n(se);function ue(e,t,r,i){const a=n().groupBy(e,"itemid"),o=n().uniqBy(n().flatten(n().map(t,"hosts")),"hostid");return n().map(a,((e,a)=>{const l=n().find(t,{itemid:a});let s=l.name;const c={__zbx_item:{value:l.name},__zbx_item_name:{value:l.name},__zbx_item_key:{value:l.key_},__zbx_item_interval:{value:l.delay}};if(n().keys(o).length>0){const e=n().find(o,{hostid:l.hostid});c.__zbx_host={value:e.host},c.__zbx_host_name={value:e.name},n().keys(o).length>1&&r&&(s=e.name+": "+s)}return{target:s,datapoints:n().map(e,i),scopedVars:c,item:l}}))}function de(e,t){let n=t.value;return e.textFilter&&(n=pe(t.value,e.textFilter,e.useCaptureGroups)),[n,1e3*t.clock+Math.round(t.ns/1e6)]}function pe(e,t,n){const r=new RegExp(t).exec(e);return r?n?r[1]:r[0]:""}function me(e){switch(e){case"sla":return"sli";case"okTime":return"uptime";case"downtimeTime":return"downtime";default:return e}}function he(e){return[Number(e.value),1e3*e.clock+Math.round(e.ns/1e6)]}function ge(e,t){let n;switch(e){case"min":n=t.value_min;break;case"max":n=t.value_max;break;case"avg":default:n=t.value_avg;break;case"sum":n=t.value_avg*t.num;break;case"count":n=t.num}return[Number(n),1e3*t.clock]}const fe=function(e,t,n=!0){return ue(e,t,n,he)},ve=function(e,t,r,i=!0){return ue(e,t,i,n().partial(ge,r))},be=function(e,t,r,i=!0){return ue(e,t,i,n().partial(de,r))},ye=function(t,n){const r=new e.MutableDataFrame({refId:n.refId,name:"macros",fields:[{name:"Host",type:e.FieldType.string},{name:"Macros",type:e.FieldType.string},{name:e.TIME_SERIES_VALUE_FIELD_NAME,type:e.FieldType.string}]});for(let n=0;n<t.length;n++){const i=t[n],a={Host:i.hosts[0].name,Macros:i.macro,[e.TIME_SERIES_VALUE_FIELD_NAME]:i.value};r.add(a)}return r},Ee=function(e,t,r){const i=new(ce());i.addColumn({text:"Host"}),i.addColumn({text:"Item"}),i.addColumn({text:"Key"}),i.addColumn({text:"Last value"});const a=n().groupBy(e,"itemid");return n().each(t,(e=>{const t=a[e.itemid]||[],o=n().last(t);let l=o?o.value:null;if(r.options.skipEmptyValues&&(!l||""===l))return;r.textFilter&&(l=pe(l,r.textFilter,r.useCaptureGroups));let s=n().first(e.hosts);s=s?s.name:"",i.rows.push([s,e.name,e.key_,l])})),i},Oe=function(e,t,n){const r=n[e.serviceid].sla;if("status"===t){const i=parseInt(n[e.serviceid].status,10);return{target:e.name+" "+t,datapoints:[[i,1e3*r[0].to]]}}{let n;const i=[];for(n=0;n<r.length;n++)0===n&&i.push([r[n][t],1e3*r[n].from]),i.push([r[n][t],1e3*r[n].to]);return{target:e.name+" "+t,datapoints:i}}},we=function(t,r,i,a){if(n().isArray(t)){const i=function(e){const t=n().uniq(n().flattenDeep(n().map(e,(e=>n().map(e.groups,"name"))))),r={};return n().each(t,(e=>{r[e]={0:0,1:0,2:0,3:0,4:0,5:0}})),n().each(e,(e=>{n().each(e.groups,(t=>{r[t.name][e.priority]++}))})),r}(t),o=new e.MutableDataFrame({name:`Triggers ${a.refId}`,refId:a.refId,fields:[{name:"Host group",type:e.FieldType.string,values:new e.ArrayVector}]});for(let t=b.length-1;t>=0;t--)o.fields.push({name:b[t].text,type:e.FieldType.number,config:{unit:"none",decimals:0},values:new e.ArrayVector});const l=null==r?void 0:r.map((e=>e.name));return null==l||l.forEach((e=>{o.add({"Host group":e,Disaster:i[e]?i[e][5]:0,High:i[e]?i[e][4]:0,Average:i[e]?i[e][3]:0,Warning:i[e]?i[e][2]:0,Information:i[e]?i[e][1]:0,"Not classified":i[e]?i[e][0]:0})})),o}{let n=null;try{n=Number(t)}catch(e){console.log("Error when handling triggers count: ",e)}return new e.MutableDataFrame({name:`Count ${a.refId}`,refId:a.refId,fields:[{name:e.TIME_SERIES_TIME_FIELD_NAME,type:e.FieldType.time,values:new e.ArrayVector([1e3*i[1]])},{name:e.TIME_SERIES_VALUE_FIELD_NAME,type:e.FieldType.number,values:new e.ArrayVector([n])}],length:1})}},Ie=function(e){return n().forEach(e,(e=>{e.datapoints=n().sortBy(e.datapoints,(e=>e[1]))})),e},Te=function(t,n,r,i){const{datapoints:a,scopedVars:o,target:l,item:s}=t,c={name:e.TIME_SERIES_TIME_FIELD_NAME,type:e.FieldType.time,config:{custom:{}},values:new e.ArrayVector(a.map((e=>e[1])))};let u;e.FieldType.string,u=new e.ArrayVector(a.map((e=>e[0])));const d={name:e.TIME_SERIES_VALUE_FIELD_NAME,type:null!=i?i:e.FieldType.number,labels:{},config:{displayNameFromDS:l,custom:{}},values:u};var p,m,h,g,f;if(o&&(c.config.custom={itemInterval:null===(p=o.__zbx_item_interval)||void 0===p?void 0:p.value},d.labels={host:null===(m=o.__zbx_host_name)||void 0===m?void 0:m.value,item:null===(h=o.__zbx_item)||void 0===h?void 0:h.value,item_key:null===(g=o.__zbx_item_key)||void 0===g?void 0:g.value},d.config.custom={itemInterval:null===(f=o.__zbx_item_interval)||void 0===f?void 0:f.value}),s){var v;const t=z(s.units);t&&(console.log(`Datasource: unit detected: ${t} (${s.units})`),d.config.unit=t,"percent"===t&&(d.config.min=0,d.config.max=100));const i=function(t,n){const{valuemapid:r}=t,i=null==n?void 0:n.find((e=>e.valuemapid===r));return i?i.mappings.map(((t,n)=>({type:e.MappingType.ValueToText,options:{value:t.value,text:t.newvalue}}))):null}(s,r);i&&(null===(v=n.options)||void 0===v?void 0:v.useZabbixValueMapping)&&(console.log("Datasource: using Zabbix value mapping"),d.config.mappings=i)}const b=[c,d],y={name:l,refId:n.refId,fields:b,length:a.length};return new e.MutableDataFrame(y)},xe=function(t,r,i){const a=[];if(0===t.length)return[];for(const l of t){const t=(0,e.dataFrameFromJSON)(l),{timeField:s,timeIndex:c}=(0,e.getTimeField)(t);for(let e=0;e<t.fields.length;e++){var o;const l=t.fields[e];if(e===c||!l.values||!l.values.length)continue;const u=[];for(let e=0;e<l.values.length;e++){const t=l.values.get(e);null!==t&&u.push({time:s.values.get(e)/1e3,value:t})}const d=l.name,p=n().find(r,{itemid:d});let m=1e6*i.intervalMs;const h=1e6*$(p.delay);m=Math.max(m,h),0===m&&(m=null);let g=p.name;(null===(o=p.hosts)||void 0===o?void 0:o.length)>0&&(g=`${p.hosts[0].name}: ${g}`);const f={ts:u,meta:{name:g,item:p,interval:m}};a.push(f)}}return a},Pe=function(e,t){const n=[];if(0===e.length)return[];for(const r of e){const e=[];if(!r.datapoints)continue;const i=r.datapoints;for(let t=0;t<i.length;t++)e.push({time:i[t][1]/1e3,value:i[t][0]});let a=1e6*$(t);0===a&&(a=null);const o={ts:e,meta:{name:r.target,interval:null,item:{}}};n.push(o)}return n},Se=function(t){if(!t||t.length<2)return!1;const n=t[0].fields.find((t=>t.type===e.FieldType.time));if(!n)return!1;for(let r=1;r<t.length;r++){const i=t[r].fields.find((t=>t.type===e.FieldType.time));for(let e=0;e<Math.min(t.length,2);e++)if(i.values.get(e)!==n.values.get(e))return!1}return!0},Ae=function(t){const n=function(t){let n=0,r=0;for(let i=0;i<t.length;i++){const a=t[i].fields.find((t=>t.type===e.FieldType.time));a.values.length>r&&(r=a.values.length,n=i)}return n}(t),r=t[n].fields.find((t=>t.type===e.FieldType.time));if(!r)return[];const i=[r];for(let n=0;n<t.length;n++){const a=t[n].fields.find((t=>t.name===e.TIME_SERIES_VALUE_FIELD_NAME));a&&(a.name=t[n].name,r.values.length-a.values.length==1&&a.values.add(null),i.push(a))}return[{name:"wide",fields:i,length:r.values.length}]},Ce=function(t){if(!t||0===t.length)return t;let n=t[0].fields.find((t=>t.name===e.TIME_SERIES_TIME_FIELD_NAME)).values.get(0);for(let r=0;r<t.length;r++){const i=t[r].fields.find((t=>t.name===e.TIME_SERIES_TIME_FIELD_NAME)).values.get(0);i<n&&(n=i)}for(let i=0;i<t.length;i++){const a=t[i],o=a.fields.find((t=>t.name===e.TIME_SERIES_TIME_FIELD_NAME)),l=a.fields.find((t=>t.name===e.TIME_SERIES_VALUE_FIELD_NAME)),s=o.values.get(0);if(s>n){var r;console.log("Data frames: adding missing points");let t=o.values.toArray(),i=l.values.toArray();const a=[],c=[],u=null===(r=o.config.custom)||void 0===r?void 0:r.itemInterval;for(let e=n;e<s;e+=u)a.push(e),c.push(null);t=a.concat(t),i=c.concat(i),o.values=new e.ArrayVector(t),l.values=new e.ArrayVector(i)}}return t},De=function(e){for(let n=0;n<e.data.length;n++){const r=e.data[n];for(const e of r.fields){var t;const n=null===(t=e.config.custom)||void 0===t?void 0:t.units;if(n){const t=z(n);t&&(e.config.unit=t,"percent"===t&&(e.config.min=0,e.config.max=100))}}}return e};function je(e,t){const n=[];for(let r=0;r<e.length;r++){const i=e[r],a=t[Number(i.objectid)];if(a){const e={timestamp:Number(i.clock),triggerid:i.objectid,eventid:i.eventid,name:i.name,severity:i.severity,acknowledged:i.acknowledged,acknowledges:i.acknowledges,tags:i.tags,suppressed:i.suppressed,suppression_data:i.suppression_data,description:i.name||a.description,comments:a.comments,value:a.value,opdata:i.opdata,groups:a.groups,hosts:a.hosts,items:a.items,alerts:a.alerts,url:a.url,expression:a.expression,correlation_mode:a.correlation_mode,correlation_tag:a.correlation_tag,manual_close:a.manual_close,state:a.state,error:a.error};n.push(e)}}return n}function Fe(e,t,n){const{valueFromEvent:r}=n,i=[];for(let n=0;n<e.length;n++){const a=e[n],o=t[Number(a.objectid)];if(o){const e={value:r?a.value:o.value,timestamp:Number(a.clock),triggerid:a.objectid,eventid:a.eventid,name:a.name,severity:a.severity,acknowledged:a.acknowledged,acknowledges:a.acknowledges,tags:a.tags,suppressed:a.suppressed,description:o.description,comments:o.comments,groups:o.groups,hosts:o.hosts,items:o.items,alerts:o.alerts,url:o.url,expression:o.expression,correlation_mode:o.correlation_mode,correlation_tag:o.correlation_tag,manual_close:o.manual_close,state:o.state,error:o.error};i.push(e)}}return i}const Re=function(e,t){return n().each(e,(e=>{e.datasource=t.datasource})),e},$e=function(e,t){return e.forEach((e=>{if(e.hosts&&e.hosts.length){const n=e.hosts[0],r=n.proxyid||n.proxy_hostid;if("0"!==r){const e=t[r];n.proxy=e?e.host:""}}})),e},Ne=function(t,n){if(n)return t.forEach((t=>{var r;if(null===(r=t.acknowledges)||void 0===r?void 0:r.length)for(let r=0;r<t.acknowledges.length;r++){const i=t.acknowledges[r];let a=n[i.userid];a||"1"!==i.userid||(a={username:"Admin"}),i.user=(null==a?void 0:a.username)||"",i.name=(null==a?void 0:a.name)||"",i.surname=(null==a?void 0:a.surname)||"";const o=1e3*Number(i.clock);isNaN(o)||(i.time=(0,e.dateTime)(o).format("YYYY-MM-DD HH:mm:ss"))}})),t},ke=function(e){return n().each(e,(e=>{e.hostInMaintenance=n().some(e.hosts,(e=>"1"===e.maintenance_status)),e.maintenance=!1,"1"===e.suppressed&&(e.maintenance=!0)})),e},Le=function(e,t){return n().each(e,(e=>{e.showAckButton=t})),e},_e=function(e,t){const r=t.trigger.filter;return r&&(e=function(e,t){return D(t)?n().filter(e,(e=>F(t).test(e.description))):n().filter(e,(e=>e.description===t))}(e,r)),t.options.hostsInMaintenance||(e=n().filter(e,(e=>!e.maintenance))),e},Me=function(e,t){var r,i;return"severity"===(null===(r=t.options)||void 0===r?void 0:r.sortProblems)?e=n().orderBy(e,["severity","eventid"],["desc","desc"]):"lastchange"===(null===(i=t.options)||void 0===i?void 0:i.sortProblems)&&(e=n().orderBy(e,["timestamp","eventid"],["desc","desc"])),e},qe=function(t,n){const r={name:"Problems",type:e.FieldType.other,values:new e.ArrayVector(t),config:{custom:{type:"problems"}}};return{name:"problems",refId:(null==n?void 0:n.refId)||"A",fields:[r],length:t.length}};var Ve=g(8873),Be=g.n(Ve);function He(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class ze{cacheRequest(e,t,n){return function(e,t,n,r){return function(){r.cache[t]||(r.cache[t]={});const i=r.cache[t],a=We(arguments);return r.cacheEnabled&&!r._isExpired(i[a])?Promise.resolve(i[a].value):e.apply(n,arguments).then((e=>(void 0!==e&&(i[a]={value:e,timestamp:Date.now()}),e)))}}(e,t,n,this)}proxify(e,t,n){return this.promises[t]||(this.promises[t]={}),function(e,t,n){return function(){const r=We(arguments);return t[r]||(t[r]=Promise.resolve(e.apply(n,arguments).then((e=>(t[r]=null,e))).catch((e=>{throw t[r]=null,e})))),t[r]}}(e,this.promises[t],n)}proxifyWithCache(e,t,n){const r=this.proxify(e,t,n);return this.cacheRequest(r,t,n)}_isExpired(e){if(e){const t=Date.now()-e.timestamp;return!(e.timestamp&&t<this.ttl)}return!0}constructor(e){He(this,"cacheEnabled",void 0),He(this,"ttl",void 0),He(this,"cache",void 0),He(this,"promises",void 0),this.cacheEnabled=e.enabled,this.ttl=e.ttl||6e5,this.cache={},this.promises={}}}function We(e){try{return"object"==typeof e&&(e=Array.from(e||{}).filter((e=>{var t;return!Boolean(null==e||null===(t=e.scopedVars)||void 0===t?void 0:t.__sceneObject)}))),Ue(JSON.stringify(e))}catch(t){return console.error("failing to get the request hash for caching. type of args "+typeof e),Ue(crypto.randomUUID())}}function Ue(e){let t,n,r,i=0;if(0!==e.length)for(t=0,r=e.length;t<r;t++)n=e.charCodeAt(t),i=(i<<5)-i+n,i|=0;return i}function Ge(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}const Qe={0:"history",1:"history_str",2:"history_log",3:"history_uint",4:"history_text"},Je={0:"trends",3:"trends_uint"},Xe={avg:"value_avg",min:"value_min",max:"value_max",sum:"num*value_avg"};class Ze{static loadDatasource(e,t){if(!t&&void 0!==e){const r=n().find((0,ie.getDataSourceSrv)().getList(),{id:e});if(!r)return Promise.reject(`Data Source with ID ${e} not found`);t=r.name}return t?(0,ie.getDataSourceSrv)().get(t):Promise.reject("Data Source name should be specified")}loadDBDataSource(){return Ze.loadDatasource(this.datasourceId,this.datasourceName).then((e=>(this.datasourceTypeId=e.meta.id,this.datasourceName||(this.datasourceName=e.name),this.datasourceId||(this.datasourceId=e.id),e)))}constructor(e){Ge(this,"datasourceId",void 0),Ge(this,"datasourceName",void 0),Ge(this,"datasourceTypeId",void 0),this.datasourceId=e.datasourceId,this.datasourceName=e.datasourceName,this.datasourceTypeId=null}}const Ye={DBConnector:Ze,DEFAULT_QUERY_LIMIT:1e4,HISTORY_TO_TABLE_MAP:Qe,TREND_TO_TABLE_MAP:Je,consolidateByFunc:{avg:"AVG",min:"MIN",max:"MAX",sum:"SUM",count:"COUNT"},consolidateByTrendColumns:Xe};var Ke,et,tt=g(7399),nt=g.n(tt);function rt(e,t,n,r,i,a,o){try{var l=e[a](o),s=l.value}catch(e){return void n(e)}l.done?t(s):Promise.resolve(s).then(r,i)}function it(e){return function(){var t=this,n=arguments;return new Promise((function(r,i){var a=e.apply(t,n);function o(e){rt(a,r,i,o,l,"next",e)}function l(e){rt(a,r,i,o,l,"throw",e)}o(void 0)}))}}function at(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}!function(e){e.Problems="problems",e.Recent="recent",e.History="history"}(Ke||(Ke={})),function(e){e.AndOr="0",e.Or="2"}(et||(et={}));const ot="3.0.0",lt=(null===e.rangeUtil||void 0===e.rangeUtil?void 0:e.rangeUtil.roundInterval)||nt().roundInterval||nt().round_interval;class st{request(e,t){return this.version?this.backendAPIRequest(e,t):this.initVersion().then((()=>this.request(e,t)))}backendAPIRequest(e,t={}){var n=this;return it((function*(){var r;const i={url:n.backendAPIUrl,method:"POST",headers:{"Content-Type":"application/json"},hideFromInspector:!1,data:{datasourceId:n.datasourceId,method:e,params:t}};(n.requestOptions.basicAuth||n.requestOptions.withCredentials)&&(i.withCredentials=!0),n.requestOptions.basicAuth&&(i.headers.Authorization=n.requestOptions.basicAuth);const a=yield(0,ie.getBackendSrv)().fetch(i).toPromise();return null==a||null===(r=a.data)||void 0===r?void 0:r.result}))()}getVersion(){return this.backendAPIRequest("apiinfo.version")}initVersion(){return this.version?Promise.resolve(this.version):(this.getVersionPromise||(this.getVersionPromise=Promise.resolve(this.getVersion().then((e=>(e?console.log(`Zabbix version detected: ${e}`):console.log(`Failed to detect Zabbix version, use default ${ot}`),this.version=e||ot,this.getVersionPromise=null,e))))),this.getVersionPromise)}isZabbix54OrHigher(){return Be().gte(this.version,"5.4.0")}acknowledgeEvent(e,t,n,r){n||(n=Be().gte(this.version,"4.0.0")?4:0);const i={eventids:e,message:t,action:n};return void 0!==r&&(i.severity=r),this.request("event.acknowledge",i)}getGroups(){return this.request("hostgroup.get",{output:["name","groupid"],sortfield:"name",real_hosts:!0})}getHosts(e){const t={output:["hostid","name","host"],sortfield:"name"};return e&&(t.groupids=e),this.request("host.get",t)}getApps(e){var t=this;return it((function*(){if(t.isZabbix54OrHigher())return[];const n={output:"extend",hostids:e};return t.request("application.get",n)}))()}getItems(e,t,n,r){const i={output:["itemid","name","key_","value_type","hostid","status","state","units","valuemapid","delay"],sortfield:"name",webitems:!0,filter:{},selectHosts:["hostid","name","host"]};if(e&&(i.hostids=e),t&&(i.applicationids=t),"num"===n&&(i.filter.value_type=[0,3]),"text"===n&&(i.filter.value_type=[1,2,4]),this.isZabbix54OrHigher()&&(i.selectTags="extend",r)){const e=r.split(",");let t=[];for(let n=0;n<e.length;n++){const r=M(e[n]);t.push({tag:r.tag,value:r.value,operator:"1"})}i.tags=t,i.evaltype=2}return this.request("item.get",i).then(x)}getItemsByIDs(e){const t={itemids:e,output:["itemid","name","key_","value_type","hostid","status","state","units","valuemapid","delay"],webitems:!0,selectHosts:["hostid","name"]};return this.isZabbix54OrHigher()&&(t.selectTags="extend"),this.request("item.get",t).then((e=>x(e)))}getMacros(e){const t={output:"extend",hostids:e};return this.request("usermacro.get",t)}getUserMacros(e){const t={output:"extend",hostmacroids:e,selectHosts:["hostid","name"]};return this.request("usermacro.get",t)}getGlobalMacros(){return this.request("usermacro.get",{output:"extend",globalmacro:!0})}getLastValue(e){const t={output:["lastvalue"],itemids:e};return this.request("item.get",t).then((e=>e.length?e[0].lastvalue:null))}getHistory(e,t,r){const i=n().groupBy(e,"value_type"),a=n().map(i,((e,i)=>{const a={output:"extend",history:i,itemids:n().map(e,"itemid"),sortfield:"clock",sortorder:"ASC",time_from:t};return r&&(a.time_till=r),this.request("history.get",a)}));return Promise.all(a).then(n().flatten)}getTrend_ZBXNEXT1193(e,t,r){const i=n().groupBy(e,"value_type"),a=n().map(i,((e,i)=>{const a={output:"extend",trend:i,itemids:n().map(e,"itemid"),sortfield:"clock",sortorder:"ASC",time_from:t};return r&&(a.time_till=r),this.request("trend.get",a)}));return Promise.all(a).then(n().flatten)}getTrend_30(e,t,r,i){const a={output:["itemid","clock",i],itemids:n().map(e,"itemid"),time_from:t};return r&&(a.time_till=r),this.request("trend.get",a)}getITService(e){const t={output:"extend",serviceids:e};return this.request("service.get",t)}getServices(e){const t={output:"extend",serviceids:e};return this.request("service.get",t)}getSLAList(){return this.request("sla.get",{output:"extend"})}getSLA(e,t,n){const[r,i]=t;let a=[{from:r,to:i}];"auto"===n.slaInterval?a=dt(t,ut(n.intervalMs)):"none"!==n.slaInterval&&(a=dt(t,N(n.slaInterval)/1e3));const o={serviceids:e,intervals:a};return this.request("service.getsla",o)}getSLA60(e,t,n){var r=this;return it((function*(){const[i,a]=t;let o=[{from:i,to:a}];if("auto"===n.slaInterval){const e=ut(n.intervalMs);o=dt(t,e)}else if("none"!==n.slaInterval){const e=N(n.slaInterval)/1e3;o=dt(t,e)}const l={output:"extend",serviceids:e},s=yield r.request("sla.get",l);if(0===s.length)return{};const c={slaid:s[0].slaid,serviceids:e,period_from:i,period_to:a,periods:Math.min(o.length,100)},u=yield r.request("sla.getsli",c);if(0===u.length)return{};const d={};return u.serviceids.forEach((e=>{d[e]={sla:[]}})),u.sli.forEach(((e,t)=>{e.forEach(((e,n)=>{d[u.serviceids[n]].sla.push({downtimeTime:e.downtime,okTime:e.uptime,sla:e.sli,from:u.periods[t].period_from,to:u.periods[t].period_to})}))})),d}))()}getSLI(e,t,n,r){var i=this;return it((function*(){const[a,o]=n;let l=[{from:a,to:o}];if("auto"===r.slaInterval){const e=ut(r.intervalMs);l=dt(n,e)}else if("none"!==r.slaInterval){const e=N(r.slaInterval)/1e3;l=dt(n,e)}const s={slaid:e,serviceids:t,period_from:a,period_to:o,periods:Math.min(l.length,100)};return yield i.request("sla.getsli",s)}))()}getProblems(e,t,n,r){const{timeFrom:i,timeTo:a,recent:o,severities:l,limit:s,acknowledged:c,tags:u,evaltype:d}=r,p={output:"extend",selectAcknowledges:"extend",selectSuppressionData:"extend",selectTags:"extend",source:"0",object:"0",sortfield:["eventid"],sortorder:"DESC",evaltype:"0",groupids:e,hostids:t,applicationids:n,recent:o};return l&&(p.severities=l),void 0!==c&&(p.acknowledged=c),u&&(p.tags=u),d&&(p.evaltype=d),s&&(p.limit=s),(i||a)&&(p.time_from=i,p.time_till=a),this.request("problem.get",p).then(V)}getTriggersByIds(e){const t={output:"extend",triggerids:e,expandDescription:!0,expandData:!0,expandComment:!0,expandExpression:!0,monitored:!0,skipDependent:!0,selectGroups:["name","groupid"],selectHosts:["hostid","name","host","maintenance_status","description"],selectItems:["itemid","name","key_","lastvalue"],preservekeys:"1"};return Be().lt(this.version,"7.0.0")?t.selectHosts.push("proxy_hostid"):t.selectHosts.push("proxyid"),this.request("trigger.get",t).then(V)}getTriggers(e,t,n,r){const{showTriggers:i,maintenance:a,timeFrom:o,timeTo:l}=r,s={output:"extend",groupids:e,hostids:t,applicationids:n,expandDescription:!0,expandData:!0,expandComment:!0,monitored:!0,skipDependent:!0,filter:{value:1},selectGroups:["groupid","name"],selectHosts:["hostid","name","host","maintenance_status"],selectItems:["itemid","name","key_","lastvalue"],selectLastEvent:"extend",selectTags:"extend"};return Be().lt(this.version,"7.0.0")?s.selectHosts.push("proxy_hostid"):s.selectHosts.push("proxyid"),i===Ke.Problems?s.filter.value=1:i!==Ke.Recent&&i!==Ke.History||(s.filter.value=[0,1]),a&&(s.maintenance=!0),(o||l)&&(s.lastChangeSince=o,s.lastChangeTill=l),this.request("trigger.get",s)}getEvents(e,t,n,r,i){const a={output:"extend",time_from:t,time_till:n,objectids:e,select_acknowledges:"extend",selectHosts:"extend",value:r};return i&&(a.limit=i,a.sortfield="clock",a.sortorder="DESC"),this.request("event.get",a).then(V)}getEventsHistory(e,t,n,r){const{timeFrom:i,timeTo:a,severities:o,limit:l,value:s,tags:c,evaltype:u}=r,d={output:"extend",time_from:i,time_till:a,value:"1",source:"0",object:"0",evaltype:"0",sortfield:["eventid"],sortorder:"DESC",select_acknowledges:"extend",selectTags:"extend",selectSuppressionData:["maintenanceid","suppress_until"],groupids:e,hostids:t,applicationids:n};return l&&(d.limit=l),o&&(d.severities=o),s&&(d.value=s),c&&(d.tags=c),u&&(d.evaltype=u),this.request("event.get",d).then(V)}getExtendedEventData(e){const t={output:"extend",eventids:e,preservekeys:!0,select_acknowledges:"extend",selectTags:"extend",sortfield:"clock",sortorder:"DESC"};return this.request("event.get",t)}getEventAlerts(e){const t={eventids:e,output:["alertid","eventid","message","clock","error"],selectUsers:"extend"};return this.request("alert.get",t)}getAcknowledges(e){const t={output:"extend",eventids:e,preservekeys:!0,select_acknowledges:"extend",sortfield:"clock",sortorder:"DESC"};return this.request("event.get",t).then((e=>n().filter(e,(e=>e.acknowledges.length))))}getAlerts(e,t,n){const r={output:"extend",itemids:e,expandDescription:!0,expandData:!0,expandComment:!0,monitored:!0,skipDependent:!0,selectLastEvent:"extend"};return(t||n)&&(r.lastChangeSince=t,r.lastChangeTill=n),this.request("trigger.get",r)}getHostAlerts(e,t,n){var r=this;return it((function*(){const{minSeverity:i,acknowledged:a,tags:o,count:l,timeFrom:s,timeTo:c}=n,u={output:"extend",hostids:e,min_severity:i,filter:{value:1},expandDescription:!0,expandData:!0,expandComment:!0,monitored:!0,skipDependent:!0,selectLastEvent:"extend",selectGroups:"extend",selectHosts:["hostid","host","name"]};l&&1!==a&&(u.countOutput=!0,0===a&&(u.withLastEventUnacknowledged=!0)),t&&t.length&&(u.applicationids=t),(s||c)&&(u.lastChangeSince=s,u.lastChangeTill=c),o&&(u.tags=o,u.evaltype=0);let d=yield r.request("trigger.get",u);return l&&1!==a||(d=ct(d,a),l&&(d=d.length)),d}))()}getHostICAlerts(e,t,n,r){const{minSeverity:i,acknowledged:a,count:o,timeFrom:l,timeTo:s}=r,c={output:"extend",hostids:e,min_severity:i,filter:{value:1},expandDescription:!0,expandData:!0,expandComment:!0,monitored:!0,skipDependent:!0,selectLastEvent:"extend",selectGroups:"extend",selectHosts:["host","name"],selectItems:["name","key_"]};return o&&1!==a&&(c.countOutput=!0,0===a&&(c.withLastEventUnacknowledged=!0)),t&&t.length&&(c.applicationids=t),n&&n.length&&(c.itemids=n),(l||s)&&(c.lastChangeSince=l,c.lastChangeTill=s),this.request("trigger.get",c).then((e=>(o&&1!==a||(e=ct(e,a),o&&(e=e.length)),e)))}getHostPCAlerts(e,t,n,r){const{minSeverity:i,acknowledged:a,count:o,timeFrom:l,timeTo:s}=r,c={output:"extend",hostids:e,triggerids:n,min_severity:i,filter:{value:1},expandDescription:!0,expandData:!0,expandComment:!0,monitored:!0,skipDependent:!0,selectLastEvent:"extend",selectGroups:"extend",selectHosts:["host","name"],selectItems:["name","key_"]};return o&&0!==a&&1!==a&&(c.countOutput=!0),t&&t.length&&(c.applicationids=t),(l||s)&&(c.lastChangeSince=l,c.lastChangeTill=s),this.request("trigger.get",c).then((e=>(o&&0!==a&&1!==a||(e=ct(e,a),o&&(e=e.length)),e)))}getProxies(){const e={output:["proxyid"]};return Be().lt(this.version,"7.0.0")?e.output.push("host"):e.output.push("name"),this.request("proxy.get",e)}getScripts(e,t){const n={output:"extend",hostids:e};return this.request("script.get",n).then(V)}executeScript(e,t){const n={hostid:e,scriptid:t};return this.request("script.execute",n)}getValueMappings(){return this.request("valuemap.get",{output:"extend",selectMappings:"extend"})}getUsers(){return this.request("user.get",{output:["userid","username","name","surname"]})}constructor(e,t,n){at(this,"backendAPIUrl",void 0),at(this,"requestOptions",void 0),at(this,"getTrend",void 0),at(this,"version",void 0),at(this,"getVersionPromise",void 0),at(this,"datasourceId",void 0),this.datasourceId=n,this.backendAPIUrl=`/api/datasources/${this.datasourceId}/resources/zabbix-api`,this.requestOptions={basicAuth:e,withCredentials:t},this.getTrend=this.getTrend_ZBXNEXT1193,this.initVersion()}}function ct(e,t){return 0===t?n().filter(e,(e=>"0"===e.lastEvent.acknowledged)):1===t?n().filter(e,(e=>"1"===e.lastEvent.acknowledged)):e}function ut(e){const t=lt(100*e)/1e3;return Math.max(t,3600)}function dt(e,t){let[n,r]=e;const i=[];n=Math.floor(n/t)*t,r=Math.ceil(r/t)*t;for(let e=n;e<=r-t;e+=t)i.push({from:e,to:e+t});return i}class pt{toString(){return this.name+" "+this.data}constructor(e){at(this,"code",void 0),at(this,"name",void 0),at(this,"data",void 0),at(this,"message",void 0),this.code=e.code||null,this.name=e.message||"",this.data=e.data||"",this.message="Zabbix API Error: "+this.name+" "+this.data}}const mt={historyQuery:function(e,t,n,r,i,a){const o=`clock DIV ${i} * ${i}`;return`\n      SELECT CAST(itemid AS CHAR) AS metric, ${o} AS time_sec, ${a}(value) AS value\n      FROM ${t}\n      WHERE itemid IN (${e})\n        AND clock\n          > ${n}\n        AND clock\n          < ${r}\n      GROUP BY ${o}, metric\n      ORDER BY time_sec ASC\n  `},trendsQuery:function(e,t,n,r,i,a,o){const l=`clock DIV ${i} * ${i}`;return`\n      SELECT CAST(itemid AS CHAR) AS metric, ${l} AS time_sec, ${a}(${o}) AS value\n      FROM ${t}\n      WHERE itemid IN (${e})\n        AND clock\n          > ${n}\n        AND clock\n          < ${r}\n      GROUP BY ${l}, metric\n      ORDER BY time_sec ASC\n  `},testQuery:function(){return"SELECT CAST(itemid AS CHAR) AS metric, clock AS time_sec, value_avg AS value\n          FROM trends_uint LIMIT 1"}},ht="FM99999999999999999999",gt=`\n    SELECT to_char(itemid, '${ht}') AS metric, clock AS time, value_avg AS value\n    FROM trends_uint LIMIT 1\n`,ft={historyQuery:function(e,t,n,r,i,a){return`\n      SELECT to_char(itemid, '${ht}') AS metric, clock / ${i} * ${i} AS time, ${a}(value) AS value\n      FROM ${t}\n      WHERE itemid IN (${e})\n        AND clock\n          > ${n}\n        AND clock\n          < ${r}\n      GROUP BY 1, 2\n      ORDER BY time ASC\n  `},trendsQuery:function(e,t,n,r,i,a,o){return`\n      SELECT to_char(itemid, '${ht}') AS metric, clock / ${i} * ${i} AS time, ${a}(${o}) AS value\n      FROM ${t}\n      WHERE itemid IN (${e})\n        AND clock\n          > ${n}\n        AND clock\n          < ${r}\n      GROUP BY 1, 2\n      ORDER BY time ASC\n  `},testQuery:function(){return gt}};function vt(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class bt extends Ze{loadSQLDialect(){"postgres"===this.datasourceTypeId||"grafana-postgresql-datasource"===this.datasourceTypeId?this.sqlDialect=ft:this.sqlDialect=mt}testDataSource(){const e=this.sqlDialect.testQuery();return this.invokeSQLQuery(e)}getHistory(e,t,r,i){const{aggFunction:a,intervalSec:o}=yt(t,r,i),l=n().groupBy(e,"value_type"),s=n().map(l,((e,i)=>{const l=n().map(e,"itemid").join(", "),s=Qe[i];let c=this.sqlDialect.historyQuery(l,s,t,r,o,a);return c=L(c),this.invokeSQLQuery(c)}));return Promise.all(s).then((e=>n().flatten(e)))}getTrends(e,t,r,i){const{consolidateBy:a}=i,{aggFunction:o,intervalSec:l}=yt(t,r,i),s=n().groupBy(e,"value_type"),c=n().map(s,((e,i)=>{const s=n().map(e,"itemid").join(", "),c=Je[i];let u=n().includes(["avg","min","max","sum"],a)?a:"avg";u=Ye.consolidateByTrendColumns[u];let d=this.sqlDialect.trendsQuery(s,c,t,r,l,o,u);return d=L(d),this.invokeSQLQuery(d)}));return Promise.all(c).then((e=>n().flatten(e)))}invokeSQLQuery(e){const t={refId:"A",format:"time_series",datasourceId:this.datasourceId,rawSql:e,maxDataPoints:this.limit};return(0,ie.getBackendSrv)().datasourceRequest({url:"/api/ds/query",method:"POST",data:{queries:[t]}}).then((e=>{const t=e.data.results;return t.A?t.A.frames:null}))}constructor(e){super(e),vt(this,"limit",void 0),vt(this,"sqlDialect",void 0),this.limit=e.limit||1e4,this.sqlDialect=null,super.loadDBDataSource().then((()=>{this.loadSQLDialect()}))}}function yt(e,t,n){const{intervalMs:r}=n;let{consolidateBy:i}=n,a=Math.ceil(r/1e3);const o=Math.ceil((t-e)/a);return a=Math.ceil((t-e)/o),i=i||"avg",{aggFunction:Ye.consolidateByFunc[i],intervalSec:a}}function Et(e,t,n,r,i,a,o){try{var l=e[a](o),s=l.value}catch(e){return void n(e)}l.done?t(s):Promise.resolve(s).then(r,i)}function Ot(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}const wt={avg:"MEAN",min:"MIN",max:"MAX",sum:"SUM",count:"COUNT"};class It extends Ze{testDataSource(){return this.influxDS.testDatasource().then((e=>e.status&&"error"===e.status?Promise.reject({data:{message:`InfluxDB connection error: ${e.message}`}}):e))}getHistory(t,r,i,a){const{intervalMs:o,retentionPolicy:l}=a;let{consolidateBy:s}=a;const c=Math.ceil(o/1e3),u={timeFrom:r,timeTill:i};s=s||"avg";const d=n().groupBy(t,"value_type"),p=n().map(d,((e,t)=>{const r=n().map(e,"itemid"),i=Qe[t],a=this.buildHistoryQuery(r,i,u,c,s,l);return this.invokeInfluxDBQuery(a)}));return Promise.all(p).then(n().flatten).then((t=>function(t){if(!t)return[];const n=[];for(let a=0;a<t.length;a++){const o=t[a];if(o.error){const e=`InfluxDB error: ${o.error}`;return Promise.reject(new Error(e))}if(!o||!o.series)continue;const l=t[a].series;for(let t=0;t<l.length;t++){var r,i;const o=l[t],s=[],c=[];if(o.values)for(a=0;a<o.values.length;a++)s.push(o.values[a][0]),c.push(o.values[a][1]);const u={name:e.TIME_SERIES_TIME_FIELD_NAME,type:e.FieldType.time,config:{},values:new e.ArrayVector(s)},d={name:null==o||null===(r=o.tags)||void 0===r?void 0:r.itemid,type:e.FieldType.number,config:{},values:new e.ArrayVector(c)};n.push(new e.MutableDataFrame({name:null==o||null===(i=o.tags)||void 0===i?void 0:i.itemid,fields:[u,d]}))}}return n.map((t=>(0,e.dataFrameToJSON)(t)))}(t)))}getTrends(e,t,n,r){return r.retentionPolicy=this.retentionPolicy,this.getHistory(e,t,n,r)}buildHistoryQuery(e,t,n,r,i,a){const{timeFrom:o,timeTill:l}=n;let s="value";return a&&(s=Xe[i]||"value_avg"),L(`SELECT ${wt[i]||i}("${s}")\n                   FROM ${a?`"${a}"."${t}"`:`"${t}"`}\n                   WHERE ${this.buildWhereClause(e)}\n                     AND "time" >= ${o}s\n                     AND "time" <= ${l}s\n                   GROUP BY time(${r}s), "itemid" fill(none)`)}buildWhereClause(e){return`(${e.map((e=>`"itemid" = '${e}'`)).join(" OR ")})`}invokeInfluxDBQuery(e){var t,n=this;return(t=function*(){const t=yield n.influxDS._seriesQuery(e).toPromise();return(null==t?void 0:t.results)||[]},function(){var e=this,n=arguments;return new Promise((function(r,i){var a=t.apply(e,n);function o(e){Et(a,r,i,o,l,"next",e)}function l(e){Et(a,r,i,o,l,"throw",e)}o(void 0)}))})()}constructor(e){super(e),Ot(this,"retentionPolicy",void 0),Ot(this,"influxDS",void 0),this.retentionPolicy=e.retentionPolicy,super.loadDBDataSource().then((e=>(this.influxDS=e,e)))}}function Tt(e,t,n,r,i,a,o){try{var l=e[a](o),s=l.value}catch(e){return void n(e)}l.done?t(s):Promise.resolve(s).then(r,i)}function xt(e){return function(){var t=this,n=arguments;return new Promise((function(r,i){var a=e.apply(t,n);function o(e){Tt(a,r,i,o,l,"next",e)}function l(e){Tt(a,r,i,o,l,"throw",e)}o(void 0)}))}}function Pt(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}const St=["getHistory","getTrend","getGroups","getHosts","getApps","getItems","getMacros","getUMacros","getItemsByIDs","getEvents","getAlerts","getHostAlerts","getUserMacros","getHostICAlerts","getHostPCAlerts","getAcknowledges","getITService","getSLA","getVersion","getProxies","getEventAlerts","getExtendedEventData","getProblems","getEventsHistory","getTriggersByIds","getScripts","getValueMappings","getSLAList","getUsers"],At=["getGroups","getHosts","getApps","getItems","getMacros","getUMacros","getItemsByIDs","getITService","getProxies","getValueMappings","getSLAList","getUsers"],Ct=["getHistory","getTrend","getMacros","getItemsByIDs","getEvents","getAlerts","getHostAlerts","getUserMacros","getHostICAlerts","getHostPCAlerts","getAcknowledges","getITService","acknowledgeEvent","getProxies","getEventAlerts","getExtendedEventData","getScripts","executeScript","getValueMappings","getSLAList","getUsers"];class Dt{initDBConnector(e,t,n){return Ze.loadDatasource(e,t).then((r=>{const i={datasourceId:e,datasourceName:t};return"influxdb"===r.type?(i.retentionPolicy=n.dbConnectionRetentionPolicy,this.dbConnector=new It(i)):this.dbConnector=new bt(i),this.dbConnector}))}proxifyRequests(){for(const e of St)this.zabbixAPI[e]=this.cachingProxy.proxify(this.zabbixAPI[e],e,this.zabbixAPI)}cacheRequests(){for(const e of At)this.zabbixAPI[e]=this.cachingProxy.cacheRequest(this.zabbixAPI[e],e,this.zabbixAPI)}bindRequests(){for(const e of Ct)this[e]=this.zabbixAPI[e].bind(this.zabbixAPI)}testDataSource(){let e,t;return this.getVersion().then((t=>(e=t,this.getAllGroups()))).then((()=>this.enableDirectDBConnection?this.dbConnector.testDataSource():Promise.resolve())).catch((e=>Promise.reject(e))).then((n=>(n&&(t={dsType:this.dbConnector.datasourceTypeName||this.dbConnector.datasourceTypeId,dsName:this.dbConnector.datasourceName}),{zabbixVersion:e,dbConnectorStatus:t})))}getVersion(){var e=this;return xt((function*(){return e.version||(e.zabbixAPI.version?e.version=e.zabbixAPI.version:e.version=yield e.zabbixAPI.initVersion()),e.version}))()}supportsApplications(){const e=this.version||this.zabbixAPI.version;return!e||Be().lt(e,"5.4.0")}supportSLA(){const e=this.version||this.zabbixAPI.version;return!e||Be().gte(e,"6.0.0")}isZabbix54OrHigher(){var e=this;return xt((function*(){const t=yield e.zabbixAPI.initVersion();return!!t&&Be().gte(t,"5.4.0")}))()}isZabbix54OrHigherSync(){return!!this.version&&Be().gte(this.version,"5.4.0")}getItemsFromTarget(e,t){const r=n().map(["group","host","application","itemTag","item"],(t=>e[t].filter));return this.getItems(...r,t)}getMacrosFromTarget(e){const t=n().map(["group","host","macro"],(t=>e[t].filter));return this.getUMacros(...t)}getHostsApsFromTarget(e){var t=this;return xt((function*(){const n=["group","host","application"].map((t=>e[t].filter)),r=yield Promise.all([t.getHosts(...n),t.getApps(...n)]),i=r[0];let a=r[1];return a.appFilterEmpty&&(a=[]),[i,a]}))()}getHostsFromICTarget(e,t){var n=this;return xt((function*(){const r=["group","host","application","itemTag","item"].map((t=>e[t].filter)),[i,a]=yield n.getHostsApsFromTarget(e);return[i,a,yield n.getItems(...r,t)]}))()}getHostsFromPCTarget(e,t){var n=this;return xt((function*(){const r=["group","host","application","proxy","trigger"].map((t=>e[t].filter)),[i,a]=yield n.getHostsApsFromTarget(e);return[i,a,yield n.getCProblems(...r,t)]}))()}getAllGroups(){return this.zabbixAPI.getGroups()}getGroups(e){return this.getAllGroups().then((t=>Ft(t,e)))}getAllHosts(e){return this.getGroups(e).then((e=>{const t=n().map(e,"groupid");return this.zabbixAPI.getHosts(t)}))}getHosts(e,t){return this.getAllHosts(e).then((e=>Ft(e,t)))}getAllApps(e,t){var r=this;return xt((function*(){return yield r.getVersion(),r.supportsApplications()?r.getHosts(e,t).then((e=>{const t=n().map(e,"hostid");return r.zabbixAPI.getApps(t)})):[]}))()}getApps(e,t,r){var i=this;return xt((function*(){yield i.getVersion();const a=!i.supportsApplications();return i.getHosts(e,t).then((e=>{const t=n().map(e,"hostid");if(r&&!a)return i.zabbixAPI.getApps(t).then((e=>Rt(e,r)));{const e=t;return e.hostids=t,e.appFilterEmpty=!0,Promise.resolve(e)}}))}))()}getAllMacros(e,t){var n=this;return xt((function*(){const r=yield n.getHosts(e,t),i=null==r?void 0:r.map((e=>e.hostid));return n.zabbixAPI.getMacros(i)}))()}getUMacros(e,t,r){var i=this;return xt((function*(){return a=yield i.getAllMacros(e,t),D(o=r)?function(e,t){const r=F(t);return n().filter(e,(e=>r.test(null==e?void 0:e.macro)))}(a,o):function(e,t){return n().filter(e,{macro:t})||[]}(a,o);var a,o}))()}getItemTags(e,t,r){var i=this;return xt((function*(){const a=yield i.getAllItems(e,t,null,null,{});let o=n().flatten(a.map((e=>e.tags?e.tags:[])));return o=n().uniqBy(o,(e=>e.tag+e.value||"")),Ft(o.map((e=>({name:q(e)}))),r)}))()}getAllItems(e,t,r,i,a={}){var o=this;return xt((function*(){if(!o.isZabbix54OrHigher())return o.getAllItemsBefore54(e,t,r,i,a);const l=yield o.getHosts(e,t),s=n().map(l,"hostid");if(D(i)){const n=yield o.getItemTags(e,t,i);i=n.map((e=>e.name)).join(",")}let c=yield o.zabbixAPI.getItems(s,void 0,a.itemtype,i);return a.showDisabledItems||(c=n().filter(c,{status:"0"})),yield o.expandUserMacro(c,!1)}))()}getAllItemsBefore54(e,t,r,i,a={}){var o=this;return xt((function*(){const i=yield o.getApps(e,t,r);let l;if(i.appFilterEmpty)l=yield o.zabbixAPI.getItems(i.hostids,void 0,a.itemtype,void 0);else{const e=n().map(i,"applicationid");l=yield o.zabbixAPI.getItems(void 0,e,a.itemtype,void 0)}return a.showDisabledItems||(l=n().filter(l,{status:"0"})),yield o.expandUserMacro(l,!1)}))()}expandUserMacro(e,t){const r=function(e){const t=n().map(e,(e=>n().map(e.hosts,"hostid")));return n().uniq(n().flatten(t))}(e);return this.getMacros(r).then((r=>(n().forEach(e,(e=>{var n;n=t?e.url:e.name,P.test(n)&&(t?e.url=S(e,r,t):e.name=S(e,r))})),e)))}getItems(e,t,n,r,i,a={}){return this.getAllItems(e,t,n,r,a).then((e=>Rt(e,i)))}getItemValues(e,t,r,i,a={}){return this.getItems(e,t,r,null,i,a).then((e=>{let t=[s()().subtract(2,"h").unix(),s()().unix()];a.range&&(t=[a.range.from.unix(),a.range.to.unix()]);const[r,i]=t;return this.zabbixAPI.getHistory(e,r,i).then((e=>e?n().uniq(e.map((e=>e.value))).map((e=>({name:e}))):[]))}))}getITServices(e){var t=this;return xt((function*(){return Ft(yield t.zabbixAPI.getITService(),e)}))()}getSLAs(e){var t=this;return xt((function*(){return Ft(yield t.zabbixAPI.getSLAList(),e)}))()}getProblems(e,t,r,i,a){const o=[this.getGroups(e),this.getHosts(e,t),this.getApps(e,t,r)];return Promise.all(o).then((i=>{const[a,o,l]=i,s={};return r&&(s.applicationids=n().flatten(n().map(l,"applicationid"))),t&&"/.*/"!==t&&(s.hostids=n().map(o,"hostid")),e&&(s.groupids=n().map(a,"groupid")),s})).then((e=>this.zabbixAPI.getProblems(e.groupids,e.hostids,e.applicationids,a))).then((e=>{const t=null==e?void 0:e.map((e=>e.objectid));return Promise.all([Promise.resolve(e),this.zabbixAPI.getTriggersByIds(t)])})).then((([e,t])=>je(e,t))).then((e=>this.filterTriggersByProxy(e,i)))}getProblemsHistory(e,t,r,i,a){const{valueFromEvent:o}=a,l=[this.getGroups(e),this.getHosts(e,t),this.getApps(e,t,r)];return Promise.all(l).then((i=>{const[a,o,l]=i,s={};return r&&(s.applicationids=n().flatten(n().map(l,"applicationid"))),t&&(s.hostids=n().map(o,"hostid")),e&&(s.groupids=n().map(a,"groupid")),s})).then((e=>this.zabbixAPI.getEventsHistory(e.groupids,e.hostids,e.applicationids,a))).then((e=>{const t=null==e?void 0:e.map((e=>e.objectid));return Promise.all([Promise.resolve(e),this.zabbixAPI.getTriggersByIds(t)])})).then((([e,t])=>Fe(e,t,{valueFromEvent:o}))).then((e=>this.filterTriggersByProxy(e,i)))}getCProblems(e,t,r,i,a,o){const l=[this.getGroups(e),this.getHosts(e,t),this.getApps(e,t,r)];return Promise.all(l).then((i=>{const[a,o,l]=i,s={};return r&&(s.applicationids=n().flatten(n().map(l,"applicationid"))),t&&"/.*/"!==t&&(s.hostids=n().map(o,"hostid")),e&&(s.groupids=n().map(a,"groupid")),s})).then((e=>this.zabbixAPI.getProblems(e.groupids,e.hostids,e.applicationids,o))).then((e=>Ft(e,a))).then((e=>{const t=null==e?void 0:e.map((e=>e.objectid));return Promise.all([Promise.resolve(e),this.zabbixAPI.getTriggersByIds(t)])})).then((([e,t])=>je(e,t))).then((e=>this.filterTriggersByProxy(e,i)))}filterTriggersByProxy(e,t){return this.getFilteredProxies(t).then((n=>{if(t&&"/.*/"!==t&&e){const t=n.map((e=>e.proxyid));e=e.filter((e=>{for(let n=0;n<e.hosts.length;n++){const r=e.hosts[n],i=r.proxyid||r.proxy_hostid;if(t.includes(i))return!0}return!1}))}return e}))}getFilteredProxies(e){return this.zabbixAPI.getProxies().then((t=>(t.forEach((e=>e.name=e.host)),Ft(t,e))))}getHistoryTS(e,t,n){const[r,i]=t;return this.enableDirectDBConnection?this.getHistoryDB(e,r,i,n).then((t=>xe(t,e,n))):this.zabbixAPI.getHistory(e,r,i).then((t=>fe(t,e)))}getTrends(e,t,n){const[r,i]=t;if(this.enableDirectDBConnection)return this.getTrendsDB(e,r,i,n).then((t=>xe(t,e,n)));{const t=n.consolidateBy||n.valueType;return this.zabbixAPI.getTrend(e,r,i).then((n=>ve(n,e,t))).then(Ie)}}getHistoryText(e,t,n){const[r,i]=t;return e.length?this.zabbixAPI.getHistory(e,r,i).then((t=>"table"===n.resultFormat?Ee(t,e,n):be(t,e,n))):Promise.resolve([])}getSLI(t,n,r,i,a){var o=this;return xt((function*(){const l=t.map((e=>e.serviceid));if("status"===i.slaProperty)return function(t,n,r){const i=[];for(let n=0;n<(null==t?void 0:t.length);n++){const r=t[n],a=Number(r.status);i.push({name:r?r.name:n,type:e.FieldType.number,config:{},values:new e.ArrayVector([a])})}const a={name:e.TIME_SERIES_TIME_FIELD_NAME,type:e.FieldType.time,config:{custom:{}},values:new e.ArrayVector([Date.now()])};return new e.MutableDataFrame({refId:r.refId,name:"Service status",fields:[a,...i]})}(yield o.zabbixAPI.getServices(l),0,i);const s=n.map((e=>e.slaid));if(s.length>1){const c=null==s?void 0:s.map((e=>o.zabbixAPI.getSLI(e,l,r,a)));return function(t,n,r,i){var a;if(!t||0===(null==t?void 0:t.length))return new e.MutableDataFrame({refId:i.refId,name:"SLI",fields:[]});const o=t[0],l=[];for(let e=0;e<(null==o||null===(a=o.periods)||void 0===a?void 0:a.length);e++){const t=o.periods[e];l.push(1e3*t.period_from)}const s={name:e.TIME_SERIES_TIME_FIELD_NAME,type:e.FieldType.time,config:{custom:{}},values:new e.ArrayVector(l)},c=[],u=me(i.slaProperty);for(let i=0;i<t.length;i++){var d,p;const a=t[i],o=[];for(let e=0;e<(null==a||null===(d=a.sli)||void 0===d?void 0:d.length);e++){const t=a.sli[e];for(let e=0;e<t.length;e++){const n=t[e][u];o[e]||(o[e]=[]),o[e].push(n)}}for(let l=0;l<(null==a||null===(p=a.serviceids)||void 0===p?void 0:p.length);l++){const s=null==a?void 0:a.serviceids[l].toString(),u=n.find((e=>e.serviceid===s));let d=`${(null==u?void 0:u.name)||s}`;t.length>1&&(d=`${d}: ${r[i].name}`),c.push({name:d,type:e.FieldType.number,config:{},values:new e.ArrayVector(o[l])})}}return new e.MutableDataFrame({refId:i.refId,name:"SLI",fields:[s,...c]})}(yield Promise.all(c),t,n,i)}{const n=(null==s?void 0:s.length)>0?s[0]:void 0;return function(t,n,r){var i,a,o;const l=[];for(let e=0;e<(null==t||null===(i=t.periods)||void 0===i?void 0:i.length);e++){const n=t.periods[e];l.push(1e3*n.period_from)}const s={name:e.TIME_SERIES_TIME_FIELD_NAME,type:e.FieldType.time,config:{custom:{}},values:new e.ArrayVector(l)},c=[],u=[];let d=me(r.slaProperty);for(let e=0;e<(null==t||null===(a=t.sli)||void 0===a?void 0:a.length);e++){const n=t.sli[e];for(let e=0;e<n.length;e++){const t=n[e][d];u[e]||(u[e]=[]),u[e].push(t)}}for(let r=0;r<(null==t||null===(o=t.serviceids)||void 0===o?void 0:o.length);r++){const i=null==t?void 0:t.serviceids[r].toString(),a=n.find((e=>e.serviceid===i));c.push({name:a?a.name:i,type:e.FieldType.number,config:{},values:new e.ArrayVector(u[r])})}return new e.MutableDataFrame({refId:r.refId,name:"SLI",fields:[s,...c]})}(yield o.zabbixAPI.getSLI(n,l,r,a),t,i)}}))()}getSLA(e,t,r,i){var a=this;return xt((function*(){const o=n().map(e,"serviceid");if(a.supportSLA()){const l=yield a.zabbixAPI.getSLA60(o,t,i);return n().map(o,(t=>{const i=n().find(e,{serviceid:t});return Oe(i,r.slaProperty,l)}))}const l=yield a.zabbixAPI.getSLA(o,t,i);return n().map(o,(t=>{const i=n().find(e,{serviceid:t});return Oe(i,r.slaProperty,l)}))}))()}constructor(e){Pt(this,"enableDirectDBConnection",void 0),Pt(this,"cachingProxy",void 0),Pt(this,"zabbixAPI",void 0),Pt(this,"getHistoryDB",void 0),Pt(this,"dbConnector",void 0),Pt(this,"getTrendsDB",void 0),Pt(this,"version",void 0),Pt(this,"getHistory",void 0),Pt(this,"getTrend",void 0),Pt(this,"getItemsByIDs",void 0),Pt(this,"getEvents",void 0),Pt(this,"getAlerts",void 0),Pt(this,"getHostAlerts",void 0),Pt(this,"getHostICAlerts",void 0),Pt(this,"getHostPCAlerts",void 0),Pt(this,"getAcknowledges",void 0),Pt(this,"getITService",void 0),Pt(this,"acknowledgeEvent",void 0),Pt(this,"getProxies",void 0),Pt(this,"getEventAlerts",void 0),Pt(this,"getExtendedEventData",void 0),Pt(this,"getMacros",void 0),Pt(this,"getUserMacros",void 0),Pt(this,"getValueMappings",void 0),Pt(this,"getSLAList",void 0),Pt(this,"getUsers",void 0);const{basicAuth:t,withCredentials:n,cacheTTL:r,enableDirectDBConnection:i,dbConnectionDatasourceId:a,dbConnectionDatasourceName:o,dbConnectionRetentionPolicy:l,datasourceId:s}=e;this.enableDirectDBConnection=i;const c={enabled:!0,ttl:r};if(this.cachingProxy=new ze(c),this.zabbixAPI=new st(t,n,s),this.proxifyRequests(),this.cacheRequests(),this.bindRequests(),i){const e={dbConnectionRetentionPolicy:l};this.initDBConnector(a,o,e).then((()=>{this.getHistoryDB=this.cachingProxy.proxifyWithCache(this.dbConnector.getHistory,"getHistory",this.dbConnector),this.getTrendsDB=this.cachingProxy.proxifyWithCache(this.dbConnector.getTrends,"getTrends",this.dbConnector)}))}}}function jt(e,t){const r=F(t);return n().filter(e,(e=>r.test(e.name)))}function Ft(e,t){return D(t)?jt(e,t):function(e,t){const r=n().find(e,{name:t});return r?[r]:[]}(e,t)}function Rt(e,t){return D(t)?jt(e,t):function(e,t){return n().filter(e,{name:t})||[]}(e,t)}var $t=g(2650),Nt=g.n($t),kt=function(){return kt=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},kt.apply(this,arguments)};function Lt(e,t,n){void 0===t&&(t=[]),void 0===n&&(n={loading:!1});var r,i,a=(0,$t.useRef)(0),o=(r=(0,$t.useRef)(!1),i=(0,$t.useCallback)((function(){return r.current}),[]),(0,$t.useEffect)((function(){return r.current=!0,function(){r.current=!1}}),[]),i),l=(0,$t.useState)(n),s=l[0],c=l[1],u=(0,$t.useCallback)((function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];var r=++a.current;return s.loading||c((function(e){return kt(kt({},e),{loading:!0})})),e.apply(void 0,t).then((function(e){return o()&&r===a.current&&c({value:e,loading:!1}),e}),(function(e){return o()&&r===a.current&&c({error:e,loading:!1}),e}))}),t);return[s,u]}Object.create,Object.create,"function"==typeof SuppressedError&&SuppressedError;var _t=g(7388),Mt=g(7644);const qt=({children:e})=>{const t=Vt();return Nt().createElement(_t.InlineFieldRow,null,e,Nt().createElement(_t.InlineFormLabel,{className:t.rowTerminator},Nt().createElement(Nt().Fragment,null)))},Vt=()=>({rowTerminator:(0,Mt.css)({flexGrow:1})});(0,_t.stylesFactory)((t=>{const n=t.type===e.GrafanaThemeType.Light?"#497dc0":"#005f81",r=t.type===e.GrafanaThemeType.Light?"#456ba4":"#354f77";return{button:Mt.css`
      height: 2rem;
      background-image: none;
      background-color: ${n};
      border: 1px solid ${t.palette.gray1};
      border-radius: 1px;
      color: ${t.colors.text};

      i {
        vertical-align: middle;
      }

      &:hover {
        background-color: ${r};
      }
    `,icon:Mt.css`
      i {
        color: ${t.colors.text};
      }
    `}})),g(2729);Nt().createContext(ie.config).Consumer,Nt().Component;const Bt=({options:e,offset:t,minWidth:n,selected:r,onSelect:i})=>{const a=(0,_t.useTheme2)(),o=(0,_t.getSelectStyles)(a),l=(0,_t.useStyles2)(zt(n));return Nt().createElement("div",{className:(0,Mt.cx)(o.menu,l.menuWrapper,{[l.menuLeft]:t.horizontal>0},Mt.css`
          bottom: ${t.vertical>0?`${t.vertical}px`:"unset"};
          top: ${t.vertical<0?`${Math.abs(t.vertical)}px`:"unset"};
        `)},Nt().createElement("div",{className:l.menu,"aria-label":"Metric picker menu"},Nt().createElement(_t.CustomScrollbar,{autoHide:!1,autoHeightMax:"300px",hideHorizontalTrack:!0},Nt().createElement("div",null,Nt().createElement("div",{className:o.optionBody},null==e?void 0:e.map(((e,t)=>Nt().createElement(Ht,{data:e,key:t,onClick:i,isFocused:r===t,hideDescription:!0}))))))))},Ht=Nt().forwardRef((({data:e,isFocused:t,disabled:n,onClick:r,hideDescription:i},a)=>{const o=(0,_t.useTheme2)(),l=(0,_t.getSelectStyles)(o),s=(0,_t.useStyles2)(zt()),c=(0,Mt.cx)(l.option,s.menuOptionWrapper,t&&l.optionFocused,n&&s.menuOptionDisabled);return Nt().createElement("div",{ref:a,className:c,"aria-label":"Menu option",onClick:t=>{n||(t.preventDefault(),t.stopPropagation(),r(e))}},Nt().createElement("div",{className:(0,Mt.cx)(l.optionBody,s.menuOptionBody)},Nt().createElement("span",null,e.label||e.value),!i&&e.description&&Nt().createElement("div",{className:l.optionDescription},e.description)),e.description&&Nt().createElement(_t.Tooltip,{content:e.description},Nt().createElement(_t.Icon,{name:"info-circle",className:s.menuOptionInfoSign})))}));Ht.displayName="MenuOption";const zt=e=>t=>({menuWrapper:Mt.css`
      display: flex;
      max-height: 650px;
      position: absolute;
      z-index: ${t.zIndex.dropdown};
      overflow: hidden;
      min-width: auto;
    `,menu:Mt.css`
      min-width: ${t.spacing(e||0)};

      & > div {
        padding-top: ${t.spacing(1)};
      }
    `,menuLeft:Mt.css`
      right: 0;
      flex-direction: row-reverse;
    `,container:Mt.css`
      padding: ${t.spacing(1)};
      border: 1px ${t.colors.border.weak} solid;
      border-radius: ${t.shape.borderRadius(1)};
      background-color: ${t.colors.background.primary};
      z-index: ${t.zIndex.modal};
    `,menuOptionWrapper:Mt.css`
      padding: ${t.spacing(.5)};
    `,menuOptionBody:Mt.css`
      font-weight: ${t.typography.fontWeightRegular};
      padding: ${t.spacing(0,1.5,0,0)};
    `,menuOptionDisabled:Mt.css`
      color: ${t.colors.text.disabled};
      cursor: not-allowed;
    `,menuOptionInfoSign:Mt.css`
      color: ${t.colors.text.disabled};
    `}),Wt=({value:e,options:t,isLoading:n,width:r,onChange:i})=>{const[a,o]=(0,$t.useState)(!1),[l,s]=(0,$t.useState)(e),[c,u]=(0,$t.useState)(t),[d,p]=(0,$t.useState)(-1),[m]=(0,$t.useState)({vertical:0,horizontal:0}),h=(0,$t.useRef)(null),g=(0,_t.useStyles2)(Ut),f=(0,Mt.cx)({[g.inputRegexp]:D(l),[g.inputVariable]:l.startsWith("$")});(0,$t.useEffect)((()=>{u(t)}),[t]);const v=(0,$t.useCallback)((()=>{o(!1)}),[]),b=e=>{const t=(null==e?void 0:e.value)||"";s(t),i(t),v()};return Nt().createElement("div",{"data-testid":"role-picker",style:{position:"relative"},ref:h},Nt().createElement(_t.ClickOutsideWrapper,{onClick:()=>a&&v()},Nt().createElement(_t.Input,{className:f,value:l,type:"text",onChange:n=>{var r;a||o(!0);const i=null==n||null===(r=n.currentTarget)||void 0===r?void 0:r.value;if(i)if(s(i),e!==i){const e=t.filter((e=>{var t,n;return(null===(t=e.value)||void 0===t?void 0:t.toLowerCase().includes(i.toLowerCase()))||(null===(n=e.label)||void 0===n?void 0:n.toLowerCase().includes(i.toLowerCase()))}));u(e)}else u(t);else s(""),u(t)},onBlur:()=>{i(l)},onMouseDown:()=>{o(!0),u(t)},suffix:n&&Nt().createElement(_t.Spinner,null),width:r,onKeyDown:e=>{if("ArrowDown"===e.key){a||o(!0),e.preventDefault(),e.stopPropagation();const t=d<c.length-1?d+1:0;p(t)}else if("ArrowUp"===e.key){a||o(!0),e.preventDefault(),e.stopPropagation();const t=d>0?d-1:c.length-1;p(t)}else"Enter"===e.key&&(e.preventDefault(),e.stopPropagation(),b(c[d]))}}),a&&Nt().createElement(Bt,{options:c,onSelect:b,offset:m,minWidth:r,selected:d})))},Ut=e=>({inputRegexp:Mt.css`
      input {
        color: ${e.colors.warning.main};
      }
    `,inputVariable:Mt.css`
      input {
        color: ${e.colors.primary.text};
      }
    `}),Gt=()=>{const e=(0,ie.getTemplateSrv)().getVariables().filter((e=>"datasource"!==e.type&&"interval"!==e.type));return null==e?void 0:e.map((e=>({value:`$${e.name}`,label:`$${e.name}`})))};function Qt(e,t,n,r,i,a,o){try{var l=e[a](o),s=l.value}catch(e){return void n(e)}l.done?t(s):Promise.resolve(s).then(r,i)}function Jt(e){return function(){var t=this,n=arguments;return new Promise((function(r,i){var a=e.apply(t,n);function o(e){Qt(a,r,i,o,l,"next",e)}function l(e){Qt(a,r,i,o,l,"throw",e)}o(void 0)}))}}function Xt(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Zt(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){Xt(e,t,n[t])}))}return e}function Yt(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n.push.apply(n,r)}return n}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}const Kt=[{value:0,label:"Not classified"},{value:1,label:"Information"},{value:2,label:"Warning"},{value:3,label:"Average"},{value:4,label:"High"},{value:5,label:"Disaster"}],en=({annotation:e,onAnnotationChange:t,datasource:r})=>{var i,a,o,l,s,c,u;const d=(e=X(e)).target,p=(m=Jt((function*(){const e=yield r.zabbix.getAllGroups(),t=null==e?void 0:e.map((e=>({value:e.name,label:e.name})));return t.unshift(...Gt()),t})),function(){return m.apply(this,arguments)});var m;const[{loading:h,value:g},f]=Lt(Jt((function*(){return yield p()})),[]),v=function(){var e=Jt((function*(e){const t=r.replaceTemplateVars(e),i=yield r.zabbix.getAllHosts(t);let a=null==i?void 0:i.map((e=>({value:e.name,label:e.name})));return a=n().uniqBy(a,(e=>e.value)),a.unshift({value:"/.*/"}),a.unshift(...Gt()),a}));return function(t){return e.apply(this,arguments)}}(),[{loading:b,value:y},E]=Lt(Jt((function*(){return yield v(d.group.filter)})),[d.group.filter]),O=function(){var e=Jt((function*(e,t){const i=r.replaceTemplateVars(e),a=r.replaceTemplateVars(t),o=yield r.zabbix.getAllApps(i,a);let l=null==o?void 0:o.map((e=>({value:e.name,label:e.name})));return l=n().uniqBy(l,(e=>e.value)),l.unshift(...Gt()),l}));return function(t,n){return e.apply(this,arguments)}}(),[{loading:w,value:I},T]=Lt(Jt((function*(){return yield O(d.group.filter,d.host.filter)})),[d.group.filter,d.host.filter]),x=r.replaceTemplateVars(null===(i=d.group)||void 0===i?void 0:i.filter),P=r.replaceTemplateVars(null===(a=d.host)||void 0===a?void 0:a.filter);(0,$t.useEffect)((()=>{f()}),[]),(0,$t.useEffect)((()=>{E()}),[x]),(0,$t.useEffect)((()=>{T()}),[x,P]);const S=n=>{t(Yt(Zt({},e),{target:n}))},A=e=>t=>{null!==t&&S(Yt(Zt({},d),{[e]:{filter:t}}))},C=e=>()=>{S(Yt(Zt({},d),{options:Yt(Zt({},d.options),{[e]:!d.options[e]})}))};return Nt().createElement(Nt().Fragment,null,Nt().createElement(qt,null,Nt().createElement(_t.InlineField,{label:"Group",labelWidth:12},Nt().createElement(Wt,{width:24,value:null===(o=d.group)||void 0===o?void 0:o.filter,options:g,isLoading:h,onChange:A("group")})),Nt().createElement(_t.InlineField,{label:"Host",labelWidth:12},Nt().createElement(Wt,{width:24,value:null===(l=d.host)||void 0===l?void 0:l.filter,options:y,isLoading:b,onChange:A("host")}))),Nt().createElement(qt,null,Nt().createElement(_t.InlineField,{label:"Application",labelWidth:12},Nt().createElement(Wt,{width:24,value:null===(s=d.application)||void 0===s?void 0:s.filter,options:I,isLoading:w,onChange:A("application")})),Nt().createElement(_t.InlineField,{label:"Problem",labelWidth:12},Nt().createElement(_t.Input,{width:24,defaultValue:null===(c=d.trigger)||void 0===c?void 0:c.filter,placeholder:"Problem name",onBlur:("trigger",e=>{var t;const n=null==e||null===(t=e.currentTarget)||void 0===t?void 0:t.value;null!==n&&S(Yt(Zt({},d),{trigger:{filter:n}}))})}))),Nt().createElement(Nt().Fragment,null,Nt().createElement(_t.InlineField,{label:"Min severity",labelWidth:12},Nt().createElement(_t.Select,{isSearchable:!1,width:24,value:null===(u=d.options)||void 0===u?void 0:u.minSeverity,options:Kt,onChange:e=>{null!==e.value&&S(Yt(Zt({},d),{options:Yt(Zt({},d.options),{minSeverity:e.value})}))}})),Nt().createElement(_t.InlineField,{label:"Show OK events",labelWidth:24},Nt().createElement(_t.InlineSwitch,{value:d.options.showOkEvents,onChange:C("showOkEvents")})),Nt().createElement(_t.InlineField,{label:"Hide acknowledged events",labelWidth:24},Nt().createElement(_t.InlineSwitch,{value:d.options.hideAcknowledged,onChange:C("hideAcknowledged")})),Nt().createElement(_t.InlineField,{label:"Show hostname",labelWidth:24},Nt().createElement(_t.InlineSwitch,{value:d.options.showHostname,onChange:C("showHostname")}))))};function tn(e,t,n,r,i,a,o){try{var l=e[a](o),s=l.value}catch(e){return void n(e)}l.done?t(s):Promise.resolve(s).then(r,i)}function nn(e){return function(){var t=this,n=arguments;return new Promise((function(r,i){var a=e.apply(t,n);function o(e){tn(a,r,i,o,l,"next",e)}function l(e){tn(a,r,i,o,l,"throw",e)}o(void 0)}))}}function rn(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function an(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){rn(e,t,n[t])}))}return e}function on(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n.push.apply(n,r)}return n}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}class ln extends e.DataSourceApi{query(t){(t=>{t.app!==e.CoreApp.Dashboard&&t.app!==e.CoreApp.PanelViewer&&t.targets.forEach((e=>{const n={app:t.app};switch(e.queryType){case c:n.queryType="Metrics";break;case u:n.queryType="Services";break;case d:n.queryType="Text";break;case p:n.queryType="Item Id";break;case m:n.queryType="Triggers";break;case h:n.queryType="Problems";break;case v:n.queryType="Macros"}(0,ie.reportInteraction)("grafana_zabbix_query_executed",n)}))})(t);const r=t.targets.map((e=>Q(n().cloneDeep(e)))),i=this.backendQuery(on(an({},t),{targets:r})),a=this.dbConnectionQuery(on(an({},t),{targets:r})),o=this.frontendQuery(on(an({},t),{targets:r})),l=this.annotationRequest(on(an({},t),{targets:r}));return Promise.all([i,a,o,l]).then((n=>{const[r,i,a,o]=n;return i.data&&(r.data=r.data.concat(i.data)),a.data&&(r.data=r.data.concat(a.data)),o.data&&(r.data=r.data.concat(o.data)),{data:r.data,state:e.LoadingState.Done,key:t.requestId}}))}backendQuery(e){var t=this;return nn((function*(){const{intervalMs:r,maxDataPoints:i,range:a,requestId:o}=e,l=e.targets.filter(t.isBackendTarget);e.scopedVars=Object.assign({},e.scopedVars,j(e.range));const s=n().compact(l.map((n=>n.hide?null:(t.replaceTargetVariables(n,e),on(an({},n),{datasourceId:t.datasourceId,intervalMs:r,maxDataPoints:i})))));if(!s.length)return Promise.resolve({data:[]});const c={queries:s};let u;a&&(c.range=a,c.from=a.from.valueOf().toString(),c.to=a.to.valueOf().toString());try{u=yield(0,ie.getBackendSrv)().fetch({url:"/api/ds/query",method:"POST",data:c,requestId:o}).toPromise()}catch(e){return(0,ie.toDataQueryResponse)(e)}const d=(0,ie.toDataQueryResponse)(u);return t.sortByRefId(d),t.applyFrontendFunctions(d,e),De(d),Se(d.data)&&(console.log("Converting response to the wide format"),d.data=Ae(d.data)),d}))()}frontendQuery(t){var r=this;return nn((function*(){const i=t.targets.filter((e=>!(r.isBackendTarget(e)||r.isDBConnectionTarget(e)))),a=n().map(i,(e=>{if(e.hide)return[];t.scopedVars=Object.assign({},t.scopedVars,j(t.range)),r.replaceTargetVariables(e,t);const n=r.buildTimeRange(t,e);return e.queryType===d?e.group&&e.host&&e.item?r.queryTextData(e,n):[]:e.queryType===u?r.queryITServiceData(e,n,t):e.queryType===m?r.queryTriggersData(e,n,t):e.queryType===h?r.queryProblems(e,n,t):e.queryType===v?r.queryUserMacrosData(e):[]}));return Promise.all(n().flatten(a)).then(n().flatten).then((t=>(t&&t.length>0&&(0,e.isDataFrame)(t[0])&&!function(t){return t.fields.length&&t.fields[0].type===e.FieldType.other&&"problems"===t.fields[0].config.custom.type}(t[0])&&!function(e){return"macros"===e.name}(t[0])&&!function(t){return!t.fields.find((t=>t.type===e.FieldType.time||t.name===e.TIME_SERIES_TIME_FIELD_NAME))}(t[0])&&(t=Ce(t),Se(t)&&(console.log("Converting response to the wide format"),t=Ae(t))),{data:t})))}))()}dbConnectionQuery(e){var t=this;return nn((function*(){const r=e.targets.filter(t.isDBConnectionTarget),i=n().compact(r.map((n=>{if(n.hide)return[];e.scopedVars=Object.assign({},e.scopedVars,j(e.range)),t.replaceTargetVariables(n,e);const r=t.buildTimeRange(e,n),i=t.isUseTrends(r,n);return n.queryType&&n.queryType!==c?n.queryType===p&&n.itemids?t.queryItemIdData(n,r,i,e):[]:t.queryNumericData(n,r,i,e)})));return Promise.all(i).then(n().flatten).then((e=>({data:e})))}))()}buildTimeRange(e,t){let n=Math.ceil(o.parse(e.range.from)/1e3),r=Math.ceil(o.parse(e.range.to)/1e3);const i=sn(t.functions,"Time");if(i.length){const[e,t]=k(i)([n,r]);n=e,r=t}return[n,r]}queryNumericData(e,t,n,r){var i=this;return nn((function*(){const a=yield i.zabbix.getItemsFromTarget(e,{itemtype:"num"}),o=(new Date).getTime(),l=yield i.queryNumericDataForItems(a,e,t,n,r),s=(new Date).getTime();return i.enableDebugLog&&console.log(`Datasource::Performance Query Time (${i.name}): ${s-o}`),i.handleBackendPostProcessingResponse(l,r,e)}))()}queryNumericDataForItems(e,t,r,i,a){var o=this;return nn((function*(){let l;a.valueType=o.getTrendValueType(t),a.consolidateBy=function(e){let t;const r=n().find(e.functions,(e=>"consolidateBy"===e.def.name));return r&&r.params&&r.params.length&&(t=r.params[0]),t}(t)||a.valueType,l=i?yield o.zabbix.getTrends(e,r,a):yield o.zabbix.getHistoryTS(e,r,a);const s={from:r[0],to:r[1]};return yield o.invokeDataProcessingQuery(l,t,s)}))()}invokeDataProcessingQuery(e,t,n){var r=this;return nn((function*(){const i={url:`/api/datasources/${r.datasourceId}/resources/db-connection-post`,method:"POST",headers:{"Content-Type":"application/json"},hideFromInspector:!1,data:{series:e,query:t,timeRange:n}};return(yield(0,ie.getBackendSrv)().fetch(i).toPromise()).data}))()}handleBackendPostProcessingResponse(t,n,r){const i=[];for(const n of t){const t=(0,e.dataFrameFromJSON)(n);t.refId=r.refId,i.push(t)}const a={data:i};return this.sortByRefId(a),this.applyFrontendFunctions(a,n),Se(a.data)&&(console.log("Converting response to the wide format"),a.data=Ae(a.data)),a.data}getTrendValueType(e){const t=n().map(re().Trends,"name"),r=n().find(e.functions,(e=>n().includes(t,e.def.name)));return r?r.params[0]:"avg"}sortByRefId(e){e.data.sort(((e,t)=>e.refId<t.refId?-1:e.refId>t.refId?1:0))}applyFrontendFunctions(e,t){for(let n=0;n<e.data.length;n++){const r=e.data[n];k(sn(mn(t,r.refId).functions,"Alias"))(r)}return e}queryTextData(t,n){return this.zabbix.getItemsFromTarget(t,{itemtype:"text"}).then((e=>this.zabbix.getHistoryText(e,n,t))).then((n=>"table"!==t.resultFormat?n.map((n=>Te(n,t,[],e.FieldType.string))):n))}queryItemIdData(e,t,r,i){let a=e.itemids;return a=(0,ie.getTemplateSrv)().replace(a,i.scopedVars,dn),a=n().map(a.split(","),(e=>e.trim())),a?this.zabbix.getItemsByIDs(a).then((n=>this.queryNumericDataForItems(n,e,t,r,i))):[]}queryITServiceData(e,t,r){var i=this;return nn((function*(){if(e.hide||!e.itservice&&!e.itServiceFilter||!e.slaProperty)return[];let a;r.isOldVersion=e.itservice&&!e.itServiceFilter,a=r.isOldVersion?"/.*/":i.replaceTemplateVars(e.itServiceFilter,r.scopedVars),r.slaInterval=e.slaInterval;let o=yield i.zabbix.getITServices(a);var l;if(r.isOldVersion&&(o=n().filter(o,{serviceid:null===(l=e.itservice)||void 0===l?void 0:l.serviceid})),void 0!==e.slaFilter){const n=i.replaceTemplateVars(e.slaFilter,r.scopedVars),a=yield i.zabbix.getSLAs(n);return yield i.zabbix.getSLI(o,a,t,e,r)}const s=yield i.zabbix.getSLA(o,t,e,r),c=Pe(s,e.slaInterval),u=yield i.invokeDataProcessingQuery(c,e,{});return i.handleBackendPostProcessingResponse(u,r,e)}))()}queryUserMacrosData(e){var t=this;return nn((function*(){const r=e.group.filter,i=e.host.filter,a=e.macro.filter,o=yield t.zabbix.getUMacros(r,i,a),l=n().map(o,"hostmacroid"),s=yield t.zabbix.getUserMacros(l);return ye(s,e)}))()}queryTriggersData(e,t,n){var r=this;return nn((function*(){var i;if("items"===e.countTriggersBy)return r.queryTriggersICData(e,t);if("problems"===e.countTriggersBy)return r.queryTriggersPCData(e,t,n);const[a,o]=yield r.zabbix.getHostsApsFromTarget(e);if(!a.length)return Promise.resolve([]);const l=e.group.filter,s=yield r.zabbix.getGroups(l),c=null==a?void 0:a.map((e=>e.hostid)),u=null==o?void 0:o.map((e=>e.applicationid)),d=hn(e,t),p=_(r.replaceTemplateVars(null===(i=e.tags)||void 0===i?void 0:i.filter,n.scopedVars).replace("/^","").replace("$/",""));p.forEach((e=>{e.operator=1})),p&&p.length&&(d.tags=p);const m=yield r.zabbix.getHostAlerts(c,u,d);return we(m,s,t,e)}))()}queryTriggersICData(e,t){var n=this;return nn((function*(){const[r,i,a]=yield n.zabbix.getHostsFromICTarget(e,{itemtype:"num"});if(!r.length)return Promise.resolve([]);const o=e.group.filter,l=yield n.zabbix.getGroups(o),s=null==r?void 0:r.map((e=>e.hostid)),c=null==i?void 0:i.map((e=>e.applicationid)),u=null==a?void 0:a.map((e=>e.itemid));if(!u.length)return Promise.resolve([]);const d=hn(e,t),p=yield n.zabbix.getHostICAlerts(s,c,u,d);return we(p,l,t,e)}))()}queryTriggersPCData(e,t,n){var r=this;return nn((function*(){var i,a,o,l,s,c,u,d;const[p,m]=t,h=_(r.replaceTemplateVars(null===(i=e.tags)||void 0===i?void 0:i.filter,n.scopedVars).replace("/^","").replace("$/",""));h.forEach((e=>{e.operator=1}));const g={minSeverity:null===(a=e.options)||void 0===a?void 0:a.minSeverity,limit:null===(o=e.options)||void 0===o?void 0:o.limit};var f;if(h&&h.length&&(g.tags=h),(0===(null===(l=e.options)||void 0===l?void 0:l.acknowledged)||1===(null===(s=e.options)||void 0===s?void 0:s.acknowledged))&&(g.acknowledged=!!(null===(f=e.options)||void 0===f?void 0:f.acknowledged)),null===(c=e.options)||void 0===c?void 0:c.minSeverity){var v;let t=[0,1,2,3,4,5].filter((t=>{var n;return t>=(null===(n=e.options)||void 0===n?void 0:n.minSeverity)}));(null===(v=e.options)||void 0===v?void 0:v.severities)&&(t=t.filter((t=>{var n;return null===(n=e.options)||void 0===n?void 0:n.severities.includes(t)}))),g.severities=t}e.options.useTimeRange&&(g.timeFrom=p,g.timeTo=m);const[b,y,E]=yield r.zabbix.getHostsFromPCTarget(e,g);if(!b.length)return Promise.resolve([]);const O=e.group.filter,w=yield r.zabbix.getGroups(O),I=null==b?void 0:b.map((e=>e.hostid)),T=null==y?void 0:y.map((e=>e.applicationid)),x=E.map((e=>e.triggerid)),P={minSeverity:null===(u=e.options)||void 0===u?void 0:u.minSeverity,acknowledged:null===(d=e.options)||void 0===d?void 0:d.acknowledged,count:e.options.count};e.options.useTimeRange&&(P.timeFrom=p,P.timeTo=m);const S=yield r.zabbix.getHostPCAlerts(I,T,x,P);return we(S,w,t,e)}))()}queryProblems(e,t,r){var i=this;return nn((function*(){var o,l,s,c,u,d,p,m,h,g,f,v,b;const[y,E]=t,O=a.contextSrv.isEditor||a.contextSrv.isGrafanaAdmin;let w=!0;const I=e.showProblems||Ke.Problems,T=e.options.hostProxy?i.zabbix.getProxies():()=>[];w=!i.disableReadOnlyUsersAck||O;const x=i.replaceTemplateVars(null===(o=e.group)||void 0===o?void 0:o.filter,r.scopedVars),P=i.replaceTemplateVars(null===(l=e.host)||void 0===l?void 0:l.filter,r.scopedVars),S=i.replaceTemplateVars(null===(s=e.application)||void 0===s?void 0:s.filter,r.scopedVars),A=i.replaceTemplateVars(null===(c=e.proxy)||void 0===c?void 0:c.filter,r.scopedVars),C=i.replaceTemplateVars(null===(u=e.trigger)||void 0===u?void 0:u.filter,r.scopedVars),D=i.replaceTemplateVars(null===(d=e.tags)||void 0===d?void 0:d.filter,r.scopedVars),j=on(an({},e),{trigger:{filter:C},tags:{filter:D}}),F=_(D.replace("/^","").replace("$/",""));F.forEach((e=>{e.operator=1}));const R={recent:I===Ke.Recent,minSeverity:null===(p=e.options)||void 0===p?void 0:p.minSeverity,limit:null===(m=e.options)||void 0===m?void 0:m.limit};var $;if(F&&F.length&&(R.tags=F),(null==e?void 0:e.evaltype)&&(R.evaltype=null==e?void 0:e.evaltype),(0===(null===(h=e.options)||void 0===h?void 0:h.acknowledged)||1===(null===(g=e.options)||void 0===g?void 0:g.acknowledged))&&(R.acknowledged=!!(null===($=e.options)||void 0===$?void 0:$.acknowledged)),null===(v=e.options)||void 0===v||null===(f=v.severities)||void 0===f?void 0:f.length){let t=[0,1,2,3,4,5].filter((t=>{var n;return null===(n=e.options)||void 0===n?void 0:n.severities.includes(t)}));R.severities=t}let N;I===Ke.History||(null===(b=e.options)||void 0===b?void 0:b.useTimeRange)?(R.timeFrom=y,R.timeTo=E,N=i.zabbix.getProblemsHistory(x,P,S,A,R)):N=i.zabbix.getProblems(x,P,S,A,R);const k=i.zabbix.getUsers();let L,M;return Promise.all([N,T,k]).then((([e,t,r])=>(M=n().keyBy(r,"userid"),L=n().keyBy(t,"proxyid"),e))).then((e=>ke(e))).then((e=>Le(e,w))).then((e=>_e(e,j))).then((t=>Me(t,e))).then((t=>Re(t,e))).then((e=>Ne(e,M))).then((e=>$e(e,L))).then((t=>qe(t,e)))}))()}testDatasource(){var e=this;return nn((function*(){try{const{zabbixVersion:t,dbConnectorStatus:n}=yield e.zabbix.testDataSource();let r=`Zabbix API version: ${t}`;return n&&(r+=`, DB connector type: ${n.dsType}`),{status:"success",title:"Success",message:r}}catch(e){return e instanceof pt?{status:"error",title:e.message,message:e.message}:e.data&&e.data.message?{status:"error",title:"Zabbix Client Error",message:e.data.message}:"string"==typeof e?{status:"error",title:"Unknown Error",message:e}:(console.log(e),{status:"error",title:"Connection failed",message:"Could not connect to given url"})}}))()}metricFindQuery(e,t){let r,i=n().cloneDeep(e);if(!e)return Promise.resolve([]);"string"==typeof e&&(i=A(e));for(const e of["group","host","application","itemTag","item"])i[e]=this.replaceTemplateVars(i[e],{});const{group:a,host:o,application:l,item:s}=i;switch(i.queryType){case E.Group:r=this.zabbix.getGroups(i.group);break;case E.Host:r=this.zabbix.getHosts(i.group,i.host);break;case E.Application:r=this.zabbix.getApps(i.group,i.host,i.application);break;case E.ItemTag:r=this.zabbix.getItemTags(i.group,i.host,i.itemTag);break;case E.Item:r=this.zabbix.getItems(i.group,i.host,i.application,null,i.item);break;case E.ItemValues:const e=null==t?void 0:t.range;r=this.zabbix.getItemValues(a,o,l,s,{range:e});break;default:r=Promise.resolve([])}return r.then((e=>n().map(e,cn)))}targetContainsTemplate(e){var t,n,r,i,a,o,l,s;const c=(0,ie.getTemplateSrv)();return c.variableExists(null===(t=e.group)||void 0===t?void 0:t.filter)||c.variableExists(null===(n=e.host)||void 0===n?void 0:n.filter)||c.variableExists(null===(r=e.application)||void 0===r?void 0:r.filter)||c.variableExists(null===(i=e.itemTag)||void 0===i?void 0:i.filter)||c.variableExists(null===(a=e.item)||void 0===a?void 0:a.filter)||c.variableExists(null===(o=e.macro)||void 0===o?void 0:o.filter)||c.variableExists(null===(l=e.proxy)||void 0===l?void 0:l.filter)||c.variableExists(null===(s=e.trigger)||void 0===s?void 0:s.filter)||c.variableExists(e.textFilter)||c.variableExists(e.itServiceFilter)}annotationRequest(t){var n=this;return nn((function*(){const r=t.targets.filter((e=>e.fromAnnotations));if(!r.length)return Promise.resolve({data:[]});const i=yield n.annotationQueryLegacy(on(an({},t),{targets:r}));return{data:[(0,e.toDataFrame)(i)]}}))()}annotationQueryLegacy(e){const t=e.range||e.rangeRaw,r=Math.ceil(o.parse(t.from)/1e3),i=Math.ceil(o.parse(t.to)/1e3),a=e.targets[0],l={value:a.options.showOkEvents?["0","1"]:"1",valueFromEvent:!0,timeFrom:r,timeTo:i};if(a.options.minSeverity){const e=[0,1,2,3,4,5].filter((e=>e>=Number(a.options.minSeverity)));l.severities=e}const c=this.replaceTemplateVars(a.group.filter,{}),u=this.replaceTemplateVars(a.host.filter,{}),d=this.replaceTemplateVars(a.application.filter,{});return this.zabbix.getProblemsHistory(c,u,d,void 0,l).then((e=>{const t=this.replaceTemplateVars(a.trigger.filter,{});return D(t)?e=n().filter(e,(e=>F(t).test(e.description))):t&&(e=n().filter(e,(e=>e.description===t))),a.hideAcknowledged&&(e=n().filter(e,(e=>{var t;return!(null===(t=e.acknowledges)||void 0===t?void 0:t.length)}))),n().map(e,(e=>{const t=function(e){if(e.length){let t="<br><br>Acknowledges:<br><table><tr><td><b>Time</b></td><td><b>User</b></td><td><b>Comments</b></td></tr>";return n().each(n().map(e,(e=>"<tr><td><i>"+s().unix(e.clock).format("DD MMM YYYY HH:mm:ss")+"</i></td><td>"+e.alias+" ("+e.name+" "+e.surname+")</td><td>"+e.message+"</td></tr>")),(e=>{t=t.concat(e)})),t=t.concat("</table>"),t}return""}(e.acknowledges);let r=[];return a.showHostname&&(r=n().map(e.hosts,"name")),{title:"1"===e.value?"Problem":"OK",time:1e3*e.timestamp,annotation:a,text:e.name+t,tags:r}}))}))}replaceTargetVariables(e,t){const r=(0,ie.getTemplateSrv)();n().forEach(["group","host","application","itemTag","item"],(n=>{e[n]&&e[n].filter&&(e[n].filter=this.replaceTemplateVars(e[n].filter,t.scopedVars))})),e.textFilter&&(e.textFilter=this.replaceTemplateVars(e.textFilter,t.scopedVars)),e.itemids&&(e.itemids=r.replace(e.itemids,t.scopedVars,dn)),n().forEach(e.functions,(e=>{e.params=n().map(e.params,(e=>"number"==typeof e?+r.replace(e.toString(),t.scopedVars):r.replace(e,t.scopedVars)))}))}isUseTrends(e,t){if("false"===t.options.useTrends)return!1;const[n,r]=e,i=Math.ceil(o.parse("now-"+this.trendsFrom)/1e3),a=Math.ceil(N(this.trendsRange)/1e3);return("true"===t.options.useTrends||this.trends)&&(n<i||r-n>a)}constructor(e){super(e),rn(this,"name",void 0),rn(this,"basicAuth",void 0),rn(this,"withCredentials",void 0),rn(this,"trends",void 0),rn(this,"trendsFrom",void 0),rn(this,"trendsRange",void 0),rn(this,"cacheTTL",void 0),rn(this,"disableReadOnlyUsersAck",void 0),rn(this,"disableDataAlignment",void 0),rn(this,"enableDirectDBConnection",void 0),rn(this,"dbConnectionDatasourceId",void 0),rn(this,"dbConnectionDatasourceName",void 0),rn(this,"dbConnectionRetentionPolicy",void 0),rn(this,"enableDebugLog",void 0),rn(this,"datasourceId",void 0),rn(this,"zabbix",void 0),rn(this,"replaceTemplateVars",void 0),rn(this,"isBackendTarget",(e=>!this.enableDirectDBConnection&&(e.queryType===c||e.queryType===p))),rn(this,"isDBConnectionTarget",(e=>this.enableDirectDBConnection&&(e.queryType===c||e.queryType===p))),this.enableDebugLog="development"===i().buildInfo.env,this.annotations={QueryEditor:en,prepareAnnotation:X};const t=(0,ie.getTemplateSrv)();this.replaceTemplateVars=n().partial(pn,t),this.datasourceId=e.id,this.name=e.name,this.basicAuth=e.basicAuth,this.withCredentials=e.withCredentials;const r=function(e){if(e||(e={}),!function(e){return!(!e.dbConnection||n().isEmpty(e.dbConnection))||!!(e.schema&&e.schema<3)}(e))return e;const t=e.schema||1;if(e.schema=3,t<2){const t=e.dbConnection||{};e.dbConnectionEnable=t.enable||!1,e.dbConnectionDatasourceId=t.datasourceId||null,delete e.dbConnection}return t<3&&(e.timeout=""===e.timeout?null:Number(e.timeout)),e}(e.jsonData);this.trends=r.trends,this.trendsFrom=r.trendsFrom||"7d",this.trendsRange=r.trendsRange||"4d";const a=r.cacheTTL||"1h";this.cacheTTL=N(a),this.disableReadOnlyUsersAck=r.disableReadOnlyUsersAck,this.disableDataAlignment=r.disableDataAlignment,this.enableDirectDBConnection=r.dbConnectionEnable||!1,this.dbConnectionDatasourceId=r.dbConnectionDatasourceId,this.dbConnectionDatasourceName=r.dbConnectionDatasourceName,this.dbConnectionRetentionPolicy=r.dbConnectionRetentionPolicy;const o={basicAuth:this.basicAuth,withCredentials:this.withCredentials,cacheTTL:this.cacheTTL,enableDirectDBConnection:this.enableDirectDBConnection,dbConnectionDatasourceId:this.dbConnectionDatasourceId,dbConnectionDatasourceName:this.dbConnectionDatasourceName,dbConnectionRetentionPolicy:this.dbConnectionRetentionPolicy,datasourceId:this.datasourceId};this.zabbix=new Dt(o)}}function sn(e,t){const r=n().map(re()[t],"name"),i=n().filter(e,(e=>n().includes(r,e.def.name)));return n().map(i,(e=>ne(e.def,e.params).bindFunction(le.metricFunctions)))}function cn(e){return{text:e.name,expandable:!1}}function un(e){return"string"==typeof e?R(e):"("+n().map(e,R).join("|")+")"}function dn(e){return"string"==typeof e?e:e.join(",")}function pn(e,t,n){let r=e.replace(t,n,un);return t&&t!==r&&!D(r)&&(r="/^"+r+"$/"),r}function mn(e,t){for(let n=0;n<e.targets.length;n++){const r=e.targets[n];if(r.refId===t)return r}return null}const hn=(e,t)=>{var n,r,i,a;const[o,l]=t,s={minSeverity:null===(n=e.options)||void 0===n?void 0:n.minSeverity,acknowledged:null===(r=e.options)||void 0===r?void 0:r.acknowledged,count:null===(i=e.options)||void 0===i?void 0:i.count};return(null===(a=e.options)||void 0===a?void 0:a.useTimeRange)&&(s.timeFrom=o,s.timeTo=l),s};function gn(e,t,n,r,i,a,o){try{var l=e[a](o),s=l.value}catch(e){return void n(e)}l.done?t(s):Promise.resolve(s).then(r,i)}function fn(e){return function(){var t=this,n=arguments;return new Promise((function(r,i){var a=e.apply(t,n);function o(e){gn(a,r,i,o,l,"next",e)}function l(e){gn(a,r,i,o,l,"throw",e)}o(void 0)}))}}function vn(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}const bn=({query:e,datasource:t,onChange:r})=>{var i,a,o,l;const s=(c=fn((function*(){const e=yield t.zabbix.getAllGroups(),n=null==e?void 0:e.map((e=>({value:e.name,label:e.name})));return n.unshift(...Gt()),n})),function(){return c.apply(this,arguments)});var c;const[{loading:u,value:d},p]=Lt(fn((function*(){return yield s()})),[]),m=function(){var e=fn((function*(e){const r=t.replaceTemplateVars(e),i=yield t.zabbix.getAllHosts(r);let a=null==i?void 0:i.map((e=>({value:e.name,label:e.name})));return a=n().uniqBy(a,(e=>e.value)),a.unshift({value:"/.*/"}),a.unshift(...Gt()),a}));return function(t){return e.apply(this,arguments)}}(),[{loading:h,value:g},f]=Lt(fn((function*(){return yield m(e.group.filter)})),[e.group.filter]),v=function(){var e=fn((function*(e,r){const i=t.replaceTemplateVars(e),a=t.replaceTemplateVars(r),o=yield t.zabbix.getAllApps(i,a);let l=null==o?void 0:o.map((e=>({value:e.name,label:e.name})));return l=n().uniqBy(l,(e=>e.value)),l.unshift(...Gt()),l}));return function(t,n){return e.apply(this,arguments)}}(),[{loading:b,value:y},E]=Lt(fn((function*(){return yield v(e.group.filter,e.host.filter)})),[e.group.filter,e.host.filter]),O=function(){var e=fn((function*(e,r){if(!(yield t.zabbix.isZabbix54OrHigher()))return[];const i=t.replaceTemplateVars(e),a=t.replaceTemplateVars(r),o=yield t.zabbix.getAllItems(i,a,null,null,{}),l=n().flatten(o.map((e=>e.tags||[]))),s=n().uniqBy(l,(e=>e.tag+e.value||"")).map((e=>q(e)));let c=null==s?void 0:s.map((e=>({value:e,label:e})));return c=n().uniqBy(c,(e=>e.value)),c.unshift(...Gt()),c}));return function(t,n){return e.apply(this,arguments)}}(),[{loading:w,value:I},T]=Lt(fn((function*(){return yield O(e.group.filter,e.host.filter)})),[e.group.filter,e.host.filter]),x=function(){var r=fn((function*(r,i,a,o){const l=t.replaceTemplateVars(r),s=t.replaceTemplateVars(i),c=t.replaceTemplateVars(a),u=t.replaceTemplateVars(o),d={itemtype:"num",showDisabledItems:e.options.showDisabledItems},p=yield t.zabbix.getAllItems(l,s,c,u,d);let m=null==p?void 0:p.map((e=>({value:e.name,label:e.name})));return m=n().uniqBy(m,(e=>e.value)),m.unshift(...Gt()),m}));return function(e,t,n,i){return r.apply(this,arguments)}}(),[{loading:P,value:S},A]=Lt(fn((function*(){return yield x(e.group.filter,e.host.filter,e.application.filter,e.itemTag.filter)})),[e.group.filter,e.host.filter,e.application.filter,e.itemTag.filter]),C=t.replaceTemplateVars(null===(i=e.group)||void 0===i?void 0:i.filter),D=t.replaceTemplateVars(null===(a=e.host)||void 0===a?void 0:a.filter),j=t.replaceTemplateVars(null===(o=e.application)||void 0===o?void 0:o.filter),F=t.replaceTemplateVars(null===(l=e.itemTag)||void 0===l?void 0:l.filter);(0,$t.useEffect)((()=>{p()}),[]),(0,$t.useEffect)((()=>{f()}),[C]),(0,$t.useEffect)((()=>{E()}),[C,D]),(0,$t.useEffect)((()=>{T()}),[C,D]),(0,$t.useEffect)((()=>{A()}),[C,D,j,F]);const R=t=>n=>{var i,a;null!==n&&r((i=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){vn(e,t,n[t])}))}return e}({},e),a=null!=(a={[t]:{filter:n}})?a:{},Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(a)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n.push.apply(n,r)}return n}(Object(a)).forEach((function(e){Object.defineProperty(i,e,Object.getOwnPropertyDescriptor(a,e))})),i))},$=t.zabbix.supportsApplications();return Nt().createElement(Nt().Fragment,null,Nt().createElement(qt,null,Nt().createElement(_t.InlineField,{label:"Group",labelWidth:12},Nt().createElement(Wt,{width:24,value:e.group.filter,options:d,isLoading:u,onChange:R("group")})),Nt().createElement(_t.InlineField,{label:"Host",labelWidth:12},Nt().createElement(Wt,{width:24,value:e.host.filter,options:g,isLoading:h,onChange:R("host")}))),Nt().createElement(qt,null,$&&Nt().createElement(_t.InlineField,{label:"Application",labelWidth:12},Nt().createElement(Wt,{width:24,value:e.application.filter,options:y,isLoading:b,onChange:R("application")})),!$&&Nt().createElement(_t.InlineField,{label:"Item tag",labelWidth:12},Nt().createElement(Wt,{width:24,value:e.itemTag.filter,options:I,isLoading:w,onChange:R("itemTag")})),Nt().createElement(_t.InlineField,{label:"Item",labelWidth:12},Nt().createElement(Wt,{width:24,value:e.item.filter,options:S,isLoading:P,onChange:R("item")}))))},yn=e=>Nt().createElement(_t.Icon,{className:"pointer",name:"question-circle",onClick:()=>{window.open(`https://grafana.com/docs/plugins/alexanderzobnin-zabbix-app/latest/reference/functions/#${e.name}`,"_blank")}}),En=e=>{const{func:t,onMoveLeft:n,onMoveRight:r,onRemove:i}=e;return Nt().createElement("div",{style:{display:"flex",width:"60px",justifyContent:"space-between"}},Nt().createElement(_t.Icon,{className:"pointer",name:"arrow-left",onClick:()=>n(t)}),Nt().createElement(yn,{name:t.def.name,description:t.def.description}),Nt().createElement(_t.Icon,{className:"pointer",name:"times",onClick:()=>i(t)}),Nt().createElement(_t.Icon,{className:"pointer",name:"arrow-right",onClick:()=>r(t)}))};function On(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}const wn=e=>({icon:Mt.css`
      margin-right: ${e.spacing(.5)};
    `,label:(0,Mt.css)({fontWeight:e.typography.fontWeightMedium,fontSize:e.typography.bodySmall.fontSize,cursor:"pointer",display:"inline-block"})}),In=e=>{var{onMoveLeft:t,onMoveRight:n,func:r}=e,i=function(e,t){if(null==e)return{};var n,r,i=function(e,t){if(null==e)return{};var n,r,i={},a=Object.keys(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}(e,["onMoveLeft","onMoveRight","func"]);const a=(0,_t.useStyles2)(wn);return Nt().createElement(_t.Tooltip,{content:({updatePopperPosition:e})=>{return Nt().createElement(En,(a=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){On(e,t,n[t])}))}return e}({},i),o=null!=(o={func:r,onMoveLeft:()=>{t(r),e()},onMoveRight:()=>{n(r),e()}})?o:{},Object.getOwnPropertyDescriptors?Object.defineProperties(a,Object.getOwnPropertyDescriptors(o)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n.push.apply(n,r)}return n}(Object(o)).forEach((function(e){Object.defineProperty(a,e,Object.getOwnPropertyDescriptor(o,e))})),a));var a,o},placement:"top",interactive:!0},Nt().createElement("span",{className:a.label},r.def.name))};function Tn({editableParam:e,onChange:t,onExpandedChange:n,autofocus:r}){var i;const a=(0,_t.useStyles2)(xn);return(null===(i=e.options)||void 0===i?void 0:i.length)>0?Nt().createElement(_t.Segment,{autofocus:r,value:e.value,inputPlaceholder:e.name,className:a.segment,options:e.options,placeholder:" +"+e.name,onChange:e=>{t(e.value||"")},onExpandedChange:n,inputMinWidth:150,allowCustomValue:!0,allowEmptyValue:!0}):Nt().createElement(_t.SegmentInput,{autofocus:r,className:a.input,value:e.value||"",placeholder:" +"+e.name,inputPlaceholder:e.name,onChange:e=>{t(e.toString())},onExpandedChange:n,style:{height:"25px",paddingTop:"2px",marginTop:"2px",paddingLeft:"4px",minWidth:"100px"}})}const xn=e=>({segment:(0,Mt.css)({margin:0,padding:0}),input:Mt.css`
    margin: 0;
    padding: 0;
    input {
      height: 25px;
    },
  `});function Pn(e,t,n){var r,i;return{name:e.name,value:(null==n?void 0:n.toString())||"",optional:!!e.optional||t,multiple:!!e.multiple,options:null!==(i=null===(r=e.options)||void 0===r?void 0:r.map((e=>({value:e.toString(),label:e.toString()}))))&&void 0!==i?i:[]}}function Sn({func:e,onMoveLeft:t,onMoveRight:n,onRemove:r,onParamChange:i}){const a=(0,_t.useStyles2)(An),[o,l]=(0,$t.useState)(!1),[s,c]=(0,$t.useState)(!1);let u=function(e){var t;const n=e.def.params.map(((t,n)=>Pn(t,!1,e.params[n])));for(;n.length<e.params.length;){const t=e.def.params[e.def.params.length-1],r=e.params[n.length];n.push(Pn(t,!0,r))}if(n.length&&n[n.length-1].value&&(null===(t=n[n.length-1])||void 0===t?void 0:t.multiple)){const t=e.def.params[e.def.params.length-1];n.push(Pn(t,!0,""))}return n}(e);return u=u.filter(((t,n)=>n<e.def.params.length&&!t.optional||e.added||t.value||s||o)),Nt().createElement("div",{className:(0,Mt.cx)(a.container),onMouseOver:()=>l(!0),onMouseLeave:()=>l(!1)},Nt().createElement(_t.HorizontalGroup,{spacing:"none"},Nt().createElement(In,{func:e,onMoveLeft:t,onMoveRight:n,onRemove:r}),Nt().createElement(_t.InlineLabel,{className:a.label},"("),u.map(((t,n)=>Nt().createElement(Nt().Fragment,{key:n},Nt().createElement(Tn,{autofocus:0===n&&e.added,editableParam:t,onChange:r=>{(""!==r||t.optional)&&i(e,n,r),c(!1),l(!1)},onExpandedChange:c}),n!==u.length-1?",":""))),Nt().createElement(_t.InlineLabel,{className:a.label},")")))}const An=e=>({container:(0,Mt.css)({backgroundColor:e.colors.background.secondary,borderRadius:e.shape.borderRadius(),marginRight:e.spacing(.5),padding:`0 ${e.spacing(1)}`,height:`${e.v1.spacing.formInputHeight}px`}),error:Mt.css`
    border: 1px solid ${e.colors.error.main};
  `,label:(0,Mt.css)({padding:0,margin:0}),button:(0,Mt.css)({padding:e.spacing(.5)})});function Cn({onFuncAdd:e}){const[t,n]=(0,$t.useState)(!1),r=(0,_t.useStyles2)(Dn),i=(0,_t.useTheme2)(),a=t=>{e(t),n(!1)},o=(0,$t.useMemo)((()=>function(e){const t=re(),n=[];for(const r in t){const i=t[r].map((t=>Nt().createElement(_t.Menu.Item,{label:t.name,key:t.name,onClick:()=>e(t)})));n.push(Nt().createElement(_t.Menu.Item,{label:r,key:r,childItems:i}))}return n}(a)),[e]);return Nt().createElement("div",null,!t&&Nt().createElement(_t.Button,{icon:"plus",variant:"secondary",className:(0,Mt.cx)(r.button),"aria-label":"Add new function",onClick:()=>n(!t)}),t&&Nt().createElement(_t.ClickOutsideWrapper,{onClick:()=>{n(!1)},useCapture:!0},Nt().createElement(_t.Input,{onChange:e=>{console.log(e.currentTarget.value)},suffix:Nt().createElement(_t.Icon,{name:"search"})}),Nt().createElement(_t.Menu,{style:{position:"absolute",zIndex:i.zIndex.dropdown}},o)))}function Dn(e){return{button:Mt.css`
      margin-right: ${e.spacing(.5)};
    `}}function jn(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Fn(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){jn(e,t,n[t])}))}return e}function Rn(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n.push.apply(n,r)}return n}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}const $n=({query:e,onChange:t})=>{var n;const r=(n,r,i)=>{n.params[r]=i;const a=e.functions.findIndex((e=>e===n)),o=e.functions;o[a]=n,t(Rn(Fn({},e),{functions:o}))},i=n=>{const r=e.functions.indexOf(n),i=W(e.functions,r,r-1);t(Rn(Fn({},e),{functions:i}))},a=n=>{const r=e.functions.indexOf(n),i=W(e.functions,r,r+1);t(Rn(Fn({},e),{functions:i}))},o=n=>{var r;const i=null===(r=e.functions)||void 0===r?void 0:r.filter((e=>e!==n));t(Rn(Fn({},e),{functions:i}))};return Nt().createElement(qt,null,Nt().createElement(_t.InlineFormLabel,{width:6},"Functions"),null===(n=e.functions)||void 0===n?void 0:n.map(((e,t)=>Nt().createElement(Sn,{func:e,key:t,onParamChange:r,onMoveLeft:i,onMoveRight:a,onRemove:o}))),Nt().createElement(Cn,{onFuncAdd:n=>{const r=ne(n);r.added=!0;let i=e.functions.concat(r);i=function(e){const t=e.findIndex((e=>"Alias"===e.def.category));if(console.log(t),t>=0){const n=e[t];e.splice(t,1),e.push(n)}return e}(i),t(Rn(Fn({},e),{functions:i}))}}))};function Nn(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function kn(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){Nn(e,t,n[t])}))}return e}function Ln(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n.push.apply(n,r)}return n}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}const _n=[{label:"all triggers",value:2},{label:"unacknowledged",value:0},{label:"acknowledged",value:1}],Mn=[{label:"Default",value:"default"},{label:"Last change",value:"lastchange"},{label:"Severity",value:"severity"}],qn=[{label:"Default",value:"default"},{label:"True",value:"true"},{label:"False",value:"false"}],Vn=({queryType:e,queryOptions:t,onChange:n})=>{const[r,i]=(0,$t.useState)(!1),a=(0,_t.useStyles2)(Bn),o=e=>{var r;const i=Number(null==e||null===(r=e.currentTarget)||void 0===r?void 0:r.value);null!==i&&n(Ln(kn({},t),{limit:i}))},l=e=>r=>{null!==r.value&&n(Ln(kn({},t),{[e]:r.value}))},s=()=>Nt().createElement(Nt().Fragment,null,Nt().createElement(_t.InlineField,{label:"Trends",labelWidth:24},Nt().createElement(_t.Select,{isSearchable:!1,width:16,value:t.useTrends,options:qn,onChange:l("useTrends")})),Nt().createElement(_t.InlineField,{label:"Show disabled items",labelWidth:24},Nt().createElement(_t.InlineSwitch,{value:t.showDisabledItems,onChange:()=>n(Ln(kn({},t),{showDisabledItems:!t.showDisabledItems}))})),Nt().createElement(_t.InlineField,{label:"Use Zabbix value mapping",labelWidth:24},Nt().createElement(_t.InlineSwitch,{value:t.useZabbixValueMapping,onChange:()=>n(Ln(kn({},t),{useZabbixValueMapping:!t.useZabbixValueMapping}))})),Nt().createElement(_t.InlineField,{label:"Disable data alignment",labelWidth:24},Nt().createElement(_t.InlineSwitch,{value:t.disableDataAlignment,onChange:()=>n(Ln(kn({},t),{disableDataAlignment:!t.disableDataAlignment}))})));return Nt().createElement(Nt().Fragment,null,Nt().createElement(_t.InlineFieldRow,null,Nt().createElement("div",{className:a.container,onClick:()=>i(!r)},Nt().createElement(Nt().Fragment,null,Nt().createElement(_t.HorizontalGroup,null,!r&&Nt().createElement(_t.Icon,{name:"angle-right"}),r&&Nt().createElement(_t.Icon,{name:"angle-down"}),Nt().createElement("span",{className:a.label},"Options"),Nt().createElement("div",{className:a.options},(()=>{const e=[];for(const n in t)if(t.hasOwnProperty(n)){const r=t[n];!0===r&&""!==r&&null!=r&&e.push(Nt().createElement("span",{className:a.optionContainer,key:n},`${n} = ${r}`))}return e})()))))),Nt().createElement(_t.InlineFieldRow,null,r&&Nt().createElement("div",{className:a.editorContainer},e===c&&s(),e===p&&s(),e===u&&s(),e===d&&Nt().createElement(Nt().Fragment,null,Nt().createElement(_t.InlineField,{label:"Show disabled items",labelWidth:24},Nt().createElement(_t.InlineSwitch,{value:t.showDisabledItems,onChange:()=>n(Ln(kn({},t),{showDisabledItems:!t.showDisabledItems}))}))),e===h&&Nt().createElement(Nt().Fragment,null,Nt().createElement(_t.InlineField,{label:"Acknowledged",labelWidth:24},Nt().createElement(_t.Select,{isSearchable:!1,width:24,value:t.acknowledged,options:_n,onChange:l("acknowledged")})),Nt().createElement(_t.InlineField,{label:"Sort by",labelWidth:24},Nt().createElement(_t.Select,{isSearchable:!1,width:24,value:t.sortProblems,options:Mn,onChange:l("sortProblems")})),Nt().createElement(_t.InlineField,{label:"Use time range",labelWidth:24},Nt().createElement(_t.InlineSwitch,{value:t.useTimeRange,onChange:()=>n(Ln(kn({},t),{useTimeRange:!t.useTimeRange}))})),Nt().createElement(_t.InlineField,{label:"Hosts in maintenance",labelWidth:24},Nt().createElement(_t.InlineSwitch,{value:t.hostsInMaintenance,onChange:()=>n(Ln(kn({},t),{hostsInMaintenance:!t.hostsInMaintenance}))})),Nt().createElement(_t.InlineField,{label:"Host proxy",labelWidth:24},Nt().createElement(_t.InlineSwitch,{value:t.hostProxy,onChange:()=>n(Ln(kn({},t),{hostProxy:!t.hostProxy}))})),Nt().createElement(_t.InlineField,{label:"Limit",labelWidth:24},Nt().createElement(_t.Input,{width:12,type:"number",defaultValue:t.limit,onBlur:o}))),e===m&&Nt().createElement(Nt().Fragment,null,Nt().createElement(_t.InlineField,{label:"Acknowledged",labelWidth:24},Nt().createElement(_t.Select,{isSearchable:!1,width:24,value:t.acknowledged,options:_n,onChange:l("acknowledged")})),Nt().createElement(_t.InlineField,{label:"Use time range",labelWidth:24},Nt().createElement(_t.InlineSwitch,{value:t.useTimeRange,onChange:()=>n(Ln(kn({},t),{useTimeRange:!t.useTimeRange}))}))))))},Bn=e=>({container:(0,Mt.css)({backgroundColor:e.colors.background.secondary,borderRadius:e.shape.borderRadius(),marginRight:e.spacing(.5),marginBottom:e.spacing(.5),padding:`0 ${e.spacing(1)}`,height:`${e.v1.spacing.formInputHeight}px`,width:"100%"}),label:(0,Mt.css)({color:e.colors.info.text,fontWeight:e.typography.fontWeightMedium,cursor:"pointer"}),options:(0,Mt.css)({color:e.colors.text.disabled,fontSize:e.typography.bodySmall.fontSize}),optionContainer:Mt.css`
    margin-right: ${e.spacing(2)};
  `,editorContainer:Mt.css`
    display: flex;
    flex-direction: column;
    margin-left: ${e.spacing(4)};
  `});function Hn(e,t,n,r,i,a,o){try{var l=e[a](o),s=l.value}catch(e){return void n(e)}l.done?t(s):Promise.resolve(s).then(r,i)}function zn(e){return function(){var t=this,n=arguments;return new Promise((function(r,i){var a=e.apply(t,n);function o(e){Hn(a,r,i,o,l,"next",e)}function l(e){Hn(a,r,i,o,l,"throw",e)}o(void 0)}))}}function Wn(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Un(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){Wn(e,t,n[t])}))}return e}function Gn(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n.push.apply(n,r)}return n}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}const Qn=({query:e,datasource:t,onChange:r})=>{var i,a,o,l;const s=(c=zn((function*(){const e=yield t.zabbix.getAllGroups(),n=null==e?void 0:e.map((e=>({value:e.name,label:e.name})));return n.unshift(...Gt()),n})),function(){return c.apply(this,arguments)});var c;const[{loading:u,value:d},p]=Lt(zn((function*(){return yield s()})),[]),m=function(){var e=zn((function*(e){const r=t.replaceTemplateVars(e),i=yield t.zabbix.getAllHosts(r);let a=null==i?void 0:i.map((e=>({value:e.name,label:e.name})));return a=n().uniqBy(a,(e=>e.value)),a.unshift({value:"/.*/"}),a.unshift(...Gt()),a}));return function(t){return e.apply(this,arguments)}}(),[{loading:h,value:g},f]=Lt(zn((function*(){return yield m(e.group.filter)})),[e.group.filter]),v=function(){var e=zn((function*(e,r){const i=t.replaceTemplateVars(e),a=t.replaceTemplateVars(r),o=yield t.zabbix.getAllApps(i,a);let l=null==o?void 0:o.map((e=>({value:e.name,label:e.name})));return l=n().uniqBy(l,(e=>e.value)),l.unshift(...Gt()),l}));return function(t,n){return e.apply(this,arguments)}}(),[{loading:b,value:y},E]=Lt(zn((function*(){return yield v(e.group.filter,e.host.filter)})),[e.group.filter,e.host.filter]),O=function(){var r=zn((function*(r,i,a,o){const l=t.replaceTemplateVars(r),s=t.replaceTemplateVars(i),c=t.replaceTemplateVars(a),u=t.replaceTemplateVars(o),d={itemtype:"text",showDisabledItems:e.options.showDisabledItems},p=yield t.zabbix.getAllItems(l,s,c,u,d);let m=null==p?void 0:p.map((e=>({value:e.name,label:e.name})));return m=n().uniqBy(m,(e=>e.value)),m.unshift(...Gt()),m}));return function(e,t,n,i){return r.apply(this,arguments)}}(),[{loading:w,value:I},T]=Lt(zn((function*(){return yield O(e.group.filter,e.host.filter,e.application.filter,e.itemTag.filter)})),[e.group.filter,e.host.filter,e.application.filter,e.itemTag.filter]),x=t.replaceTemplateVars(null===(i=e.group)||void 0===i?void 0:i.filter),P=t.replaceTemplateVars(null===(a=e.host)||void 0===a?void 0:a.filter),S=t.replaceTemplateVars(null===(o=e.application)||void 0===o?void 0:o.filter),A=t.replaceTemplateVars(null===(l=e.itemTag)||void 0===l?void 0:l.filter);(0,$t.useEffect)((()=>{p()}),[]),(0,$t.useEffect)((()=>{f()}),[x]),(0,$t.useEffect)((()=>{E()}),[x,P]),(0,$t.useEffect)((()=>{T()}),[x,P,S,A]);const C=t=>n=>{null!==n&&r(Gn(Un({},e),{[t]:{filter:n}}))};return Nt().createElement(Nt().Fragment,null,Nt().createElement(qt,null,Nt().createElement(_t.InlineField,{label:"Group",labelWidth:12},Nt().createElement(Wt,{width:24,value:e.group.filter,options:d,isLoading:u,onChange:C("group")})),Nt().createElement(_t.InlineField,{label:"Host",labelWidth:12},Nt().createElement(Wt,{width:24,value:e.host.filter,options:g,isLoading:h,onChange:C("host")}))),Nt().createElement(qt,null,Nt().createElement(_t.InlineField,{label:"Application",labelWidth:12},Nt().createElement(Wt,{width:24,value:e.application.filter,options:y,isLoading:b,onChange:C("application")})),Nt().createElement(_t.InlineField,{label:"Item",labelWidth:12},Nt().createElement(Wt,{width:24,value:e.item.filter,options:I,isLoading:w,onChange:C("item")}))),Nt().createElement(qt,null,Nt().createElement(_t.InlineField,{label:"Text filter",labelWidth:12},Nt().createElement(_t.Input,{width:24,defaultValue:e.textFilter,onBlur:t=>{var n;const i=null==t||null===(n=t.currentTarget)||void 0===n?void 0:n.value;null!==i&&r(Gn(Un({},e),{textFilter:i}))}})),Nt().createElement(_t.InlineField,{label:"Use capture groups",labelWidth:18},Nt().createElement(_t.InlineSwitch,{value:e.useCaptureGroups,onChange:()=>r(Gn(Un({},e),{useCaptureGroups:!e.useCaptureGroups}))}))))};function Jn(e,t,n,r,i,a,o){try{var l=e[a](o),s=l.value}catch(e){return void n(e)}l.done?t(s):Promise.resolve(s).then(r,i)}function Xn(e){return function(){var t=this,n=arguments;return new Promise((function(r,i){var a=e.apply(t,n);function o(e){Jn(a,r,i,o,l,"next",e)}function l(e){Jn(a,r,i,o,l,"throw",e)}o(void 0)}))}}function Zn(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Yn(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){Zn(e,t,n[t])}))}return e}function Kn(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n.push.apply(n,r)}return n}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}const er=[{label:"Problems",value:"problems"},{label:"Recent problems",value:"recent"},{label:"History",value:"history"}],tr=[{value:0,label:"Not classified"},{value:1,label:"Information"},{value:2,label:"Warning"},{value:3,label:"Average"},{value:4,label:"High"},{value:5,label:"Disaster"}],nr=[{label:"AND/OR",value:et.AndOr},{label:"OR",value:et.Or}],rr=({query:e,datasource:t,onChange:r})=>{var i,a,o,l,s,c,u,d,p;const m=(h=Xn((function*(){const e=yield t.zabbix.getAllGroups(),n=null==e?void 0:e.map((e=>({value:e.name,label:e.name})));return n.unshift(...Gt()),n})),function(){return h.apply(this,arguments)});var h;const[{loading:g,value:f},v]=Lt(Xn((function*(){return yield m()})),[]),b=function(){var e=Xn((function*(e){const r=t.replaceTemplateVars(e),i=yield t.zabbix.getAllHosts(r);let a=null==i?void 0:i.map((e=>({value:e.name,label:e.name})));return a=n().uniqBy(a,(e=>e.value)),a.unshift({value:"/.*/"}),a.unshift(...Gt()),a}));return function(t){return e.apply(this,arguments)}}(),[{loading:y,value:E},O]=Lt(Xn((function*(){return yield b(e.group.filter)})),[e.group.filter]),w=function(){var e=Xn((function*(e,r){const i=t.replaceTemplateVars(e),a=t.replaceTemplateVars(r),o=yield t.zabbix.getAllApps(i,a);let l=null==o?void 0:o.map((e=>({value:e.name,label:e.name})));return l=n().uniqBy(l,(e=>e.value)),l.unshift(...Gt()),l}));return function(t,n){return e.apply(this,arguments)}}(),[{loading:I,value:T},x]=Lt(Xn((function*(){return yield w(e.group.filter,e.host.filter)})),[e.group.filter,e.host.filter]),P=function(){var e=Xn((function*(){const e=yield t.zabbix.getProxies(),n=null==e?void 0:e.map((e=>({value:e.host,label:e.host})));return n.unshift(...Gt()),n}));return function(){return e.apply(this,arguments)}}(),[{loading:S,value:A},C]=Lt(Xn((function*(){return yield P()})),[]),D=t.replaceTemplateVars(null===(i=e.group)||void 0===i?void 0:i.filter),j=t.replaceTemplateVars(null===(a=e.host)||void 0===a?void 0:a.filter);(0,$t.useEffect)((()=>{v()}),[]),(0,$t.useEffect)((()=>{O()}),[D]),(0,$t.useEffect)((()=>{x()}),[D,j]),(0,$t.useEffect)((()=>{C()}),[]);const F=t=>n=>{var i;const a=null==n||null===(i=n.currentTarget)||void 0===i?void 0:i.value;null!==a&&r(Kn(Yn({},e),{[t]:{filter:a}}))},R=t=>n=>{null!==n&&r(Kn(Yn({},e),{[t]:{filter:n}}))},$=t=>n=>{null!==n.value&&r(Kn(Yn({},e),{[t]:n.value}))},N=t.zabbix.supportsApplications();return Nt().createElement(Nt().Fragment,null,Nt().createElement(qt,null,Nt().createElement(_t.InlineField,{label:"Group",labelWidth:12},Nt().createElement(Wt,{width:24,value:null===(o=e.group)||void 0===o?void 0:o.filter,options:f,isLoading:g,onChange:R("group")})),Nt().createElement(_t.InlineField,{label:"Host",labelWidth:12},Nt().createElement(Wt,{width:24,value:null===(l=e.host)||void 0===l?void 0:l.filter,options:E,isLoading:y,onChange:R("host")})),Nt().createElement(_t.InlineField,{label:"Proxy",labelWidth:12},Nt().createElement(Wt,{width:24,value:null===(s=e.proxy)||void 0===s?void 0:s.filter,options:A,isLoading:S,onChange:R("proxy")}))),Nt().createElement(qt,null,N&&Nt().createElement(_t.InlineField,{label:"Application",labelWidth:12},Nt().createElement(Wt,{width:24,value:null===(c=e.application)||void 0===c?void 0:c.filter,options:T,isLoading:I,onChange:R("application")})),Nt().createElement(_t.InlineField,{label:"Problem",labelWidth:12},Nt().createElement(_t.Input,{width:24,defaultValue:null===(u=e.trigger)||void 0===u?void 0:u.filter,placeholder:"Problem name",onBlur:F("trigger")})),Nt().createElement(_t.InlineField,{label:"Tags",labelWidth:12},Nt().createElement(_t.Input,{width:36,defaultValue:null===(d=e.tags)||void 0===d?void 0:d.filter,placeholder:"tag1:value1, tag2:value2",onBlur:F("tags")})),Nt().createElement(_t.InlineField,null,Nt().createElement(_t.Select,{isSearchable:!1,width:15,value:e.evaltype,options:nr,onChange:$("evaltype")}))),Nt().createElement(qt,null,Nt().createElement(_t.InlineField,{label:"Show",labelWidth:12},Nt().createElement(_t.Select,{isSearchable:!1,width:24,value:e.showProblems,options:er,onChange:$("showProblems")})),Nt().createElement(_t.InlineField,{label:"Severity",labelWidth:12},Nt().createElement(_t.MultiSelect,{isSearchable:!1,isClearable:!0,placeholder:"Show all problems",value:null===(p=e.options)||void 0===p?void 0:p.severities,options:tr,onChange:t=>{null!==t&&r(Kn(Yn({},e),{options:Kn(Yn({},e.options),{severities:t.map((e=>e.value))})}))}}))))};function ir(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}const ar=({query:e,onChange:t})=>Nt().createElement(qt,null,Nt().createElement(_t.InlineField,{label:"Item Ids",labelWidth:12},Nt().createElement(_t.Input,{width:24,defaultValue:e.itemids,onBlur:n=>{var r;const i=null==n||null===(r=n.currentTarget)||void 0===r?void 0:r.value;var a,o;null!==i&&t((a=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){ir(e,t,n[t])}))}return e}({},e),o=null!=(o={itemids:i})?o:{},Object.getOwnPropertyDescriptors?Object.defineProperties(a,Object.getOwnPropertyDescriptors(o)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n.push.apply(n,r)}return n}(Object(o)).forEach((function(e){Object.defineProperty(a,e,Object.getOwnPropertyDescriptor(o,e))})),a))}})));function or(e,t,n,r,i,a,o){try{var l=e[a](o),s=l.value}catch(e){return void n(e)}l.done?t(s):Promise.resolve(s).then(r,i)}function lr(e){return function(){var t=this,n=arguments;return new Promise((function(r,i){var a=e.apply(t,n);function o(e){or(a,r,i,o,l,"next",e)}function l(e){or(a,r,i,o,l,"throw",e)}o(void 0)}))}}function sr(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function cr(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){sr(e,t,n[t])}))}return e}function ur(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n.push.apply(n,r)}return n}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}const dr=[{label:"Status",value:"status"},{label:"SLI",value:"sli"},{label:"Uptime",value:"uptime"},{label:"Downtime",value:"downtime"},{label:"Error budget",value:"error_budget"}],pr=[{label:"No interval",value:"none"},{label:"Auto",value:"auto"},{label:"1 hour",value:"1h"},{label:"12 hours",value:"12h"},{label:"24 hours",value:"1d"},{label:"1 week",value:"1w"},{label:"1 month",value:"1M"}],mr=({query:e,datasource:t,onChange:n})=>{const r=(i=lr((function*(){const e=yield t.zabbix.getITService(),n=null==e?void 0:e.map((e=>({value:e.name,label:e.name})));return n.unshift(...Gt()),n})),function(){return i.apply(this,arguments)});var i;const[{loading:a,value:o},l]=Lt(lr((function*(){return yield r()})),[]),s=function(){var e=lr((function*(){const e=yield t.zabbix.getSLAList(),n=null==e?void 0:e.map((e=>({value:e.name,label:e.name})));return n.unshift(...Gt()),n}));return function(){return e.apply(this,arguments)}}(),[{loading:c,value:u},d]=Lt(lr((function*(){return yield s()})),[]);(0,$t.useEffect)((()=>{l(),d()}),[]);const p=t=>r=>{r.value&&n(ur(cr({},e),{[t]:r.value}))},m=t=>r=>{void 0!==r&&n(ur(cr({},e),{[t]:r}))};return Nt().createElement(Nt().Fragment,null,Nt().createElement(qt,null,Nt().createElement(_t.InlineField,{label:"Service",labelWidth:12},Nt().createElement(Wt,{width:24,value:e.itServiceFilter,options:o,isLoading:a,onChange:m("itServiceFilter")})),Nt().createElement(_t.InlineField,{label:"SLA",labelWidth:12},Nt().createElement(Wt,{width:24,value:e.slaFilter,options:u,isLoading:c,onChange:m("slaFilter")}))),Nt().createElement(qt,null,Nt().createElement(_t.InlineField,{label:"Property",labelWidth:12},Nt().createElement(_t.Select,{isSearchable:!1,width:24,value:e.slaProperty,options:dr,onChange:p("slaProperty")})),Nt().createElement(_t.InlineField,{label:"Interval",labelWidth:12},Nt().createElement(_t.Select,{isSearchable:!1,width:24,value:e.slaInterval,options:pr,onChange:p("slaInterval")}))))};function hr(e,t,n,r,i,a,o){try{var l=e[a](o),s=l.value}catch(e){return void n(e)}l.done?t(s):Promise.resolve(s).then(r,i)}function gr(e){return function(){var t=this,n=arguments;return new Promise((function(r,i){var a=e.apply(t,n);function o(e){hr(a,r,i,o,l,"next",e)}function l(e){hr(a,r,i,o,l,"throw",e)}o(void 0)}))}}function fr(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function vr(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){fr(e,t,n[t])}))}return e}function br(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n.push.apply(n,r)}return n}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}const yr=[{value:"",label:"All triggers"},{value:"problems",label:"Problems"},{value:"items",label:"Items"}],Er=[{value:0,label:"Not classified"},{value:1,label:"Information"},{value:2,label:"Warning"},{value:3,label:"Average"},{value:4,label:"High"},{value:5,label:"Disaster"}],Or=({query:e,datasource:t,onChange:r})=>{var i,a,o,l,s,c,u,d,p,m,h,g;const f=(v=gr((function*(){const e=yield t.zabbix.getAllGroups(),n=null==e?void 0:e.map((e=>({value:e.name,label:e.name})));return n.unshift(...Gt()),n})),function(){return v.apply(this,arguments)});var v;const[{loading:b,value:y},E]=Lt(gr((function*(){return yield f()})),[]),O=function(){var e=gr((function*(e){const r=t.replaceTemplateVars(e),i=yield t.zabbix.getAllHosts(r);let a=null==i?void 0:i.map((e=>({value:e.name,label:e.name})));return a=n().uniqBy(a,(e=>e.value)),a.unshift({value:"/.*/"}),a.unshift(...Gt()),a}));return function(t){return e.apply(this,arguments)}}(),[{loading:w,value:I},T]=Lt(gr((function*(){return yield O(e.group.filter)})),[e.group.filter]),x=function(){var e=gr((function*(e,r){const i=t.replaceTemplateVars(e),a=t.replaceTemplateVars(r),o=yield t.zabbix.getAllApps(i,a);let l=null==o?void 0:o.map((e=>({value:e.name,label:e.name})));return l=n().uniqBy(l,(e=>e.value)),l.unshift(...Gt()),l}));return function(t,n){return e.apply(this,arguments)}}(),[{loading:P,value:S},A]=Lt(gr((function*(){return yield x(e.group.filter,e.host.filter)})),[e.group.filter,e.host.filter]),C=function(){var e=gr((function*(e,r){if(!(yield t.zabbix.isZabbix54OrHigher()))return[];const i=t.replaceTemplateVars(e),a=t.replaceTemplateVars(r),o=yield t.zabbix.getAllItems(i,a,null,null,{}),l=n().flatten(o.map((e=>e.tags||[]))),s=n().uniqBy(l,(e=>e.tag+e.value||"")).map((e=>q(e)));let c=null==s?void 0:s.map((e=>({value:e,label:e})));return c=n().uniqBy(c,(e=>e.value)),c.unshift(...Gt()),c}));return function(t,n){return e.apply(this,arguments)}}(),[{loading:D,value:j},F]=Lt(gr((function*(){return yield C(e.group.filter,e.host.filter)})),[e.group.filter,e.host.filter]),R=function(){var e=gr((function*(){const e=yield t.zabbix.getProxies(),n=null==e?void 0:e.map((e=>({value:e.host,label:e.host})));return n.unshift(...Gt()),n}));return function(){return e.apply(this,arguments)}}(),[{loading:$,value:N},k]=Lt(gr((function*(){return yield R()})),[]),L=function(){var r=gr((function*(r,i,a,o){const l=t.replaceTemplateVars(r),s=t.replaceTemplateVars(i),c=t.replaceTemplateVars(a),u=t.replaceTemplateVars(o),d={itemtype:"num",showDisabledItems:e.options.showDisabledItems},p=yield t.zabbix.getAllItems(l,s,c,u,d);let m=null==p?void 0:p.map((e=>({value:e.name,label:e.name})));return m=n().uniqBy(m,(e=>e.value)),m.unshift(...Gt()),m}));return function(e,t,n,i){return r.apply(this,arguments)}}(),[{loading:_,value:M},V]=Lt(gr((function*(){return yield L(e.group.filter,e.host.filter,e.application.filter,e.itemTag.filter)})),[e.group.filter,e.host.filter,e.application.filter,e.itemTag.filter]),B=t.replaceTemplateVars(null===(i=e.group)||void 0===i?void 0:i.filter),H=t.replaceTemplateVars(null===(a=e.host)||void 0===a?void 0:a.filter),z=t.replaceTemplateVars(null===(o=e.application)||void 0===o?void 0:o.filter),W=t.replaceTemplateVars(null===(l=e.itemTag)||void 0===l?void 0:l.filter);(0,$t.useEffect)((()=>{E()}),[]),(0,$t.useEffect)((()=>{T()}),[B]),(0,$t.useEffect)((()=>{A()}),[B,H]),(0,$t.useEffect)((()=>{F()}),[B,H]),(0,$t.useEffect)((()=>{k()}),[]),(0,$t.useEffect)((()=>{V()}),[B,H,z,W]);const U=t=>n=>{var i;const a=null==n||null===(i=n.currentTarget)||void 0===i?void 0:i.value;null!==a&&r(br(vr({},e),{[t]:{filter:a}}))},G=t=>n=>{null!==n&&r(br(vr({},e),{[t]:{filter:n}}))},Q=t.zabbix.supportsApplications();return Nt().createElement(Nt().Fragment,null,Nt().createElement(qt,null,Nt().createElement(_t.InlineField,{label:"Count by",labelWidth:12},Nt().createElement(_t.Select,{isSearchable:!1,width:24,value:e.countTriggersBy,options:yr,onChange:t=>{null!==t.value&&r(br(vr({},e),{countTriggersBy:t.value}))}}))),Nt().createElement(qt,null,Nt().createElement(_t.InlineField,{label:"Group",labelWidth:12},Nt().createElement(Wt,{width:24,value:null===(s=e.group)||void 0===s?void 0:s.filter,options:y,isLoading:b,onChange:G("group")})),Nt().createElement(_t.InlineField,{label:"Host",labelWidth:12},Nt().createElement(Wt,{width:24,value:null===(c=e.host)||void 0===c?void 0:c.filter,options:I,isLoading:w,onChange:G("host")})),"problems"===e.countTriggersBy&&Nt().createElement(_t.InlineField,{label:"Proxy",labelWidth:12},Nt().createElement(Wt,{width:24,value:null===(u=e.proxy)||void 0===u?void 0:u.filter,options:N,isLoading:$,onChange:G("proxy")}))),Nt().createElement(qt,null,Q&&Nt().createElement(_t.InlineField,{label:"Application",labelWidth:12},Nt().createElement(Wt,{width:24,value:null===(d=e.application)||void 0===d?void 0:d.filter,options:S,isLoading:P,onChange:G("application")})),!Q&&"items"===e.countTriggersBy&&Nt().createElement(_t.InlineField,{label:"Item tag",labelWidth:12},Nt().createElement(Wt,{width:24,value:e.itemTag.filter,options:j,isLoading:D,onChange:G("itemTag")})),"problems"===e.countTriggersBy&&Nt().createElement(Nt().Fragment,null,Nt().createElement(_t.InlineField,{label:"Problem",labelWidth:12},Nt().createElement(_t.Input,{width:24,defaultValue:null===(p=e.trigger)||void 0===p?void 0:p.filter,placeholder:"Problem name",onBlur:U("trigger")}))),"items"===e.countTriggersBy&&Nt().createElement(_t.InlineField,{label:"Item",labelWidth:12},Nt().createElement(Wt,{width:24,value:e.item.filter,options:M,isLoading:_,onChange:G("item")})),!Q&&Nt().createElement(_t.InlineField,{label:"Tags",labelWidth:12},Nt().createElement(_t.Input,{width:24,defaultValue:null===(m=e.tags)||void 0===m?void 0:m.filter,placeholder:"tag1:value1, tag2:value2",onBlur:U("tags")}))),Nt().createElement(qt,null,Nt().createElement(_t.InlineField,{label:"Min severity",labelWidth:12},Nt().createElement(_t.Select,{isSearchable:!1,width:24,value:null===(h=e.options)||void 0===h?void 0:h.minSeverity,options:Er,onChange:t=>{null!==t.value&&r(br(vr({},e),{options:br(vr({},e.options),{minSeverity:t.value})}))}})),Nt().createElement(_t.InlineField,{label:"Count",labelWidth:12},Nt().createElement(_t.InlineSwitch,{value:null===(g=e.options)||void 0===g?void 0:g.count,onChange:()=>{var t;return r(br(vr({},e),{options:br(vr({},e.options),{count:!(null===(t=e.options)||void 0===t?void 0:t.count)})}))}}))))};function wr(e,t,n,r,i,a,o){try{var l=e[a](o),s=l.value}catch(e){return void n(e)}l.done?t(s):Promise.resolve(s).then(r,i)}function Ir(e){return function(){var t=this,n=arguments;return new Promise((function(r,i){var a=e.apply(t,n);function o(e){wr(a,r,i,o,l,"next",e)}function l(e){wr(a,r,i,o,l,"throw",e)}o(void 0)}))}}function Tr(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}const xr=({query:e,datasource:t,onChange:r})=>{var i,a;const o=(l=Ir((function*(){const e=yield t.zabbix.getAllGroups(),n=null==e?void 0:e.map((e=>({value:e.name,label:e.name})));return n.unshift(...Gt()),n})),function(){return l.apply(this,arguments)});var l;const[{loading:s,value:c},u]=Lt(Ir((function*(){return yield o()})),[]),d=function(){var e=Ir((function*(e){const r=t.replaceTemplateVars(e),i=yield t.zabbix.getAllHosts(r);let a=null==i?void 0:i.map((e=>({value:e.name,label:e.name})));return a=n().uniqBy(a,(e=>e.value)),a.unshift({value:"/.*/"}),a.unshift(...Gt()),a}));return function(t){return e.apply(this,arguments)}}(),[{loading:p,value:m},h]=Lt(Ir((function*(){return yield d(e.group.filter)})),[e.group.filter]),g=function(){var e=Ir((function*(e,r){const i=t.replaceTemplateVars(e),a=t.replaceTemplateVars(r),o=yield t.zabbix.getAllMacros(i,a);let l=null==o?void 0:o.map((e=>({value:e.macro,label:e.macro})));return l=n().uniqBy(l,(e=>e.value)),l.unshift({value:"/.*/"}),l.unshift(...Gt()),l}));return function(t,n){return e.apply(this,arguments)}}(),[{loading:f,value:v},b]=Lt(Ir((function*(){return yield g(e.group.filter,e.host.filter)})),[e.group.filter,e.host.filter]),y=t.replaceTemplateVars(null===(i=e.group)||void 0===i?void 0:i.filter),E=t.replaceTemplateVars(null===(a=e.host)||void 0===a?void 0:a.filter);(0,$t.useEffect)((()=>{u()}),[]),(0,$t.useEffect)((()=>{h()}),[y]),(0,$t.useEffect)((()=>{b()}),[y,E]);const O=t=>n=>{var i,a;null!==n&&r((i=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){Tr(e,t,n[t])}))}return e}({},e),a=null!=(a={[t]:{filter:n}})?a:{},Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(a)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n.push.apply(n,r)}return n}(Object(a)).forEach((function(e){Object.defineProperty(i,e,Object.getOwnPropertyDescriptor(a,e))})),i))};return Nt().createElement(Nt().Fragment,null,Nt().createElement(qt,null,Nt().createElement(_t.InlineField,{label:"Group",labelWidth:12},Nt().createElement(Wt,{width:24,value:e.group.filter,options:c,isLoading:s,onChange:O("group")})),Nt().createElement(_t.InlineField,{label:"Host",labelWidth:12},Nt().createElement(Wt,{width:24,value:e.host.filter,options:m,isLoading:p,onChange:O("host")}))),Nt().createElement(qt,null,Nt().createElement(_t.InlineField,{label:"Macros",labelWidth:12},Nt().createElement(Wt,{width:24,value:e.macro.filter,options:v,isLoading:f,onChange:O("macro")}))))};function Pr(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Sr(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){Pr(e,t,n[t])}))}return e}function Ar(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n.push.apply(n,r)}return n}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}const Cr=[{value:c,label:"Metrics",description:"Query numeric metrics"},{value:d,label:"Text",description:"Query text data"},{value:u,label:"Services",description:"Query services SLA"},{value:p,label:"Item Id",description:"Query metrics by item ids"},{value:m,label:"Triggers",description:"Count triggers"},{value:h,label:"Problems",description:"Query problems"},{value:v,label:"User macros",description:"User Macros"}];function Dr(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var jr;const Fr=_t.Input||(null===(jr=_t.LegacyForms)||void 0===jr?void 0:jr.Input),Rr=RegExp(`^${/\$(\w+)|\[\[([\s\S]+?)(?::(\w+))?\]\]|\${(\w+)(?:\.([^:^\}]+))?(?::(\w+))?}/g.source}`),$r=e=>({inputRegex:Mt.css`
    color: ${e.colors.warning.main};
  `,inputVariable:Mt.css`
    color: ${e.colors.action.focus};
  `}),Nr={[_t.EventsWithValidation.onBlur]:[{rule:e=>!e||!(e.length>1&&"/"===e[0]&&"/"!==e[e.length-1]),errorMessage:"Not a valid regex"},{rule:e=>"*"!==e,errorMessage:"Wildcards not supported. Use /.*/ instead"}]},kr=e=>{var{value:t,ref:n,validationEvents:r}=e,i=function(e,t){if(null==e)return{};var n,r,i=function(e,t){if(null==e)return{};var n,r,i={},a=Object.keys(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}(e,["value","ref","validationEvents"]);const a=(0,_t.useStyles2)($r);let o=a.inputRegex;return Rr.test(t)?o=a.inputVariable:D(t)&&(o=a.inputRegex),Nt().createElement(Fr,function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){Dr(e,t,n[t])}))}return e}({className:o,value:t,validationEvents:Nr},i))};function Lr(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function _r(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){Lr(e,t,n[t])}))}return e}function Mr(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n.push.apply(n,r)}return n}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}class qr extends $t.PureComponent{getSelectedQueryType(e){return this.queryTypes.find((t=>t.value===e))}render(){var e;const{selectedQueryType:t,legacyQuery:n,group:r,host:i,application:a,itemTag:o,item:l}=this.state,{datasource:s}=this.props,c=(null==s||null===(e=s.zabbix)||void 0===e?void 0:e.isZabbix54OrHigherSync())||!1;return Nt().createElement(Nt().Fragment,null,Nt().createElement(_t.InlineFieldRow,null,Nt().createElement(_t.InlineField,{label:"Query Type",labelWidth:16},Nt().createElement(_t.Select,{width:30,value:t,options:this.queryTypes,onChange:this.handleQueryTypeChange}))),Nt().createElement(_t.InlineFieldRow,null,Nt().createElement(_t.InlineField,{label:"Group",labelWidth:16},Nt().createElement(kr,{width:30,value:r,onChange:e=>this.handleQueryUpdate(e,"group"),onBlur:this.handleQueryChange}))),t.value!==E.Group&&Nt().createElement(_t.InlineFieldRow,null,Nt().createElement(_t.InlineField,{label:"Host",labelWidth:16},Nt().createElement(kr,{width:30,value:i,onChange:e=>this.handleQueryUpdate(e,"host"),onBlur:this.handleQueryChange}))),(t.value===E.Application||t.value===E.ItemTag||t.value===E.Item||t.value===E.ItemValues)&&Nt().createElement(Nt().Fragment,null,c&&Nt().createElement(_t.InlineFieldRow,null,Nt().createElement(_t.InlineField,{label:"Item Tag",labelWidth:16},Nt().createElement(kr,{width:30,value:o,onChange:e=>this.handleQueryUpdate(e,"itemTag"),onBlur:this.handleQueryChange}))),!c&&Nt().createElement(_t.InlineFieldRow,null,Nt().createElement(_t.InlineField,{label:"Application",labelWidth:16},Nt().createElement(kr,{width:30,value:a,onChange:e=>this.handleQueryUpdate(e,"application"),onBlur:this.handleQueryChange}))),(t.value===E.Item||t.value===E.ItemValues)&&Nt().createElement(_t.InlineFieldRow,null,Nt().createElement(_t.InlineField,{label:"Item",labelWidth:16},Nt().createElement(kr,{width:30,value:l,onChange:e=>this.handleQueryUpdate(e,"item"),onBlur:this.handleQueryChange})))),n&&Nt().createElement(Nt().Fragment,null,Nt().createElement(_t.InlineFormLabel,{width:10,tooltip:"Original query string, read-only"},"Legacy Query"),Nt().createElement(_t.Input,{value:n,readOnly:!0})))}constructor(e){if(super(e),Lr(this,"queryTypes",[{value:E.Group,label:"Group"},{value:E.Host,label:"Host"},{value:E.Application,label:"Application"},{value:E.ItemTag,label:"Item tag"},{value:E.Item,label:"Item"},{value:E.ItemValues,label:"Item values"}]),Lr(this,"defaults",{selectedQueryType:{value:E.Group,label:"Group"},queryType:E.Group,group:"/.*/",host:"",application:"",itemTag:"",item:""}),Lr(this,"handleQueryUpdate",((e,t)=>{const n=e.currentTarget.value;this.setState((e=>{const r=_r({},e);return r[t]=n,_r({},r)}))})),Lr(this,"handleQueryChange",(()=>{const{queryType:e,group:t,host:n,application:r,itemTag:i,item:a}=this.state,o={queryType:e,group:t,host:n,application:r,itemTag:i,item:a};this.props.onChange(o,`Zabbix - ${e}`)})),Lr(this,"handleQueryTypeChange",(e=>{this.setState(Mr(_r({},this.state),{selectedQueryType:e,queryType:e.value}));const{group:t,host:n,application:r,itemTag:i,item:a}=this.state,o=e.value,l={queryType:o,group:t,host:n,application:r,itemTag:i,item:a};this.props.onChange(l,`Zabbix - ${o}`)})),this.props.query&&"string"==typeof this.props.query){const e=A(this.props.query),t=this.getSelectedQueryType(e.queryType);this.state=_r({selectedQueryType:t,legacyQuery:this.props.query},e)}else if(this.props.query){const e=this.props.query,t=this.getSelectedQueryType(e.queryType);this.state=Mr(_r({},this.defaults,e),{selectedQueryType:t})}else this.state=this.defaults}}var Vr;!function(e){e.UserLogin="userLogin",e.Token="token"}(Vr||(Vr={}));var Br=Object.defineProperty,Hr=Object.defineProperties,zr=Object.getOwnPropertyDescriptors,Wr=Object.getOwnPropertySymbols,Ur=Object.prototype.hasOwnProperty,Gr=Object.prototype.propertyIsEnumerable,Qr=(e,t,n)=>t in e?Br(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,Jr=(e,t)=>{for(var n in t||(t={}))Ur.call(t,n)&&Qr(e,n,t[n]);if(Wr)for(var n of Wr(t))Gr.call(t,n)&&Qr(e,n,t[n]);return e};const Xr=({dataSourceName:e,docsLink:t,hasRequiredFields:n=!0,className:r})=>{const i=(0,_t.useTheme2)(),a={container:(0,Mt.css)({p:{margin:0},"p + p":{marginTop:i.spacing(2)}}),text:(0,Mt.css)((o=Jr({},i.typography.body),l={color:i.colors.text.secondary,a:(0,Mt.css)({color:i.colors.text.link,textDecoration:"underline","&:hover":{textDecoration:"none"}})},Hr(o,zr(l))))};var o,l;return Nt().createElement("div",{className:(0,Mt.cx)(a.container,r)},Nt().createElement("p",{className:a.text},"Before you can use the ",e," data source, you must configure it below or in the config file. For detailed instructions,"," ",Nt().createElement("a",{href:t,target:"_blank",rel:"noreferrer"},"view the documentation"),"."),n&&Nt().createElement("p",{className:a.text},Nt().createElement("i",null,"Fields marked with * are required")))};var Zr=Object.defineProperty,Yr=Object.defineProperties,Kr=Object.getOwnPropertyDescriptors,ei=Object.getOwnPropertySymbols,ti=Object.prototype.hasOwnProperty,ni=Object.prototype.propertyIsEnumerable,ri=(e,t,n)=>t in e?Zr(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,ii=(e,t)=>{for(var n in t||(t={}))ti.call(t,n)&&ri(e,n,t[n]);if(ei)for(var n of ei(t))ni.call(t,n)&&ri(e,n,t[n]);return e};const ai=({children:e,title:t,description:n,isCollapsible:r=!1,isInitiallyOpen:i=!0,kind:a="section",className:o})=>{const{colors:l,typography:s,spacing:c}=(0,_t.useTheme2)(),[u,d]=(0,$t.useState)(!r||i),p=u?"angle-up":"angle-down",m="sub-section"===a,h=`${u?"Collapse":"Expand"} section ${t}`,g={header:(0,Mt.css)({display:"flex",justifyContent:"space-between",alignItems:"center"}),title:(0,Mt.css)({margin:0}),subtitle:(0,Mt.css)({margin:0,fontWeight:s.fontWeightRegular}),descriptionText:(0,Mt.css)((f=ii({marginTop:c(m?.25:.5),marginBottom:0},s.bodySmall),v={color:l.text.secondary},Yr(f,Kr(v)))),content:(0,Mt.css)({marginTop:c(2)})};var f,v;return Nt().createElement("div",{className:o},Nt().createElement("div",{className:g.header},"section"===a?Nt().createElement("h3",{className:g.title},t):Nt().createElement("h6",{className:g.subtitle},t),r&&Nt().createElement(_t.IconButton,{name:p,onClick:()=>d(!u),type:"button",size:"xl","aria-label":h})),n&&Nt().createElement("p",{className:g.descriptionText},n),u&&Nt().createElement("div",{className:g.content},e))};var oi=Object.defineProperty,li=Object.defineProperties,si=Object.getOwnPropertyDescriptors,ci=Object.getOwnPropertySymbols,ui=Object.prototype.hasOwnProperty,di=Object.prototype.propertyIsEnumerable,pi=(e,t,n)=>t in e?oi(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n;const mi=e=>{var t,n=e,{children:r}=n,i=((e,t)=>{var n={};for(var r in e)ui.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&ci)for(var r of ci(e))t.indexOf(r)<0&&di.call(e,r)&&(n[r]=e[r]);return n})(n,["children"]);return Nt().createElement(ai,(t=((e,t)=>{for(var n in t||(t={}))ui.call(t,n)&&pi(e,n,t[n]);if(ci)for(var n of ci(t))di.call(t,n)&&pi(e,n,t[n]);return e})({},i),li(t,si({kind:"section"}))),r)};var hi=Object.defineProperty,gi=Object.defineProperties,fi=Object.getOwnPropertyDescriptors,vi=Object.getOwnPropertySymbols,bi=Object.prototype.hasOwnProperty,yi=Object.prototype.propertyIsEnumerable,Ei=(e,t,n)=>t in e?hi(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n;const Oi=({config:e,onChange:t,description:n,urlPlaceholder:r,urlTooltip:i,urlLabel:a,className:o})=>{const l=/^(ftp|http|https):\/\/(\w+:{0,1}\w*@)?(\S+)(:[0-9]+)?(\/|\/([\w#!:.?+=&%@!\-\/]))?$/.test(e.url),s={container:(0,Mt.css)({maxWidth:578})};return Nt().createElement(Nt().Fragment,null,Nt().createElement(mi,{title:"Connection",description:n,className:(0,Mt.cx)(s.container,o)},Nt().createElement(_t.InlineField,{htmlFor:"connection-url",label:a||"URL",labelWidth:24,tooltip:i||Nt().createElement(Nt().Fragment,null,"Specify a complete HTTP URL",Nt().createElement("br",null),"(for example https://example.com:8080)"),grow:!0,disabled:e.readOnly,required:!0,invalid:!l&&!e.readOnly,error:l?"":"Please enter a valid URL",interactive:!0},Nt().createElement(_t.Input,{id:"connection-url","aria-label":"Data source connection URL",onChange:n=>{return t((r=((e,t)=>{for(var n in t||(t={}))bi.call(t,n)&&Ei(e,n,t[n]);if(vi)for(var n of vi(t))yi.call(t,n)&&Ei(e,n,t[n]);return e})({},e),i={url:n.currentTarget.value},gi(r,fi(i))));var r,i},value:e.url||"",placeholder:r||"URL"}))))};var wi=Object.defineProperty,Ii=Object.defineProperties,Ti=Object.getOwnPropertyDescriptors,xi=Object.getOwnPropertySymbols,Pi=Object.prototype.hasOwnProperty,Si=Object.prototype.propertyIsEnumerable,Ai=(e,t,n)=>t in e?wi(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,Ci=(e,t)=>{for(var n in t||(t={}))Pi.call(t,n)&&Ai(e,n,t[n]);if(xi)for(var n of xi(t))Si.call(t,n)&&Ai(e,n,t[n]);return e},Di=(e,t)=>Ii(e,Ti(t));const ji=e=>{var t=e,{isConfigured:n,onReset:r}=t,i=((e,t)=>{var n={};for(var r in e)Pi.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&xi)for(var r of xi(e))t.indexOf(r)<0&&Si.call(e,r)&&(n[r]=e[r]);return n})(t,["isConfigured","onReset"]);return $t.createElement(_t.HorizontalGroup,null,!n&&$t.createElement(_t.Input,Di(Ci({},i),{type:"password"})),n&&$t.createElement(_t.Input,Di(Ci({},i),{type:"text",disabled:!0,value:"configured"})),n&&$t.createElement(_t.Button,{onClick:r,variant:"secondary"},"Reset"))},Fi=()=>({inlineFieldNoMarginRight:(0,Mt.css)({marginRight:0}),inlineFieldWithSecret:(0,Mt.css)({'[class$="layoutChildrenWrapper"]:first-child':{flexGrow:1}})}),Ri=({user:e,passwordConfigured:t,userTooltip:n="The username of the data source account",passwordTooltip:r="The password of the data source account",onUserChange:i,onPasswordChange:a,onPasswordReset:o,readOnly:l})=>{const s=Fi(),c={lastInlineField:(0,Mt.css)({marginBottom:0})};return Nt().createElement(Nt().Fragment,null,Nt().createElement(_t.InlineField,{className:s.inlineFieldNoMarginRight,label:"User",labelWidth:24,tooltip:n,required:!0,htmlFor:"basic-auth-user-input",interactive:!0,grow:!0,disabled:l},Nt().createElement(_t.Input,{id:"basic-auth-user-input",placeholder:"User",value:e,onChange:e=>i(e.currentTarget.value),required:!0})),Nt().createElement(_t.InlineField,{className:(0,Mt.cx)(s.inlineFieldNoMarginRight,s.inlineFieldWithSecret,c.lastInlineField),label:"Password",labelWidth:24,tooltip:r,required:!0,htmlFor:"basic-auth-password-input",interactive:!0,grow:!0,disabled:l},Nt().createElement(ji,{id:"basic-auth-password-input",isConfigured:t,onReset:l?()=>{}:o,placeholder:"Password",onChange:e=>a(e.currentTarget.value),required:!0})))};var $i=Object.defineProperty,Ni=Object.defineProperties,ki=Object.getOwnPropertyDescriptors,Li=Object.getOwnPropertySymbols,_i=Object.prototype.hasOwnProperty,Mi=Object.prototype.propertyIsEnumerable,qi=(e,t,n)=>t in e?$i(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n;const Vi=e=>{var t,n=e,{children:r}=n,i=((e,t)=>{var n={};for(var r in e)_i.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&Li)for(var r of Li(e))t.indexOf(r)<0&&Mi.call(e,r)&&(n[r]=e[r]);return n})(n,["children"]);return Nt().createElement(ai,(t=((e,t)=>{for(var n in t||(t={}))_i.call(t,n)&&qi(e,n,t[n]);if(Li)for(var n of Li(t))Mi.call(t,n)&&qi(e,n,t[n]);return e})({},i),Ni(t,ki({kind:"sub-section"}))),r)};var Bi=(e=>(e.NoAuth="NoAuth",e.BasicAuth="BasicAuth",e.OAuthForward="OAuthForward",e.CrossSiteCredentials="CrossSiteCredentials",e))(Bi||{}),Hi=Object.defineProperty,zi=Object.defineProperties,Wi=Object.getOwnPropertyDescriptors,Ui=Object.getOwnPropertySymbols,Gi=Object.prototype.hasOwnProperty,Qi=Object.prototype.propertyIsEnumerable,Ji=(e,t,n)=>t in e?Hi(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,Xi=(e,t)=>{for(var n in t||(t={}))Gi.call(t,n)&&Ji(e,n,t[n]);if(Ui)for(var n of Ui(t))Qi.call(t,n)&&Ji(e,n,t[n]);return e},Zi=(e,t)=>zi(e,Wi(t));const Yi={[Bi.BasicAuth]:{label:"Basic authentication",value:Bi.BasicAuth,description:"Authenticate with your data source username and password"},[Bi.CrossSiteCredentials]:{label:"Enable cross-site access control requests",value:Bi.CrossSiteCredentials,description:"Allow cross-site Access-Control requests with your existing credentials and cookies. This enables the server to authenticate the user and perform authorized requests on their behalf on other domains."},[Bi.OAuthForward]:{label:"Forward OAuth Identity",value:Bi.OAuthForward,description:"Forward the OAuth access token (and if available: the OIDC ID token) of the user querying to the data source"},[Bi.NoAuth]:{label:"No Authentication",value:Bi.NoAuth,description:"Data source is available without authentication"}},Ki=({selectedMethod:e,mostCommonMethod:t,visibleMethods:n,extendedDefaultOptions:r,customMethods:i,onAuthMethodSelect:a,basicAuth:o,readOnly:l})=>{var s,c,u,d;const[p,m]=(0,$t.useState)(!1),{colors:h,spacing:g}=(0,_t.useTheme2)(),f=(0,$t.useMemo)((()=>{var e;return null!=n?n:[Bi.BasicAuth,Bi.OAuthForward,Bi.NoAuth,...null!=(e=null==i?void 0:i.map((e=>e.id)))?e:[]]}),[i,n]),v=f.length>1,b=(0,$t.useMemo)((()=>{var e;const n=null!=(e=null==i?void 0:i.reduce(((e,t)=>(e[t.id]={label:t.label,value:t.id,description:t.description},e)),{}))?e:{},a={};let o;for(o in Yi)r&&r[o]?a[o]=Xi(Xi({},Yi[o]),r[o]):a[o]=Yi[o];const l=Xi(Xi({},n),a);return f.filter((e=>Boolean(l[e]))).map((e=>{const n=l[e];return e===t&&v?Zi(Xi({},n),{label:`${n.label} (most common)`}):n}))}),[f,i,r,t,v]);let y=e;v?e===Bi.NoAuth&&t&&!p&&(y=t):y=f[0];let E=null;y===Bi.BasicAuth&&o?E=Nt().createElement(Ri,Zi(Xi({},o),{readOnly:l})):y.startsWith("custom-")&&(E=null!=(c=null==(s=null==i?void 0:i.find((e=>e.id===y)))?void 0:s.component)?c:null);const O=v?"Authentication methods":null!=(u=b[0].label)?u:"",w=v?"Choose an authentication method to access the data source":null!=(d=b[0].description)?d:"",I={authMethods:(0,Mt.css)(Xi({marginTop:g(2.5)},v&&{padding:g(2),border:`1px solid ${h.border.weak}`})),selectedMethodFields:(0,Mt.css)({marginTop:g(1.5)})};return Nt().createElement(Vi,{title:O,description:w},Nt().createElement("div",{className:I.authMethods},v&&Nt().createElement(_t.Select,{options:b,value:y,onChange:e=>{m(!0),a(e.value)},disabled:l}),E&&Nt().createElement("div",{className:I.selectedMethodFields},E)))};var ea=Object.defineProperty,ta=Object.defineProperties,na=Object.getOwnPropertyDescriptors,ra=Object.getOwnPropertySymbols,ia=Object.prototype.hasOwnProperty,aa=Object.prototype.propertyIsEnumerable,oa=(e,t,n)=>t in e?ea(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,la=(e,t)=>{for(var n in t||(t={}))ia.call(t,n)&&oa(e,n,t[n]);if(ra)for(var n of ra(t))aa.call(t,n)&&oa(e,n,t[n]);return e};const sa=e=>({configuredStyle:Mt.css`
      min-height: ${e.spacing(e.components.height.md)};
      padding-top: ${e.spacing(.5)};
      resize: none;
    `}),ca=e=>{var t=e,{isConfigured:n,onReset:r}=t,i=((e,t)=>{var n={};for(var r in e)ia.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&ra)for(var r of ra(e))t.indexOf(r)<0&&aa.call(e,r)&&(n[r]=e[r]);return n})(t,["isConfigured","onReset"]);const a=(0,_t.useStyles2)(sa);return $t.createElement(_t.HorizontalGroup,null,!n&&$t.createElement(_t.TextArea,la({},i)),n&&$t.createElement(_t.TextArea,(o=la({},i),l={rows:1,disabled:!0,value:"configured",className:(0,Mt.cx)(a.configuredStyle)},ta(o,na(l)))),n&&$t.createElement(_t.Button,{onClick:r,variant:"secondary"},"Reset"));var o,l},ua=({children:e,enabled:t,label:n,tooltipText:r,onToggle:i,readOnly:a})=>{const{colors:o,spacing:l}=(0,_t.useTheme2)(),s={container:(0,Mt.css)({marginTop:3}),checkboxContainer:(0,Mt.css)({display:"flex",alignItems:"center"}),infoIcon:(0,Mt.css)({marginTop:-2,marginLeft:5,color:o.text.secondary}),content:(0,Mt.css)({margin:l(1,0,2,3)})};return Nt().createElement("div",{className:s.container},Nt().createElement("div",{className:s.checkboxContainer},Nt().createElement(_t.Checkbox,{value:t,label:n,onChange:()=>i(!t),disabled:a}),Nt().createElement(_t.Tooltip,{placement:"top",content:r,interactive:!0},Nt().createElement(_t.Icon,{name:"info-circle",className:s.infoIcon,size:"sm"}))),t&&e&&Nt().createElement("div",{className:s.content},e))},da=({enabled:e,certificateConfigured:t,onToggle:n,onCertificateChange:r,onCertificateReset:i,tooltips:a,readOnly:o})=>{var l;const s=Fi();return Nt().createElement(ua,{enabled:e,label:"Add self-signed certificate",tooltipText:"Add your own Certificate Authority (CA) certificate on top of one generated by the certificate authorities for additional security measures",onToggle:e=>n(e),readOnly:o},Nt().createElement(_t.InlineField,{label:"CA Certificate",labelWidth:24,tooltip:null!=(l=null==a?void 0:a.certificateLabel)?l:"Your self-signed certificate",required:!0,htmlFor:"self-signed-certificate-input",interactive:!0,grow:!0,className:(0,Mt.cx)(s.inlineFieldNoMarginRight,s.inlineFieldWithSecret),disabled:o},Nt().createElement(ca,{id:"self-signed-certificate-input",isConfigured:t,onChange:e=>r(e.currentTarget.value),onReset:o?()=>{}:i,placeholder:"Begins with --- BEGIN CERTIFICATE ---",rows:6,required:!0})))},pa=({enabled:e,serverName:t,clientCertificateConfigured:n,clientKeyConfigured:r,onToggle:i,onServerNameChange:a,onClientCertificateChange:o,onClientKeyChange:l,onClientCertificateReset:s,onClientKeyReset:c,tooltips:u,readOnly:d})=>{var p,m,h;const g=Fi();return Nt().createElement(ua,{enabled:e,label:"TLS Client Authentication",tooltipText:"Validate using TLS client authentication, in which the server authenticates the client",onToggle:e=>i(e),readOnly:d},Nt().createElement(_t.InlineField,{label:"ServerName",labelWidth:24,tooltip:null!=(p=null==u?void 0:u.serverNameLabel)?p:"A Servername is used to verify the hostname on the returned certificate",required:!0,htmlFor:"client-auth-servername-input",interactive:!0,grow:!0,className:g.inlineFieldNoMarginRight,disabled:d},Nt().createElement(_t.Input,{id:"client-auth-servername-input",placeholder:"domain.example.com",value:t,onChange:e=>a(e.currentTarget.value),required:!0})),Nt().createElement(_t.InlineField,{label:"Client Certificate",labelWidth:24,tooltip:null!=(m=null==u?void 0:u.certificateLabel)?m:"The client certificate can be generated from a Certificate Authority or be self-signed",required:!0,htmlFor:"client-auth-client-certificate-input",interactive:!0,grow:!0,className:(0,Mt.cx)(g.inlineFieldNoMarginRight,g.inlineFieldWithSecret),disabled:d},Nt().createElement(ca,{id:"client-auth-client-certificate-input",isConfigured:n,onChange:e=>o(e.currentTarget.value),onReset:d?()=>{}:s,placeholder:"Begins with --- BEGIN CERTIFICATE ---",rows:6,required:!0})),Nt().createElement(_t.InlineField,{label:"Client Key",labelWidth:24,tooltip:null!=(h=null==u?void 0:u.keyLabel)?h:"The client key can be generated from a Certificate Authority or be self-signed",required:!0,htmlFor:"client-auth-client-key-input",interactive:!0,grow:!0,className:(0,Mt.cx)(g.inlineFieldNoMarginRight,g.inlineFieldWithSecret),disabled:d},Nt().createElement(ca,{id:"client-auth-client-key-input",isConfigured:r,onChange:e=>l(e.currentTarget.value),onReset:d?()=>{}:c,placeholder:"Begins with --- RSA PRIVATE KEY CERTIFICATE ---",rows:6,required:!0})))},ma=({enabled:e,onToggle:t,readOnly:n})=>Nt().createElement(ua,{enabled:e,label:"Skip TLS certificate validation",tooltipText:"Skipping TLS certificate validation is not recommended unless absolutely necessary or for testing",onToggle:e=>t(e),readOnly:n});var ha=Object.defineProperty,ga=Object.defineProperties,fa=Object.getOwnPropertyDescriptors,va=Object.getOwnPropertySymbols,ba=Object.prototype.hasOwnProperty,ya=Object.prototype.propertyIsEnumerable,Ea=(e,t,n)=>t in e?ha(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,Oa=(e,t)=>{for(var n in t||(t={}))ba.call(t,n)&&Ea(e,n,t[n]);if(va)for(var n of va(t))ya.call(t,n)&&Ea(e,n,t[n]);return e},wa=(e,t)=>ga(e,fa(t));const Ia=({selfSignedCertificate:e,TLSClientAuth:t,skipTLSVerification:n,readOnly:r})=>{const{spacing:i}=(0,_t.useTheme2)(),a={container:(0,Mt.css)({marginTop:i(3)})};return Nt().createElement(Vi,{className:a.container,title:"TLS settings",description:"Additional security measures that can be applied on top of authentication"},Nt().createElement(da,wa(Oa({},e),{readOnly:r})),Nt().createElement(pa,wa(Oa({},t),{readOnly:r})),Nt().createElement(ma,wa(Oa({},n),{readOnly:r})))};var Ta=Object.defineProperty,xa=Object.defineProperties,Pa=Object.getOwnPropertyDescriptors,Sa=Object.getOwnPropertySymbols,Aa=Object.prototype.hasOwnProperty,Ca=Object.prototype.propertyIsEnumerable,Da=(e,t,n)=>t in e?Ta(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,ja=(e,t)=>{for(var n in t||(t={}))Aa.call(t,n)&&Da(e,n,t[n]);if(Sa)for(var n of Sa(t))Ca.call(t,n)&&Da(e,n,t[n]);return e},Fa=(e,t)=>xa(e,Pa(t));const Ra=({header:e,onChange:t,onBlur:n,onDelete:r,readOnly:i})=>{const{spacing:a}=(0,_t.useTheme2)(),o=Fi(),l={container:(0,Mt.css)({alignItems:"center"}),input:(0,Mt.css)({minWidth:"100%"}),headerNameField:(0,Mt.css)({width:"40%",marginRight:0,paddingRight:a(1)}),headerValueField:(0,Mt.css)({width:"45%",marginRight:0}),removeHeaderBtn:(0,Mt.css)({margin:"0 0 3px 10px"})};return Nt().createElement(Nt().Fragment,null,Nt().createElement(_t.InlineFieldRow,{className:l.container},Nt().createElement(_t.InlineField,{label:"Header",labelWidth:9,grow:!0,className:l.headerNameField,htmlFor:`custom-header-${e.id}-name-input`,disabled:i},Nt().createElement(_t.Input,{id:`custom-header-${e.id}-name-input`,placeholder:"X-Custom-Header",value:e.name,width:12,onChange:n=>t(Fa(ja({},e),{name:n.currentTarget.value})),onBlur:n,className:l.input})),Nt().createElement(_t.InlineField,{label:"Value",labelWidth:9,grow:!0,className:(0,Mt.cx)(o.inlineFieldWithSecret,l.headerValueField),htmlFor:`custom-header-${e.id}-value-input`,disabled:i},Nt().createElement(ji,{id:`custom-header-${e.id}-value-input`,isConfigured:e.configured,placeholder:"Header value",value:e.value,width:12,onChange:n=>t(Fa(ja({},e),{value:n.currentTarget.value})),onReset:i?()=>{}:()=>t(Fa(ja({},e),{configured:!1,value:""})),onBlur:n,className:l.input})),Nt().createElement(_t.IconButton,{name:"trash-alt",tooltip:"Remove header",tooltipPlacement:"top",className:l.removeHeaderBtn,onClick:r,type:"button",disabled:i})))};var $a=Object.defineProperty,Na=Object.defineProperties,ka=Object.getOwnPropertyDescriptors,La=Object.getOwnPropertySymbols,_a=Object.prototype.hasOwnProperty,Ma=Object.prototype.propertyIsEnumerable,qa=(e,t,n)=>t in e?$a(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,Va=(e,t)=>{for(var n in t||(t={}))_a.call(t,n)&&qa(e,n,t[n]);if(La)for(var n of La(t))Ma.call(t,n)&&qa(e,n,t[n]);return e},Ba=(e,t)=>Na(e,ka(t));const Ha=({headers:e,onChange:t,readOnly:n})=>{const{spacing:r}=(0,_t.useTheme2)(),[i,a]=(0,$t.useState)(e.map((e=>Ba(Va({},e),{id:za(),value:""}))));(0,$t.useEffect)((()=>{a((t=>{let n=!1;const r=t.map((t=>{var r;const i=null==(r=e.find((e=>e.name===t.name)))?void 0:r.configured;return void 0!==i&&t.configured!==i?(n=!0,Ba(Va({},t),{configured:i})):t}));return n?r:t}))}),[e]);const o=()=>{t(i.map((({name:e,value:t,configured:n})=>({name:e,value:t,configured:n}))))},l={container:(0,Mt.css)({marginTop:r(3)}),addHeaderButton:(0,Mt.css)({marginTop:r(1.5)})};return Nt().createElement("div",{className:l.container},Nt().createElement(Vi,{title:"HTTP headers",description:"Pass along additional context and metadata about the request/response",isCollapsible:!0,isInitiallyOpen:i.length>0},Nt().createElement("div",null,i.map((e=>Nt().createElement(Ra,{key:e.id,header:e,onChange:e=>((e,t)=>{a(i.map((n=>n.id===e?Va({},t):n)))})(e.id,e),onDelete:()=>(e=>{const n=i.findIndex((t=>t.id===e));if(-1===n)return;const r=[...i];r.splice(n,1),a(r),t(r.map((({name:e,value:t,configured:n})=>({name:e,value:t,configured:n}))))})(e.id),onBlur:o,readOnly:n})))),Nt().createElement("div",{className:l.addHeaderButton},Nt().createElement(_t.Button,{icon:"plus",variant:"secondary",fill:"outline",onClick:()=>{a([...i,{id:za(),name:"",value:"",configured:!1}])},disabled:n},0===i.length?"Add header":"Add another header"))))};function za(){return Math.random().toString(16).slice(2)}var Wa=Object.defineProperty,Ua=Object.defineProperties,Ga=Object.getOwnPropertyDescriptors,Qa=Object.getOwnPropertySymbols,Ja=Object.prototype.hasOwnProperty,Xa=Object.prototype.propertyIsEnumerable,Za=(e,t,n)=>t in e?Wa(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,Ya=(e,t)=>{for(var n in t||(t={}))Ja.call(t,n)&&Za(e,n,t[n]);if(Qa)for(var n of Qa(t))Xa.call(t,n)&&Za(e,n,t[n]);return e},Ka=(e,t)=>Ua(e,Ga(t));const eo=({selectedMethod:e,mostCommonMethod:t,visibleMethods:n,extendedDefaultOptions:r,customMethods:i,onAuthMethodSelect:a,basicAuth:o,TLS:l,customHeaders:s,readOnly:c=!1})=>{const u={container:(0,Mt.css)({maxWidth:578})};return Nt().createElement("div",{className:u.container},Nt().createElement(mi,{title:"Authentication"},Nt().createElement(Ki,{selectedMethod:e,mostCommonMethod:t,customMethods:i,visibleMethods:n,extendedDefaultOptions:r,onAuthMethodSelect:a,basicAuth:o,readOnly:c}),l&&Nt().createElement(Ia,Ka(Ya({},l),{readOnly:c})),s&&Nt().createElement(Ha,Ka(Ya({},s),{readOnly:c}))))};var to=Object.defineProperty,no=Object.defineProperties,ro=Object.getOwnPropertyDescriptors,io=Object.getOwnPropertySymbols,ao=Object.prototype.hasOwnProperty,oo=Object.prototype.propertyIsEnumerable,lo=(e,t,n)=>t in e?to(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,so=(e,t)=>{for(var n in t||(t={}))ao.call(t,n)&&lo(e,n,t[n]);if(io)for(var n of io(t))oo.call(t,n)&&lo(e,n,t[n]);return e},co=(e,t)=>no(e,ro(t));const uo="httpHeaderName",po="httpHeaderValue";function mo(e){return e.basicAuth?Bi.BasicAuth:e.withCredentials?Bi.CrossSiteCredentials:e.jsonData.oauthPassThru?Bi.OAuthForward:Bi.NoAuth}function ho(e,t){return n=>{t(co(so({},e),{basicAuth:n===Bi.BasicAuth,withCredentials:n===Bi.CrossSiteCredentials,jsonData:co(so({},e.jsonData),{oauthPassThru:n===Bi.OAuthForward})}))}}function go(e,t){return{user:e.basicAuthUser,passwordConfigured:e.secureJsonFields.basicAuthPassword,onUserChange:n=>t(co(so({},e),{basicAuthUser:n})),onPasswordChange:n=>t(co(so({},e),{secureJsonData:co(so({},e.secureJsonData),{basicAuthPassword:n})})),onPasswordReset:()=>t(co(so({},e),{secureJsonData:co(so({},e.secureJsonData),{basicAuthPassword:""}),secureJsonFields:co(so({},e.secureJsonFields),{basicAuthPassword:!1})}))}}function fo(e,t){return{selfSignedCertificate:{enabled:Boolean(e.jsonData.tlsAuthWithCACert),certificateConfigured:e.secureJsonFields.tlsCACert,onToggle:n=>t(co(so({},e),{jsonData:co(so({},e.jsonData),{tlsAuthWithCACert:n})})),onCertificateChange:n=>t(co(so({},e),{secureJsonData:co(so({},e.secureJsonData),{tlsCACert:n})})),onCertificateReset:()=>t(co(so({},e),{secureJsonData:co(so({},e.secureJsonData),{tlsCACert:""}),secureJsonFields:co(so({},e.secureJsonFields),{tlsCACert:!1})}))},TLSClientAuth:{enabled:e.jsonData.tlsAuth,serverName:e.jsonData.serverName,clientCertificateConfigured:e.secureJsonFields.tlsClientCert,clientKeyConfigured:e.secureJsonFields.tlsClientKey,onToggle:n=>t(co(so({},e),{jsonData:co(so({},e.jsonData),{tlsAuth:n})})),onServerNameChange:n=>t(co(so({},e),{jsonData:co(so({},e.jsonData),{serverName:n})})),onClientCertificateChange:n=>t(co(so({},e),{secureJsonData:co(so({},e.secureJsonData),{tlsClientCert:n})})),onClientCertificateReset:()=>t(co(so({},e),{secureJsonData:co(so({},e.secureJsonData),{tlsClientCert:""}),secureJsonFields:co(so({},e.secureJsonFields),{tlsClientCert:!1})})),onClientKeyChange:n=>t(co(so({},e),{secureJsonData:co(so({},e.secureJsonData),{tlsClientKey:n})})),onClientKeyReset:()=>t(co(so({},e),{secureJsonData:co(so({},e.secureJsonData),{tlsClientKey:""}),secureJsonFields:co(so({},e.secureJsonFields),{tlsClientKey:!1})}))},skipTLSVerification:{enabled:e.jsonData.tlsSkipVerify,onToggle:n=>t(co(so({},e),{jsonData:co(so({},e.jsonData),{tlsSkipVerify:n})}))}}}function vo(e,t){const n=Object.keys(e.jsonData).filter((e=>e.startsWith(uo))).sort().map((t=>{var n;const r=t.slice(14);return{name:e.jsonData[t],configured:null!=(n=e.secureJsonFields[`${po}${r}`])&&n}}));return{headers:n,onChange:n=>{const r=Object.fromEntries(Object.entries(e.jsonData).filter((([e])=>!e.startsWith(uo)))),i=Object.fromEntries(Object.entries(e.secureJsonData||{}).filter((([e])=>!e.startsWith(po)))),a=Object.fromEntries(Object.entries(e.secureJsonFields).filter((([e])=>!e.startsWith(po))));n.forEach(((e,t)=>{r[`${uo}${t+1}`]=e.name,e.configured?a[`${po}${t+1}`]=!0:i[`${po}${t+1}`]=e.value})),t(co(so({},e),{jsonData:r,secureJsonData:i,secureJsonFields:a}))}}}var bo=Object.defineProperty,yo=Object.defineProperties,Eo=Object.getOwnPropertyDescriptors,Oo=Object.getOwnPropertySymbols,wo=Object.prototype.hasOwnProperty,Io=Object.prototype.propertyIsEnumerable,To=(e,t,n)=>t in e?bo(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,xo=(e,t)=>{for(var n in t||(t={}))wo.call(t,n)&&To(e,n,t[n]);if(Oo)for(var n of Oo(t))Io.call(t,n)&&To(e,n,t[n]);return e},Po=(e,t)=>yo(e,Eo(t));const So=({config:e,onChange:t,className:n})=>{const r={container:(0,Mt.css)({maxWidth:578})};return Nt().createElement(Vi,{title:"Advanced HTTP settings",className:(0,Mt.cx)(r.container,n)},Nt().createElement(_t.InlineField,{htmlFor:"advanced-http-cookies",label:"Allowed cookies",labelWidth:24,tooltip:"Grafana proxy deletes forwarded cookies by default. Specify cookies by name that should be forwarded to the data source.",disabled:e.readOnly,grow:!0},Nt().createElement(_t.TagsInput,{id:"advanced-http-cookies",placeholder:"New cookie (hit enter to add)",tags:e.jsonData.keepCookies,onChange:n=>{t(Po(xo({},e),{jsonData:Po(xo({},e.jsonData),{keepCookies:n})}))}})),Nt().createElement(_t.InlineField,{htmlFor:"advanced-http-timeout",label:"Timeout",labelWidth:24,tooltip:"HTTP request timeout in seconds",disabled:e.readOnly,grow:!0},Nt().createElement(_t.Input,{id:"advanced-http-timeout",type:"number",min:0,placeholder:"Timeout in seconds","aria-label":"Timeout in seconds",value:e.jsonData.timeout,onChange:n=>{t(Po(xo({},e),{jsonData:Po(xo({},e.jsonData),{timeout:parseInt(n.currentTarget.value,10)})}))}})))};var Ao=Object.getOwnPropertySymbols,Co=Object.prototype.hasOwnProperty,Do=Object.prototype.propertyIsEnumerable;const jo=e=>{var t=e,{children:n}=t,r=((e,t)=>{var n={};for(var r in e)Co.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&Ao)for(var r of Ao(e))t.indexOf(r)<0&&Do.call(e,r)&&(n[r]=e[r]);return n})(t,["children"]);const i=(0,_t.useStyles2)((0,$t.useCallback)((e=>Fo(e,r)),[r]));return Nt().createElement("div",{className:i.root},n)},Fo=(e,t)=>{var n,r,i;return{root:(0,Mt.css)({display:"flex",flexDirection:null!=(n=t.direction)?n:"row",flexWrap:null==(r=t.wrap)||r?"wrap":void 0,alignItems:t.alignItems,gap:e.spacing(null!=(i=t.gap)?i:2),flexGrow:t.flexGrow})}},Ro=()=>{const e=(0,_t.useStyles2)($o);return Nt().createElement("hr",{className:e.horizontalDivider})},$o=e=>({horizontalDivider:(0,Mt.css)({borderTop:`1px solid ${e.colors.border.weak}`,margin:e.spacing(2,0),width:"100%"})});function No(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function ko(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){No(e,t,n[t])}))}return e}function Lo(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n.push.apply(n,r)}return n}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}const _o=["mysql","grafana-postgresql-datasource","postgres","influxdb"],Mo=[{label:"User and password",value:Vr.UserLogin},{label:"API token",value:Vr.Token}],qo=e=>({space:(0,Mt.css)({width:"100%",height:e.spacing(2)})}),Vo=(e,t,n)=>r=>{n(Lo(ko({},t),{jsonData:Lo(ko({},t.jsonData),{[e]:r.currentTarget.value})}))},Bo=(e,t,n)=>r=>{n(Lo(ko({},t),{jsonData:Lo(ko({},t.jsonData),{[e]:r.value})}))},Ho=(e,t,n)=>r=>{n(Lo(ko({},t),{jsonData:Lo(ko({},t.jsonData),{[e]:r.target.checked})}))},zo=(e,t,n)=>r=>{n(Lo(ko({},t),{secureJsonData:Lo(ko({},t.secureJsonData),{[e]:r.currentTarget.value})}))},Wo=(e,t,n)=>()=>{n(Lo(ko({},t),{secureJsonFields:Lo(ko({},t.secureJsonFields),{[e]:!1})}))},Uo=(e,t,n,r)=>i=>{const a=Go().find((e=>e.id===i.value));n({label:a.name,value:a.id}),r(a.type),t(Lo(ko({},e),{jsonData:Lo(ko({},e.jsonData),{dbConnectionDatasourceId:i.value})}))},Go=()=>{let e=(0,ie.getDataSourceSrv)().getAll();return e=e.filter((e=>_o.includes(e.type))),e},Qo=new e.DataSourcePlugin(ln).setConfigEditor((e=>{var t,n;const r=(0,_t.useStyles2)(qo),{options:i,onOptionsChange:a}=e,[o,l]=(0,$t.useState)(null),[s,c]=(0,$t.useState)("");return(0,$t.useEffect)((()=>{const{jsonData:e,secureJsonFields:t}=i,{password:n}=e,r=function(e,t){if(null==e)return{};var n,r,i=function(e,t){if(null==e)return{};var n,r,i={},a=Object.keys(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}(e,["password"]);if((null==t?void 0:t.password)||(i.secureJsonData||(i.secureJsonData={}),i.secureJsonData.password=n),a(Lo(ko({},i),{jsonData:ko({authType:Vr.UserLogin,trends:!0,trendsFrom:"",trendsRange:"",cacheTTL:"",timeout:void 0,disableDataAlignment:!1},r)})),i.jsonData.dbConnectionEnable)if(i.jsonData.dbConnectionDatasourceId){const e=Go().find((e=>e.id===i.jsonData.dbConnectionDatasourceId));l({label:null==e?void 0:e.name,value:null==e?void 0:e.id}),c(null==e?void 0:e.type)}else{const e=i.jsonData.dbConnectionDatasourceName;(0,ie.getDataSourceSrv)().get(e).then((e=>{if(e){const t=Go().find((t=>t.id===e.id));l({label:null==t?void 0:t.name,value:null==t?void 0:t.id}),c(null==t?void 0:t.type),a(Lo(ko({},i),{jsonData:Lo(ko({},i.jsonData),{dbConnectionDatasourceId:e.id})}))}}))}}),[]),Nt().createElement(Nt().Fragment,null,Nt().createElement(Xr,{dataSourceName:"Zabbix",docsLink:"https://grafana.com/docs/grafana/latest/datasources/loki/configure-loki-data-source/",hasRequiredFields:!0}),Nt().createElement(Ro,null),Nt().createElement(Oi,{config:i,onChange:a,urlPlaceholder:"http://localhost/zabbix/api_jsonrpc.php"}),Nt().createElement(Ro,null),Nt().createElement(eo,function({config:e,onChange:t}){return{selectedMethod:mo(e),onAuthMethodSelect:ho(e,t),basicAuth:go(e,t),TLS:fo(e,t),customHeaders:vo(e,t),readOnly:e.readOnly}}({config:i,onChange:a})),Nt().createElement(Ro,null),Nt().createElement(mi,{title:"Zabbix Connection"},Nt().createElement(_t.Field,{label:"Auth type"},Nt().createElement(_t.Select,{width:40,options:Mo,value:i.jsonData.authType,onChange:Bo("authType",i,a)})),(null===(t=i.jsonData)||void 0===t?void 0:t.authType)===Vr.UserLogin&&Nt().createElement(Nt().Fragment,null,Nt().createElement(_t.Field,{label:"Username"},Nt().createElement(_t.Input,{width:40,placeholder:"Username",value:i.jsonData.username||"",onChange:Vo("username",i,a)})),Nt().createElement(_t.Field,{label:"Password"},Nt().createElement(_t.SecretInput,{width:40,placeholder:"Password",isConfigured:i.secureJsonFields&&i.secureJsonFields.password,onReset:Wo("password",i,a),onBlur:zo("password",i,a)}))),(null===(n=i.jsonData)||void 0===n?void 0:n.authType)===Vr.Token&&Nt().createElement(Nt().Fragment,null,Nt().createElement(_t.Field,{label:"API Token"},Nt().createElement(_t.SecretInput,{width:40,placeholder:"API token",isConfigured:i.secureJsonFields&&i.secureJsonFields.apiToken,onReset:Wo("apiToken",i,a),onBlur:zo("apiToken",i,a)})))),Nt().createElement(Ro,null),Nt().createElement(mi,{title:"Additional settings",isCollapsible:!0},Nt().createElement(So,{config:i,onChange:a}),Nt().createElement("div",{className:r.space}),Nt().createElement(Vi,{title:"Zabbix API"},Nt().createElement(_t.Field,{label:Nt().createElement(_t.Label,null,Nt().createElement(jo,{gap:.5},Nt().createElement("span",null,"Cache TTL"),Nt().createElement(_t.Tooltip,{content:Nt().createElement("span",null,"Zabbix data source caches metric names in memory. Specify how often data will be updated.")},Nt().createElement(_t.Icon,{name:"info-circle",size:"sm"}))))},Nt().createElement(_t.Input,{width:40,value:i.jsonData.cacheTTL||"",placeholder:"1h",onChange:Vo("cacheTTL",i,a)})),Nt().createElement(_t.Field,{label:Nt().createElement(_t.Label,null,Nt().createElement(jo,{gap:.5},Nt().createElement("span",null,"Timeout"),Nt().createElement(_t.Tooltip,{content:Nt().createElement("span",null,"Zabbix API connection timeout in seconds. Default is 30.")},Nt().createElement(_t.Icon,{name:"info-circle",size:"sm"}))))},Nt().createElement(_t.Input,{width:40,type:"number",value:i.jsonData.timeout,placeholder:"30",onChange:e=>{a(Lo(ko({},i),{jsonData:Lo(ko({},i.jsonData),{timeout:parseInt(e.currentTarget.value,10)})}))}}))),Nt().createElement(Vi,{title:"Trends"},Nt().createElement(_t.Field,{label:"Enable Trends"},Nt().createElement(_t.Switch,{value:i.jsonData.trends,onChange:Ho("trends",i,a)})),i.jsonData.trends&&Nt().createElement(Nt().Fragment,null,Nt().createElement(_t.Field,{label:Nt().createElement(_t.Label,null,Nt().createElement(jo,{gap:.5},Nt().createElement("span",null,"After"),Nt().createElement(_t.Tooltip,{content:Nt().createElement("span",null,"Time after which trends will be used. Best practice is to set this value to your history storage period (7d, 30d, etc).")},Nt().createElement(_t.Icon,{name:"info-circle",size:"sm"}))))},Nt().createElement(_t.Input,{width:40,placeholder:"7d",value:i.jsonData.trendsFrom||"",onChange:Vo("trendsFrom",i,a)})),Nt().createElement(_t.Field,{label:Nt().createElement(_t.Label,null,Nt().createElement(jo,{gap:.5},Nt().createElement("span",null,"Range"),Nt().createElement(_t.Tooltip,{content:Nt().createElement("span",null,"Time range width after which trends will be used instead of history. It&aposs better to set this value in range of 4 to 7 days to prevent loading large amount of history data.")},Nt().createElement(_t.Icon,{name:"info-circle",size:"sm"}))))},Nt().createElement(_t.Input,{width:40,placeholder:"4d",value:i.jsonData.trendsRange||"",onChange:Vo("trendsRange",i,a)})))),Nt().createElement(Vi,{title:"Direct DB Connection"},Nt().createElement(_t.Field,{label:"Enable Direct DB Connection"},Nt().createElement(_t.Switch,{value:i.jsonData.dbConnectionEnable,onChange:Ho("dbConnectionEnable",i,a)})),i.jsonData.dbConnectionEnable&&Nt().createElement(Nt().Fragment,null,Nt().createElement(_t.Field,{label:"Data Source"},Nt().createElement(_t.Select,{width:40,value:o,options:Go().map((e=>({label:e.name,value:e.id,description:e.type}))),onChange:Uo(i,a,l,c)})),"influxdb"===s&&Nt().createElement(_t.Field,{label:"Retention Policy"},Nt().createElement(_t.Input,{width:40,value:i.jsonData.dbConnectionRetentionPolicy||"",placeholder:"Retention policy name",onChange:Vo("dbConnectionRetentionPolicy",i,a)})))),Nt().createElement(Vi,{title:"Other"},Nt().createElement(_t.Field,{label:"Disable acknowledges for read-only users"},Nt().createElement(_t.Switch,{label:"Disable acknowledges for read-only users",value:i.jsonData.disableReadOnlyUsersAck,onChange:Ho("disableReadOnlyUsersAck",i,a)})),Nt().createElement(_t.Field,{label:Nt().createElement(_t.Label,null,Nt().createElement(jo,{gap:.5},Nt().createElement("span",null,"Disable data alignment"),Nt().createElement(_t.Tooltip,{content:Nt().createElement("span",null,"Data alignment feature aligns points based on item update interval. For instance, if value collected once per minute, then timestamp of the each point will be set to the start of corresponding minute. This alignment required for proper work of the stacked graphs. If you don't need stacked graphs and want to get exactly the same timestamps as in Zabbix, then you can disable this feature.")},Nt().createElement(_t.Icon,{name:"info-circle",size:"sm"}))))},Nt().createElement(_t.Switch,{value:!!i.jsonData.disableDataAlignment,onChange:Ho("disableDataAlignment",i,a)}))),ie.config.secureSocksDSProxyEnabled&&(0,Ve.gte)(ie.config.buildInfo.version,"10.0.0-0")&&Nt().createElement(_t.SecureSocksProxySettings,{options:i,onOptionsChange:a})))})).setQueryEditor((({query:e,datasource:t,onChange:n,onRunQuery:r})=>{const i={schema:12,queryType:c,group:{filter:""},host:{filter:""},application:{filter:""},itemTag:{filter:""},item:{filter:""},macro:{filter:""},functions:[],trigger:{filter:""},countTriggersBy:"",tags:{filter:""},proxy:{filter:""},textFilter:"",evaltype:et.AndOr,options:{showDisabledItems:!1,skipEmptyValues:!1,disableDataAlignment:!1,useZabbixValueMapping:!1,useTrends:"default",count:!1},table:{skipEmptyValues:!1}};(e=Sr({},i,e)).options=Sr({},i.options,e.options);const{queryType:a}=e;if(a===h||a===m){const t={showProblems:Ke.Problems,options:{minSeverity:0,sortProblems:"default",acknowledged:2,hostsInMaintenance:!1,hostProxy:!1,limit:1001,useTimeRange:!1,count:!1}};(e=Sr({},t,e)).options=Sr({},t.options,e.options)}a===u&&(e=Sr({},{itServiceFilter:"",slaFilter:"",slaProperty:"sla",slaInterval:"none"},e)),(0,$t.useEffect)((()=>{const t=Q(e);n(t)}),[]);const o=e=>{n(e),r()};return Nt().createElement(Nt().Fragment,null,Nt().createElement(qt,null,Nt().createElement(_t.InlineField,{label:"Query type",labelWidth:12},Nt().createElement(_t.Select,{isSearchable:!1,width:24,value:a,options:Cr,onChange:("queryType",t=>{null!==t.value&&o(Ar(Sr({},e),{queryType:t.value}))})}))),a===c&&Nt().createElement(Nt().Fragment,null,Nt().createElement(bn,{query:e,datasource:t,onChange:o}),Nt().createElement($n,{query:e,onChange:o})),a===p&&Nt().createElement(Nt().Fragment,null,Nt().createElement(ar,{query:e,onChange:o}),Nt().createElement($n,{query:e,onChange:o})),a===d&&Nt().createElement(Nt().Fragment,null,Nt().createElement(Qn,{query:e,datasource:t,onChange:o})),a===u&&Nt().createElement(Nt().Fragment,null,Nt().createElement(mr,{query:e,datasource:t,onChange:o}),Nt().createElement($n,{query:e,onChange:o})),a===h&&Nt().createElement(rr,{query:e,datasource:t,onChange:o}),a===m&&Nt().createElement(Or,{query:e,datasource:t,onChange:o}),a===v&&Nt().createElement(xr,{query:e,datasource:t,onChange:o}),Nt().createElement(Vn,{queryType:a,queryOptions:e.options,onChange:t=>{o(Ar(Sr({},e),{options:t}))}}))})).setVariableQueryEditor(qr)})(),f})()));
//# sourceMappingURL=module.js.map